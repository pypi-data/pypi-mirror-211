{"version":3,"file":"f81ce807a2aebac28b3e.chunk.js","mappings":"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","sources":["webpack://superset/./plugins/plugin-chart-echarts/src/BigNumber/BigNumberViz.tsx","webpack://superset/./plugins/plugin-chart-echarts/src/components/Echart.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport {\n  t,\n  getNumberFormatter,\n  NumberFormatter,\n  smartDateVerboseFormatter,\n  TimeFormatter,\n  computeMaxFontSize,\n  BRAND_COLOR,\n  styled,\n} from '@superset-ui/core';\nimport { EChartsCoreOption } from 'echarts';\nimport Echart from '../components/Echart';\nimport { TimeSeriesDatum } from './types';\n\nconst defaultNumberFormatter = getNumberFormatter();\n\nconst PROPORTION = {\n  // text size: proportion of the chart container sans trendline\n  KICKER: 0.1,\n  HEADER: 0.3,\n  SUBHEADER: 0.125,\n  // trendline size: proportion of the whole chart container\n  TRENDLINE: 0.3,\n};\n\ntype BigNumberVisProps = {\n  className?: string;\n  width: number;\n  height: number;\n  bigNumber?: number | null;\n  bigNumberFallback?: TimeSeriesDatum;\n  headerFormatter: NumberFormatter | TimeFormatter;\n  formatTime: TimeFormatter;\n  headerFontSize: number;\n  kickerFontSize: number;\n  subheader: string;\n  subheaderFontSize: number;\n  showTimestamp?: boolean;\n  showTrendLine?: boolean;\n  startYAxisAtZero?: boolean;\n  timeRangeFixed?: boolean;\n  timestamp?: number;\n  trendLineData?: TimeSeriesDatum[];\n  mainColor: string;\n  echartOptions: EChartsCoreOption;\n};\n\nclass BigNumberVis extends React.PureComponent<BigNumberVisProps> {\n  static defaultProps = {\n    className: '',\n    headerFormatter: defaultNumberFormatter,\n    formatTime: smartDateVerboseFormatter,\n    headerFontSize: PROPORTION.HEADER,\n    kickerFontSize: PROPORTION.KICKER,\n    mainColor: BRAND_COLOR,\n    showTimestamp: false,\n    showTrendLine: false,\n    startYAxisAtZero: true,\n    subheader: '',\n    subheaderFontSize: PROPORTION.SUBHEADER,\n    timeRangeFixed: false,\n  };\n\n  getClassName() {\n    const { className, showTrendLine, bigNumberFallback } = this.props;\n    const names = `superset-legacy-chart-big-number ${className} ${\n      bigNumberFallback ? 'is-fallback-value' : ''\n    }`;\n    if (showTrendLine) return names;\n    return `${names} no-trendline`;\n  }\n\n  createTemporaryContainer() {\n    const container = document.createElement('div');\n    container.className = this.getClassName();\n    container.style.position = 'absolute'; // so it won't disrupt page layout\n    container.style.opacity = '0'; // and not visible\n    return container;\n  }\n\n  renderFallbackWarning() {\n    const { bigNumberFallback, formatTime, showTimestamp } = this.props;\n    if (!bigNumberFallback || showTimestamp) return null;\n    return (\n      <span\n        className=\"alert alert-warning\"\n        role=\"alert\"\n        title={t(\n          `Last available value seen on %s`,\n          formatTime(bigNumberFallback[0]),\n        )}\n      >\n        {t('Not up to date')}\n      </span>\n    );\n  }\n\n  renderKicker(maxHeight: number) {\n    const { timestamp, showTimestamp, formatTime, width } = this.props;\n    if (!showTimestamp) return null;\n\n    const text = timestamp === null ? '' : formatTime(timestamp);\n\n    const container = this.createTemporaryContainer();\n    document.body.append(container);\n    const fontSize = computeMaxFontSize({\n      text,\n      maxWidth: width,\n      maxHeight,\n      className: 'kicker',\n      container,\n    });\n    container.remove();\n\n    return (\n      <div\n        className=\"kicker\"\n        style={{\n          fontSize,\n          height: maxHeight,\n        }}\n      >\n        {text}\n      </div>\n    );\n  }\n\n  renderHeader(maxHeight: number) {\n    const { bigNumber, headerFormatter, width } = this.props;\n    const text = bigNumber === null ? t('No data') : headerFormatter(bigNumber);\n\n    const container = this.createTemporaryContainer();\n    document.body.append(container);\n    const fontSize = computeMaxFontSize({\n      text,\n      maxWidth: width - 8, // Decrease 8px for more precise font size\n      maxHeight,\n      className: 'header-line',\n      container,\n    });\n    container.remove();\n\n    return (\n      <div\n        className=\"header-line\"\n        style={{\n          fontSize,\n          height: maxHeight,\n        }}\n      >\n        {text}\n      </div>\n    );\n  }\n\n  renderSubheader(maxHeight: number) {\n    const { bigNumber, subheader, width, bigNumberFallback } = this.props;\n    let fontSize = 0;\n\n    const NO_DATA_OR_HASNT_LANDED = t(\n      'No data after filtering or data is NULL for the latest time record',\n    );\n    const NO_DATA = t(\n      'Try applying different filters or ensuring your datasource has data',\n    );\n    let text = subheader;\n    if (bigNumber === null) {\n      text = bigNumberFallback ? NO_DATA : NO_DATA_OR_HASNT_LANDED;\n    }\n    if (text) {\n      const container = this.createTemporaryContainer();\n      document.body.append(container);\n      fontSize = computeMaxFontSize({\n        text,\n        maxWidth: width,\n        maxHeight,\n        className: 'subheader-line',\n        container,\n      });\n      container.remove();\n\n      return (\n        <div\n          className=\"subheader-line\"\n          style={{\n            fontSize,\n            height: maxHeight,\n          }}\n        >\n          {text}\n        </div>\n      );\n    }\n    return null;\n  }\n\n  renderTrendline(maxHeight: number) {\n    const { width, trendLineData, echartOptions } = this.props;\n\n    // if can't find any non-null values, no point rendering the trendline\n    if (!trendLineData?.some(d => d[1] !== null)) {\n      return null;\n    }\n\n    return (\n      <Echart\n        width={Math.floor(width)}\n        height={maxHeight}\n        echartOptions={echartOptions}\n      />\n    );\n  }\n\n  render() {\n    const {\n      showTrendLine,\n      height,\n      kickerFontSize,\n      headerFontSize,\n      subheaderFontSize,\n    } = this.props;\n    const className = this.getClassName();\n\n    if (showTrendLine) {\n      const chartHeight = Math.floor(PROPORTION.TRENDLINE * height);\n      const allTextHeight = height - chartHeight;\n\n      return (\n        <div className={className}>\n          <div className=\"text-container\" style={{ height: allTextHeight }}>\n            {this.renderFallbackWarning()}\n            {this.renderKicker(\n              Math.ceil(kickerFontSize * (1 - PROPORTION.TRENDLINE) * height),\n            )}\n            {this.renderHeader(\n              Math.ceil(headerFontSize * (1 - PROPORTION.TRENDLINE) * height),\n            )}\n            {this.renderSubheader(\n              Math.ceil(\n                subheaderFontSize * (1 - PROPORTION.TRENDLINE) * height,\n              ),\n            )}\n          </div>\n          {this.renderTrendline(chartHeight)}\n        </div>\n      );\n    }\n\n    return (\n      <div className={className} style={{ height }}>\n        {this.renderFallbackWarning()}\n        {this.renderKicker(kickerFontSize * height)}\n        {this.renderHeader(Math.ceil(headerFontSize * height))}\n        {this.renderSubheader(Math.ceil(subheaderFontSize * height))}\n      </div>\n    );\n  }\n}\n\nexport default styled(BigNumberVis)`\n  ${({ theme }) => `\n    font-family: ${theme.typography.families.sansSerif};\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n\n    &.no-trendline .subheader-line {\n      padding-bottom: 0.3em;\n    }\n\n    .text-container {\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: flex-start;\n      .alert {\n        font-size: ${theme.typography.sizes.s};\n        margin: -0.5em 0 0.4em;\n        line-height: 1;\n        padding: ${theme.gridUnit}px;\n        border-radius: ${theme.gridUnit}px;\n      }\n    }\n\n    .kicker {\n      line-height: 1em;\n      padding-bottom: 2em;\n    }\n\n    .header-line {\n      position: relative;\n      line-height: 1em;\n      span {\n        position: absolute;\n        bottom: 0;\n      }\n    }\n\n    .subheader-line {\n      line-height: 1em;\n      padding-bottom: 0;\n    }\n\n    &.is-fallback-value {\n      .kicker,\n      .header-line,\n      .subheader-line {\n        opacity: ${theme.opacity.mediumHeavy};\n      }\n    }\n  `}\n`;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  useRef,\n  useEffect,\n  useMemo,\n  forwardRef,\n  useImperativeHandle,\n} from 'react';\nimport { styled } from '@superset-ui/core';\nimport { ECharts, init } from 'echarts';\nimport { EchartsHandler, EchartsProps, EchartsStylesProps } from '../types';\n\nconst Styles = styled.div<EchartsStylesProps>`\n  height: ${({ height }) => height};\n  width: ${({ width }) => width};\n`;\n\nfunction Echart(\n  {\n    width,\n    height,\n    echartOptions,\n    eventHandlers,\n    zrEventHandlers,\n    selectedValues = {},\n  }: EchartsProps,\n  ref: React.Ref<EchartsHandler>,\n) {\n  const divRef = useRef<HTMLDivElement>(null);\n  const chartRef = useRef<ECharts>();\n  const currentSelection = useMemo(\n    () => Object.keys(selectedValues) || [],\n    [selectedValues],\n  );\n  const previousSelection = useRef<string[]>([]);\n\n  useImperativeHandle(ref, () => ({\n    getEchartInstance: () => chartRef.current,\n  }));\n\n  useEffect(() => {\n    if (!divRef.current) return;\n    if (!chartRef.current) {\n      chartRef.current = init(divRef.current);\n    }\n\n    Object.entries(eventHandlers || {}).forEach(([name, handler]) => {\n      chartRef.current?.off(name);\n      chartRef.current?.on(name, handler);\n    });\n\n    Object.entries(zrEventHandlers || {}).forEach(([name, handler]) => {\n      chartRef.current?.getZr().off(name);\n      chartRef.current?.getZr().on(name, handler);\n    });\n\n    chartRef.current.setOption(echartOptions, true);\n  }, [echartOptions, eventHandlers, zrEventHandlers]);\n\n  // highlighting\n  useEffect(() => {\n    if (!chartRef.current) return;\n    chartRef.current.dispatchAction({\n      type: 'downplay',\n      dataIndex: previousSelection.current.filter(\n        value => !currentSelection.includes(value),\n      ),\n    });\n    if (currentSelection.length) {\n      chartRef.current.dispatchAction({\n        type: 'highlight',\n        dataIndex: currentSelection,\n      });\n    }\n    previousSelection.current = currentSelection;\n  }, [currentSelection]);\n\n  useEffect(() => {\n    if (chartRef.current) {\n      chartRef.current.resize({ width, height });\n    }\n  }, [width, height]);\n\n  return <Styles ref={divRef} height={height} width={width} />;\n}\n\nexport default forwardRef(Echart);\n"],"names":["defaultNumberFormatter","PROPORTION","BigNumberVis","getClassName","className","showTrendLine","bigNumberFallback","this","props","names","createTemporaryContainer","container","document","createElement","style","position","opacity","renderFallbackWarning","formatTime","showTimestamp","role","title","t","renderKicker","maxHeight","timestamp","width","text","body","append","fontSize","maxWidth","remove","height","renderHeader","bigNumber","headerFormatter","renderSubheader","subheader","NO_DATA_OR_HASNT_LANDED","NO_DATA","renderTrendline","trendLineData","echartOptions","some","d","Math","floor","render","kickerFontSize","headerFontSize","subheaderFontSize","chartHeight","allTextHeight","ceil","defaultProps","mainColor","startYAxisAtZero","timeRangeFixed","theme","typography","families","sansSerif","sizes","s","gridUnit","mediumHeavy","Styles","Echart","eventHandlers","zrEventHandlers","selectedValues","ref","divRef","useRef","chartRef","currentSelection","useMemo","Object","keys","previousSelection","useImperativeHandle","getEchartInstance","current","useEffect","entries","forEach","name","handler","off","on","getZr","setOption","dispatchAction","type","dataIndex","filter","value","includes","length","resize","forwardRef"],"sourceRoot":""}