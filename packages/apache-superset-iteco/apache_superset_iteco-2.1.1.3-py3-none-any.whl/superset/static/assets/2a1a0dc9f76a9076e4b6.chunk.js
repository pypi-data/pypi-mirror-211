"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[3588],{23588:(t,e,a)=>{a.r(e),a.d(e,{default:()=>v}),a(67294);var n=a(43323),r=a(11965),s=a(51995),i=a(15078),o=a.n(i),d=a(45697),l=a.n(d),c=a(28041),u=a.n(c),p=a(67190),g=a(51115),h=a(28062);const f={data:l().objectOf(l().arrayOf(l().shape({key:l().arrayOf(l().string),name:l().arrayOf(l().string),time:l().number,value:l().number}))),width:l().number,height:l().number,dateTimeFormat:l().string,numberFormat:l().string,useRichTooltip:l().bool,useAreaProportions:l().bool};function m(t){return{startAngle:t.startAngle,endAngle:t.endAngle,innerRadius:t.innerRadius,outerRadius:t.outerRadius}}function y(t,e){return t.value===e.value?t.name>e.name?1:-1:e.value-t.value}function I(t,e){const{data:a,width:n,height:r,colorScheme:s,dateTimeFormat:i,numberFormat:d,useRichTooltip:l,useAreaProportions:c,sliceId:f}=e,I=o().select(t);I.classed("superset-legacy-chart-rose",!0);const b=a,A=Object.keys(b).map((t=>parseInt(t,10))).sort(((t,e)=>t-e)),v=A.length,R=b[A[0]].length,w=(0,p.JB)(d),T=(0,g.bt)(i),k=h.getScale(s);o().select(".nvtooltip").remove(),I.selectAll("*").remove();const x=o().svg.arc(),O=u().models.legend(),$=u().models.tooltip(),S={disabled:b[A[0]].map((()=>!1))},N=I.append("svg").attr("width",n).attr("height",r).append("g").attr("class","rose").append("g"),M=N.append("g").attr("class","legendWrap");function J(t){return t[A[0]].map(((t,e)=>({disabled:S.disabled[e],key:t.name})))}O.width(n).color((t=>k(t.key,f))),M.datum(J(b)).call(O),$.headerFormatter(T).valueFormatter(w),$.classes("tooltip");const F=r-O.height(),L=O.height(),z=Math.min(n,F)/2-35,P=.075,W=`translate(${n/2},${F/2+L})`,Z=N.append("g").attr("transform",W).attr("class","roseWrap"),j=N.append("g").attr("transform",W).attr("class","labelsWrap"),C=N.append("g").attr("transform",W).attr("class","groupLabelsWrap");function K(t){let e=0,a=0;const n=[];for(const t of A){const r=b[t].reduce(((t,e,a)=>t+(S.disabled[a]?0:e.value)),0);e=r>e?r:e,n[a]=r,a+=1}const r=2*Math.PI/v,s=[];for(let t=0;t<=v;t+=1)s.push(r*t-Math.PI/2);const i=z/e,o=i*z,d=(t,e)=>c?Math.sqrt(o*t+e*e):i*t+e,l={data:[],extend:{},push:{},pieStart:{},pie:{},pieOver:{},mini:{},labels:[],groupLabels:[]};let u=0;for(let e=0;e<v;e+=1){const a=A[e],r=s[e],i=s[e+1],o=2*Math.PI/n[e];let c,p,g=0,h=0;for(const e of t[a]){const t=S.disabled[u%R]?0:e.value,{name:a,time:n}=e;e.id=u,c=d(t,g),l.data.push({startAngle:r,endAngle:i,innerRadius:g,outerRadius:c,name:a,arcId:u,val:t,time:n}),l.extend[u]={startAngle:r,endAngle:i,innerRadius:g,name:a,outerRadius:c+8},l.push[u]={startAngle:r,endAngle:i,innerRadius:g+8,outerRadius:c+8},l.pieStart[u]={startAngle:r,endAngle:i,innerRadius:P*z,outerRadius:z},l.mini[u]={startAngle:r,endAngle:i,innerRadius:g*P,outerRadius:c*P},u+=1,g=c}const f={...l.data[e*R]};f.outerRadius=z+20,f.innerRadius=z+15,l.labels.push(f);for(const r of t[a].concat().sort(y))p=o*(S.disabled[r.id%R]?0:r.value)+h,l.pie[r.id]={startAngle:h,endAngle:p,innerRadius:z*P,outerRadius:z,percent:r.value/n[e]},l.pieOver[r.id]={startAngle:h,endAngle:p,innerRadius:z*P,outerRadius:z+8},h=p}return l.groupLabels=l.data.slice(0,R),l}let B=K(b);function q(t,e){return function(a){const n=o().interpolate(m(a),m(t));return t=>e(Object.assign(a,n(t)))}}function D(t){return q(t,(t=>x(t)))}function G(t){return q(t,(t=>`translate(${x.centroid(t)})`))}const U={};function E(t){if(U[t])return U[t];const e=Math.floor(t/R);return U[t]=[t+1,R*(e+1)-1],U[t]}const H={};function Q(t){if(H[t])return H[t];const e=Math.floor(t/R);return H[t]=[e*R,(e+1)*R-1],H[t]}let V=-1,X=!1;const Y=Z.selectAll("g").data(JSON.parse(JSON.stringify(B.data))).enter().append("g").attr("class","segment").classed("clickable",!0).on("mouseover",(function(t,e){$.data(function(t,e,a){const n=Math.floor(t.arcId/R),r=l?a[A[n]].filter((t=>!S.disabled[t.id%R])).map((e=>({key:e.name,value:e.value,color:k(e.name,f),highlight:e.id===t.arcId}))):[{key:t.name,value:t.val,color:k(t.name,f)}];return{key:"Date",value:t.time,series:r}}(t,0,b)).hidden(!1);const a=o().select(this);if(a.classed("hover",!0),V<0&&!X){a.select("path").interrupt().transition().duration(180).attrTween("d",D(B.extend[e]));const t=E(e);et.filter((e=>t[0]<=e.arcId&&e.arcId<=t[1])).interrupt().transition().duration(180).attrTween("d",(t=>D(B.push[t.arcId])(t)))}else if(!X){const n=Q(V);n[0]<=t.arcId&&t.arcId<=n[1]&&a.select("path").interrupt().transition().duration(180).attrTween("d",D(B.pieOver[e]))}})).on("mouseout",(function(t,e){$.hidden(!0);const a=o().select(this);if(a.classed("hover",!1),V<0&&!X){a.select("path").interrupt().transition().duration(180).attrTween("d",D(B.data[e]));const t=E(e);et.filter((e=>t[0]<=e.arcId&&e.arcId<=t[1])).interrupt().transition().duration(180).attrTween("d",(t=>D(B.data[t.arcId])(t)))}else if(!X){const n=Q(V);n[0]<=t.arcId&&t.arcId<=n[1]&&a.select("path").interrupt().transition().duration(180).attrTween("d",D(B.pie[e]))}})).on("mousemove",(function(){$()})).on("click",(function(t,e){if(X)return;const a=o().event.altKey?3750:375,n=Q(e);if(V<0)X=!0,V=e,_.interrupt().transition().duration(a).attrTween("transform",(t=>G({outerRadius:0,innerRadius:0,startAngle:t.startAngle,endAngle:t.endAngle})(t))).style("opacity",0),tt.attr("transform",`translate(${x.centroid({outerRadius:z+20,innerRadius:z+15,startAngle:B.data[e].startAngle,endAngle:B.data[e].endAngle})})`).interrupt().transition().delay(a).duration(a).attrTween("transform",(t=>G({outerRadius:z+20,innerRadius:z+15,startAngle:B.pie[n[0]+t.arcId].startAngle,endAngle:B.pie[n[0]+t.arcId].endAngle})(t))).style("opacity",(t=>S.disabled[t.arcId]||B.pie[n[0]+t.arcId].percent<.05?0:1)),Y.classed("clickable",(t=>n[0]>t.arcId||t.arcId>n[1])),et.filter((t=>n[0]<=t.arcId&&t.arcId<=n[1])).interrupt().transition().duration(a).attrTween("d",(t=>D(B.pieStart[t.arcId])(t))).transition().duration(a).attrTween("d",(t=>D(B.pie[t.arcId])(t))).each("end",(()=>{X=!1})),et.filter((t=>n[0]>t.arcId||t.arcId>n[1])).interrupt().transition().duration(a).attrTween("d",(t=>D(B.mini[t.arcId])(t)));else if(V<n[0]||n[1]<V){X=!0;const t=Q(V);_.interrupt().transition().delay(a).duration(a).attrTween("transform",(t=>G(B.labels[t.arcId/R])(t))).style("opacity",1),tt.interrupt().transition().duration(a).attrTween("transform",G({outerRadius:z+20,innerRadius:z+15,startAngle:B.data[V].startAngle,endAngle:B.data[V].endAngle})).style("opacity",0),Y.classed("clickable",!0),et.filter((e=>t[0]<=e.arcId&&e.arcId<=t[1])).interrupt().transition().duration(a).attrTween("d",(t=>D(B.pieStart[t.arcId])(t))).transition().duration(a).attrTween("d",(t=>D(B.data[t.arcId])(t))).each("end",(()=>{V=-1,X=!1})),et.filter((e=>t[0]>e.arcId||e.arcId>t[1])).interrupt().transition().delay(a).duration(a).attrTween("d",(t=>D(B.data[t.arcId])(t)))}})),_=j.selectAll("g").data(JSON.parse(JSON.stringify(B.labels))).enter().append("g").attr("class","roseLabel").attr("transform",(t=>`translate(${x.centroid(t)})`));_.append("text").style("text-anchor","middle").style("fill","#000").text((t=>T(t.time)));const tt=C.selectAll("g").data(JSON.parse(JSON.stringify(B.groupLabels))).enter().append("g");tt.style("opacity",0).attr("class","roseGroupLabels").append("text").style("text-anchor","middle").style("fill","#000").text((t=>t.name));const et=Y.append("path").attr("class","arc").attr("fill",(t=>k(t.name,f))).attr("d",x);O.dispatch.on("stateChange",(t=>{S.disabled!==t.disabled&&(S.disabled=t.disabled,function(){const t=o().event.altKey?3e3:300;M.datum(J(b)).call(O);const e=K(b);if(X=!0,V<0)et.style("opacity",1).interrupt().transition().duration(t).attrTween("d",(t=>D(e.data[t.arcId])(t))).each("end",(()=>{X=!1,B=e})).transition().duration(0).style("opacity",(t=>S.disabled[t.arcId%R]?0:1));else{const a=Q(V);et.style("opacity",1).interrupt().transition().duration(t).attrTween("d",(t=>a[0]<=t.arcId&&t.arcId<=a[1]?D(e.pie[t.arcId])(t):D(e.mini[t.arcId])(t))).each("end",(()=>{X=!1,B=e})).transition().duration(0).style("opacity",(t=>S.disabled[t.arcId%R]?0:1)),tt.interrupt().transition().duration(t).attrTween("transform",(t=>G({outerRadius:z+20,innerRadius:z+15,startAngle:e.pie[a[0]+t.arcId].startAngle,endAngle:e.pie[a[0]+t.arcId].endAngle})(t))).style("opacity",(t=>S.disabled[t.arcId]||B.pie[a[0]+t.arcId].percent<.05?0:1))}}())}))}I.displayName="Rose",I.propTypes=f;const b=I,A=(0,n.Z)(b),v=(0,s.iK)((({className:t,...e})=>(0,r.tZ)("div",{className:t},(0,r.tZ)(r.xB,{styles:t=>r.iv`
        .tooltip {
          line-height: 1;
          padding: ${3*t.gridUnit}px;
          background: ${t.colors.grayscale.dark2};
          color: ${t.colors.grayscale.light5};
          border-radius: 4px;
          pointer-events: none;
          z-index: 1000;
          font-size: ${t.typography.sizes.s}px;
        }
      `}),(0,r.tZ)(A,e))))`
  ${({theme:t})=>`\n    .superset-legacy-chart-rose path {\n        transition: fill-opacity 180ms linear;\n        stroke: ${t.colors.grayscale.light5};\n        stroke-width: 1px;\n        stroke-opacity: 1;\n        fill-opacity: 0.75;\n    }\n\n    .superset-legacy-chart-rose text {\n        font-weight: ${t.typography.weights.normal};\n        font-size: ${t.typography.sizes.s}px;\n        font-family: ${t.typography.families.sansSerif};\n        pointer-events: none;\n    }\n\n    .superset-legacy-chart-rose .clickable path {\n        cursor: pointer;\n    }\n\n    .superset-legacy-chart-rose .hover path {\n        fill-opacity: 1;\n    }\n\n    .nv-legend .nv-series {\n        cursor: pointer;\n    }\n  `}
`}}]);
//# sourceMappingURL=2a1a0dc9f76a9076e4b6.chunk.js.map