/*
 * Copyright 2023 Jussi Pakkanen
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

#pragma once

#include <stdint.h>

#mesondefine A4PDF_VERSION_STR

#if defined _WIN32
#ifdef BUILDING_A4PDF
#define A4PDF_PUBLIC __declspec(dllexport)
#else
#define A4PDF_PUBLIC __declspec(dllimport)
#endif
#else
#ifdef BUILDING_A4PDF
#define A4PDF_PUBLIC __attribute__((visibility("default")))
#else
#define A4PDF_PUBLIC
#endif
#endif

#ifdef __cplusplus
#define A4PDF_NOEXCEPT noexcept
extern "C" {
#else
#define A4PDF_NOEXCEPT
#endif

// FIXME: canonicalize the appearance of enums.

enum A4PDF_Builtin_Fonts {
    A4PDF_FONT_TIMES_ROMAN,
    A4PDF_FONT_HELVETICA,
    A4PDF_FONT_COURIER,
    A4PDF_FONT_TIMES_ROMAN_BOLD,
    A4PDF_FONT_HELVETICA_BOLD,
    A4PDF_FONT_COURIER_BOLD,
    A4PDF_FONT_TIMES_ROMAN_ITALIC,
    A4PDF_FONT_HELVETICA_OBLIQUE,
    A4PDF_FONT_COURIER_OBLIQUE,
};

enum A4PDF_Colorspace { A4PDF_DEVICE_RGB, A4PDF_DEVICE_GRAY, A4PDF_DEVICE_CMYK };

enum A4PDF_Rendering_Intent {
    A4PDF_RI_RELATIVE_COLORIMETRIC,
    A4PDF_RI_ABSOLUTE_COLORIMETRIC,
    A4PDF_RI_SATURATION,
    A4PDF_RI_PERCEPTUAL
};

enum A4PDF_Text_Rendering_Mode {
    A4PDF_Text_Fill,
    A4PDF_Text_Stroke,
    A4PDF_Text_Fill_Stroke,
    A4PDF_Text_Invisible,
    A4PDF_Text_Fill_Clip,
    A4PDF_Text_Stroke_Clip,
    A4PDF_Text_Fill_Stroke_Clip,
    A4PDF_Text_Clip,
};

enum A4PDF_Blend_Mode {
    A4PDF_BM_NORMAL,
    A4PDF_BM_MULTIPLY,
    A4PDF_BM_SCREEN,
    A4PDF_BM_OVERLAY,
    A4PDF_BM_DARKEN,
    A4PDF_BM_LIGHTEN,
    A4PDF_BM_COLORDODGE,
    A4PDF_BM_COLORBURN,
    A4PDF_BM_HARDLIGHT,
    A4PDF_BM_SOFTLIGHT,
    A4PDF_BM_DIFFERENCE,
    A4PDF_BM_EXCLUSION,
    A4PDF_BM_HUE,
    A4PDF_BM_SATURATION,
    A4PDF_BM_COLOR,
    A4PDF_BM_LUMINOSITY,
};

enum A4PDF_Line_Cap { A4PDF_Butt_Cap, A4PDF_Round_Cap, A4PDF_Projection_Square_Cap };

enum A4PDF_Line_Join {
    A4PDF_Miter_Join,
    A4PDF_Round_Join,
    A4PDF_Bevel_Join,
};

enum A4PDF_Draw_Context_Type {
    A4PDF_Page_Context,
    A4PDF_Color_Tiling_Pattern_Context,
    A4PDF_Uncolored_Tiling_Pattern_Context,
    A4PDF_Form_XObject_Context,
};

enum A4PDF_Page_Transition_Type {
    A4PDF_PAGE_TRANSITION_SPLIT,
    A4PDF_PAGE_TRANSITION_BLINDS,
    A4PDF_PAGE_TRANSITION_BOX,
    A4PDF_PAGE_TRANSITION_WIPE,
    A4PDF_PAGE_TRANSITION_DISSOLVE,
    A4PDF_PAGE_TRANSITION_GLITTER,
    A4PDF_PAGE_TRANSITION_R,
    A4PDF_PAGE_TRANSITION_FLY,
    A4PDF_PAGE_TRANSITION_PUSH,
    A4PDF_PAGE_TRANSITION_COVER,
    A4PDF_PAGE_TRANSITION_UNCOVER,
    A4PDF_PAGE_TRANSITION_FADE,
};

typedef struct _A4PDF_Options A4PDF_Options;
typedef struct _A4PDF_Generator A4PDF_Generator;
typedef struct _A4PDF_DrawContext A4PDF_DrawContext;
typedef struct _A4PDF_Text A4PDF_Text;
typedef struct _A4PDF_Page_Transition A4PDF_Page_Transition;

typedef int32_t A4PDF_EC;

typedef struct {
    int32_t id;
} A4PDF_ImageId;

typedef struct {
    int32_t id;
} A4PDF_FontId;

typedef struct {
    int32_t id;
} A4PDF_IccColorSpaceId;

typedef struct {
    int32_t id;
} A4PDF_FormXObjectId;

typedef struct {
    int32_t id;
} A4PDF_FormWidgetId;

typedef struct {
    int32_t id;
} A4PDF_EmbeddedFileId;

typedef struct {
    int32_t id;
} A4PDF_AnnotationId;

typedef struct {
    int32_t id;
} A4PDF_StructureItemId;

// Options

A4PDF_PUBLIC A4PDF_EC a4pdf_options_new(A4PDF_Options **out_ptr) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_options_destroy(A4PDF_Options *) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_options_set_title(A4PDF_Options *opt,
                                              const char *utf8_title) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_options_set_author(A4PDF_Options *opt,
                                               const char *utf8_author) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_options_set_mediabox(
    A4PDF_Options *opt, double x, double y, double w, double h) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_options_set_colorspace(A4PDF_Options *opt,
                                                   enum A4PDF_Colorspace cs) A4PDF_NOEXCEPT;

// Generator

A4PDF_PUBLIC A4PDF_EC a4pdf_generator_new(const char *filename,
                                          const A4PDF_Options *options,
                                          A4PDF_Generator **out_ptr) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_generator_add_page(A4PDF_Generator *g,
                                               A4PDF_DrawContext *ctx) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_generator_embed_jpg(A4PDF_Generator *g,
                                                const char *fname,
                                                A4PDF_ImageId *iid) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_generator_load_font(A4PDF_Generator *g,
                                                const char *fname,
                                                A4PDF_FontId *fid) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_generator_load_image(A4PDF_Generator *g,
                                                 const char *fname,
                                                 A4PDF_ImageId *iid) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_generator_load_icc_profile(A4PDF_Generator *g,
                                                       const char *fname,
                                                       A4PDF_IccColorSpaceId *iid) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_generator_write(A4PDF_Generator *g) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_generator_destroy(A4PDF_Generator *g) A4PDF_NOEXCEPT;

// Probably not final API.
A4PDF_PUBLIC A4PDF_EC a4pdf_generator_utf8_text_width(A4PDF_Generator *g,
                                                      const char *utf8_text,
                                                      A4PDF_FontId font,
                                                      double pointsize,
                                                      double *width) A4PDF_NOEXCEPT;

// Draw context

A4PDF_PUBLIC A4PDF_EC a4pdf_page_draw_context_new(A4PDF_Generator *g,
                                                  A4PDF_DrawContext **out_ptr) A4PDF_NOEXCEPT;

A4PDF_PUBLIC A4PDF_EC a4pdf_dc_cmd_B(A4PDF_DrawContext *ctx) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_dc_cmd_Bstar(A4PDF_DrawContext *ctx) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_dc_cmd_c(A4PDF_DrawContext *ctx,
                                     double x1,
                                     double y1,
                                     double x2,
                                     double y2,
                                     double x3,
                                     double y3) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_dc_cmd_cm(A4PDF_DrawContext *ctx,
                                      double m1,
                                      double m2,
                                      double m3,
                                      double m4,
                                      double m5,
                                      double m6) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_dc_cmd_f(A4PDF_DrawContext *ctx) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_dc_cmd_h(A4PDF_DrawContext *ctx) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_dc_cmd_j(A4PDF_DrawContext *ctx,
                                     enum A4PDF_Line_Join join_style) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_dc_cmd_J(A4PDF_DrawContext *ctx,
                                     enum A4PDF_Line_Cap cap_style) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_dc_cmd_k(A4PDF_DrawContext *ctx, double c, double m, double y, double k)
    A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_dc_cmd_K(A4PDF_DrawContext *ctx, double c, double m, double y, double k)
    A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_dc_cmd_l(A4PDF_DrawContext *ctx, double x, double y) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_dc_cmd_m(A4PDF_DrawContext *ctx, double x, double y) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_dc_cmd_q(A4PDF_DrawContext *ctx) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_dc_cmd_Q(A4PDF_DrawContext *ctx) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_dc_cmd_RG(A4PDF_DrawContext *ctx, double r, double g, double b)
    A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_dc_cmd_rg(A4PDF_DrawContext *ctx, double r, double g, double b)
    A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC
a4pdf_dc_cmd_re(A4PDF_DrawContext *ctx, double x, double y, double w, double h) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_dc_cmd_S(A4PDF_DrawContext *ctx) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_dc_cmd_w(A4PDF_DrawContext *ctx, double line_width) A4PDF_NOEXCEPT;

A4PDF_PUBLIC A4PDF_EC a4pdf_dc_set_icc_stroke(A4PDF_DrawContext *ctx,
                                              A4PDF_IccColorSpaceId icc_id,
                                              double *values,
                                              int32_t num_values) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_dc_set_icc_nonstroke(A4PDF_DrawContext *ctx,
                                                 A4PDF_IccColorSpaceId icc_id,
                                                 double *values,
                                                 int32_t num_values) A4PDF_NOEXCEPT;

A4PDF_PUBLIC A4PDF_EC a4pdf_dc_draw_image(A4PDF_DrawContext *ctx, A4PDF_ImageId iid) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_dc_render_utf8_text(A4PDF_DrawContext *ctx,
                                                const char *text,
                                                A4PDF_FontId fid,
                                                double point_size,
                                                double x,
                                                double y) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_dc_render_text_obj(A4PDF_DrawContext *ctx,
                                               A4PDF_Text *text) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_dc_set_page_transition(
    A4PDF_DrawContext *dc, A4PDF_Page_Transition *transition) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_dc_destroy(A4PDF_DrawContext *) A4PDF_NOEXCEPT;

// Text

A4PDF_PUBLIC A4PDF_EC a4pdf_text_new(A4PDF_Text **out_ptr) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_text_destroy(A4PDF_Text *text) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_text_render_utf8_text(A4PDF_Text *text,
                                                  const char *utf8_text) A4PDF_NOEXCEPT;

A4PDF_PUBLIC A4PDF_EC a4pdf_text_cmd_Tc(A4PDF_Text *text, double spacing) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_text_cmd_Td(A4PDF_Text *text, double x, double y) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_text_cmd_Tf(A4PDF_Text *text,
                                        A4PDF_FontId font,
                                        double pointsize) A4PDF_NOEXCEPT;

// Transition
A4PDF_PUBLIC A4PDF_EC a4pdf_page_transition_new(A4PDF_Page_Transition **out_ptr,
                                                enum A4PDF_Page_Transition_Type type,
                                                double duration) A4PDF_NOEXCEPT;
A4PDF_PUBLIC A4PDF_EC a4pdf_page_transition_destroy(A4PDF_Page_Transition *transition)
    A4PDF_NOEXCEPT;

// Error

A4PDF_PUBLIC const char *a4pdf_error_message(A4PDF_EC error_code) A4PDF_NOEXCEPT;

#ifdef __cplusplus
}
#endif
