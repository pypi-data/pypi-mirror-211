{"version":3,"file":"chunks/app_components_replays_replayPlayer_tsx-app_utils_replays_hooks_useReplayData_tsx-app_views_r-3cccf4.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/components/replays/player/bufferingOverlay.tsx","webpack:///./app/components/replays/player/fastForwardBadge.tsx","webpack:///./app/components/replays/playerDOMAlert.tsx","webpack:///./app/components/replays/replayPlayer.tsx","webpack:///./app/utils/replays/replayReader.tsx","webpack:///./app/utils/replays/splitAttachmentsByType.tsx","webpack:///./app/utils/replays/hooks/useReplayData.tsx","webpack:///./app/utils/useDismissAlert.tsx","webpack:///./app/views/replays/detail/layout/fluidHeight.tsx"],"sourcesContent":["import styled from '@emotion/styled';\n\nimport {IconClock} from 'sentry/icons';\nimport {t} from 'sentry/locale';\nimport {space} from 'sentry/styles/space';\n\ntype Props = {\n  className?: string;\n};\n\nfunction BufferingOverlay({className}: Props) {\n  return (\n    <Overlay className={className}>\n      <Message>\n        <IconClock size=\"sm\" />\n        {t('Buffering...')}\n      </Message>\n    </Overlay>\n  );\n}\n\n/* Position the badge in the corner */\nconst Overlay = styled('div')`\n  user-select: none;\n  display: grid;\n  place-items: center;\n`;\n\n/* Badge layout and style */\nconst Message = styled('div')`\n  display: grid;\n  grid-template-columns: max-content max-content;\n  gap: ${space(0.75)};\n  place-items: center;\n\n  padding: ${space(3)};\n  background: ${p => p.theme.gray300};\n  border-radius: ${p => p.theme.borderRadius};\n  color: ${p => p.theme.white};\n  z-index: ${p => p.theme.zIndex.initial};\n`;\n\nexport default BufferingOverlay;\n","import styled from '@emotion/styled';\n\nimport {Tooltip} from 'sentry/components/tooltip';\nimport {IconArrow} from 'sentry/icons';\nimport {t} from 'sentry/locale';\nimport {space} from 'sentry/styles/space';\n\ntype Props = {\n  speed: number;\n  className?: string;\n};\n\nfunction FastForwardBadge({speed, className}: Props) {\n  return (\n    <Badge className={className}>\n      <FastForwardTooltip title={t('Fast forwarding at %sx', speed)}>\n        {t('Fast forwarding through inactivity')}\n        <IconArrow size=\"sm\" direction=\"right\" />\n      </FastForwardTooltip>\n    </Badge>\n  );\n}\n\n/* Position the badge in the corner */\nconst Badge = styled('div')`\n  user-select: none;\n  display: grid;\n  align-items: end;\n  justify-items: start;\n`;\n\n/* Badge layout and style */\nconst FastForwardTooltip = styled(Tooltip)`\n  display: grid;\n  grid-template-columns: max-content max-content;\n  gap: ${space(0.5)};\n  align-items: center;\n\n  background: ${p => p.theme.gray300};\n  color: ${p => p.theme.white};\n  padding: ${space(1.5)} ${space(2)};\n  border-top-right-radius: ${p => p.theme.borderRadius};\n  z-index: ${p => p.theme.zIndex.initial};\n`;\n\nexport default FastForwardBadge;\n","import styled from '@emotion/styled';\n\nimport {Button} from 'sentry/components/button';\nimport {IconClose, IconInfo} from 'sentry/icons';\nimport {t} from 'sentry/locale';\nimport {space} from 'sentry/styles/space';\nimport useDismissAlert from 'sentry/utils/useDismissAlert';\n\nconst LOCAL_STORAGE_KEY = 'replay-player-dom-alert-dismissed';\n\nfunction PlayerDOMAlert() {\n  const {dismiss, isDismissed} = useDismissAlert({key: LOCAL_STORAGE_KEY});\n\n  if (isDismissed) {\n    return null;\n  }\n\n  return (\n    <DOMAlertContainer data-test-id=\"player-dom-alert\">\n      <DOMAlert>\n        <StyledIconInfo size=\"xs\" />\n        <div>{t('Right click & inspect your app’s DOM with your browser')}</div>\n        <DismissButton\n          priority=\"link\"\n          size=\"sm\"\n          icon={<IconClose size=\"xs\" />}\n          aria-label={t('Close Alert')}\n          onClick={dismiss}\n        />\n      </DOMAlert>\n    </DOMAlertContainer>\n  );\n}\n\nexport default PlayerDOMAlert;\n\nconst DOMAlertContainer = styled('div')`\n  position: absolute;\n  bottom: ${space(1)};\n  left: 0;\n  width: 100%;\n  text-align: center;\n  font-size: ${p => p.theme.fontSizeMedium};\n  pointer-events: none;\n`;\n\nconst DOMAlert = styled('div')`\n  display: inline-flex;\n  align-items: flex-start;\n  justify-items: center;\n  padding: ${space(1)} ${space(2)};\n  margin: 0 ${space(1)};\n  color: ${p => p.theme.white};\n  background-color: ${p => p.theme.blue400};\n  border-radius: ${p => p.theme.borderRadius};\n  gap: 0 ${space(1)};\n  line-height: 1em;\n`;\n\nconst StyledIconInfo = styled(IconInfo)`\n  margin-top: 1px;\n  min-width: 12px; /* Prevnt the icon from scaling down whenever text wraps */\n`;\n\nconst DismissButton = styled(Button)`\n  color: ${p => p.theme.white};\n  pointer-events: all;\n  &:hover {\n    color: ${p => p.theme.white};\n    opacity: 0.5;\n  }\n`;\n","import {useCallback, useEffect, useRef, useState} from 'react';\nimport styled from '@emotion/styled';\nimport {useResizeObserver} from '@react-aria/utils';\n\nimport LoadingIndicator from 'sentry/components/loadingIndicator';\nimport {Panel as _Panel} from 'sentry/components/panels';\nimport BufferingOverlay from 'sentry/components/replays/player/bufferingOverlay';\nimport FastForwardBadge from 'sentry/components/replays/player/fastForwardBadge';\nimport {useReplayContext} from 'sentry/components/replays/replayContext';\nimport {trackAnalytics} from 'sentry/utils/analytics';\nimport useOrganization from 'sentry/utils/useOrganization';\n\nimport PlayerDOMAlert from './playerDOMAlert';\n\ntype Dimensions = ReturnType<typeof useReplayContext>['dimensions'];\n\ninterface Props {\n  className?: string;\n  isPreview?: boolean;\n}\n\nfunction useVideoSizeLogger({\n  videoDimensions,\n  windowDimensions,\n}: {\n  videoDimensions: Dimensions;\n  windowDimensions: Dimensions;\n}) {\n  const organization = useOrganization();\n  const [didLog, setDidLog] = useState<boolean>(false);\n  useEffect(() => {\n    if (didLog || (videoDimensions.width === 0 && videoDimensions.height === 0)) {\n      return;\n    }\n\n    const aspect_ratio =\n      videoDimensions.width > videoDimensions.height ? 'landscape' : 'portrait';\n\n    const scale = Math.min(\n      windowDimensions.width / videoDimensions.width,\n      windowDimensions.height / videoDimensions.height,\n      1\n    );\n    const scale_bucket = (Math.floor(scale * 10) * 10) as Parameters<\n      typeof trackAnalytics<'replay.render-player'>\n    >[1]['scale_bucket'];\n\n    trackAnalytics('replay.render-player', {\n      organization,\n      aspect_ratio,\n      scale_bucket,\n    });\n    setDidLog(true);\n  }, [organization, windowDimensions, videoDimensions, didLog]);\n}\n\nfunction BasePlayerRoot({className, isPreview = false}: Props) {\n  const {\n    dimensions: videoDimensions,\n    fastForwardSpeed,\n    initRoot,\n    isBuffering,\n    isFetching,\n  } = useReplayContext();\n\n  const windowEl = useRef<HTMLDivElement>(null);\n  const viewEl = useRef<HTMLDivElement>(null);\n\n  const [windowDimensions, setWindowDimensions] = useState<Dimensions>({\n    width: 0,\n    height: 0,\n  });\n\n  useVideoSizeLogger({videoDimensions, windowDimensions});\n\n  // Create the `rrweb` instance which creates an iframe inside `viewEl`\n  useEffect(() => initRoot(viewEl.current), [initRoot]);\n\n  // Read the initial width & height where the player will be inserted, this is\n  // so we can shrink the video into the available space.\n  // If the size of the container changes, we can re-calculate the scaling factor\n  const updateWindowDimensions = useCallback(\n    () =>\n      setWindowDimensions({\n        width: windowEl.current?.clientWidth || 0,\n        height: windowEl.current?.clientHeight || 0,\n      }),\n    [setWindowDimensions]\n  );\n  useResizeObserver({ref: windowEl, onResize: updateWindowDimensions});\n  // If your browser doesn't have ResizeObserver then set the size once.\n  useEffect(() => {\n    if (typeof window.ResizeObserver !== 'undefined') {\n      return;\n    }\n    updateWindowDimensions();\n  }, [updateWindowDimensions]);\n\n  // Update the scale of the view whenever dimensions have changed.\n  useEffect(() => {\n    if (viewEl.current) {\n      const scale = Math.min(\n        windowDimensions.width / videoDimensions.width,\n        windowDimensions.height / videoDimensions.height,\n        1\n      );\n      if (scale) {\n        viewEl.current.style['transform-origin'] = 'top left';\n        viewEl.current.style.transform = `scale(${scale})`;\n        viewEl.current.style.width = `${videoDimensions.width * scale}px`;\n        viewEl.current.style.height = `${videoDimensions.height * scale}px`;\n      }\n    }\n  }, [windowDimensions, videoDimensions]);\n\n  return (\n    <SizingWindow ref={windowEl} className=\"sentry-block\">\n      <div ref={viewEl} className={className} />\n      {fastForwardSpeed ? <PositionedFastForward speed={fastForwardSpeed} /> : null}\n      {isBuffering ? <PositionedBuffering /> : null}\n      {isPreview ? null : <PlayerDOMAlert />}\n      {isFetching ? <PositionedLoadingIndicator /> : null}\n    </SizingWindow>\n  );\n}\n\n// Center the viewEl inside the windowEl.\n// This is useful when the window is inside a container that has large fixed\n// dimensions, like when in fullscreen mode.\n// If the container has a dimensions that can grow/shrink then it is\n// important to also set `overflow: hidden` on the container, so that the\n// SizingWindow can calculate size as things shrink.\nconst SizingWindow = styled('div')`\n  width: 100%;\n  display: flex;\n  flex-grow: 1;\n  justify-content: center;\n  align-items: center;\n  position: relative;\n  overflow: hidden;\n\n  background-color: ${p => p.theme.backgroundSecondary};\n  background-image: repeating-linear-gradient(\n      -145deg,\n      transparent,\n      transparent 8px,\n      ${p => p.theme.backgroundSecondary} 8px,\n      ${p => p.theme.backgroundSecondary} 11px\n    ),\n    repeating-linear-gradient(\n      -45deg,\n      transparent,\n      transparent 15px,\n      ${p => p.theme.gray100} 15px,\n      ${p => p.theme.gray100} 16px\n    );\n`;\n\nconst PositionedFastForward = styled(FastForwardBadge)`\n  position: absolute;\n  left: 0;\n  bottom: 0;\n`;\n\nconst PositionedBuffering = styled(BufferingOverlay)`\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n`;\n\nconst PositionedLoadingIndicator = styled(LoadingIndicator)`\n  position: absolute;\n`;\n\n// Base styles, to make the Replayer instance work\nconst PlayerRoot = styled(BasePlayerRoot)`\n  .replayer-wrapper {\n    user-select: none;\n  }\n\n  .replayer-wrapper > .replayer-mouse {\n    pointer-events: none;\n  }\n  .replayer-wrapper > .replayer-mouse-tail {\n    position: absolute;\n    pointer-events: none;\n  }\n\n  /* Override default user-agent styles */\n  .replayer-wrapper > iframe {\n    border: none;\n    background: white;\n\n    /* Set pointer-events to make it easier to right-click & inspect */\n    pointer-events: initial !important;\n  }\n`;\n\n// Sentry-specific styles for the player.\n// The elements we have to work with are:\n// ```css\n// div.replayer-wrapper {}\n// div.replayer-wrapper > div.replayer-mouse {}\n// div.replayer-wrapper > canvas.replayer-mouse-tail {}\n// div.replayer-wrapper > iframe {}\n// ```\n// The mouse-tail is also configured for color/size in `app/components/replays/replayContext.tsx`\nconst SentryPlayerRoot = styled(PlayerRoot)`\n  .replayer-mouse {\n    position: absolute;\n    width: 32px;\n    height: 32px;\n    transition: left 0.05s linear, top 0.05s linear;\n    background-size: contain;\n    background-repeat: no-repeat;\n    background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTkiIHZpZXdCb3g9IjAgMCAxMiAxOSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTAgMTZWMEwxMS42IDExLjZINC44TDQuNCAxMS43TDAgMTZaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNOS4xIDE2LjdMNS41IDE4LjJMMC43OTk5OTkgNy4xTDQuNSA1LjZMOS4xIDE2LjdaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNNC42NzQ1MSA4LjYxODUxTDIuODMwMzEgOS4zOTI3MUw1LjkyNzExIDE2Ljc2OTVMNy43NzEzMSAxNS45OTUzTDQuNjc0NTEgOC42MTg1MVoiIGZpbGw9ImJsYWNrIi8+CjxwYXRoIGQ9Ik0xIDIuNFYxMy42TDQgMTAuN0w0LjQgMTAuNkg5LjJMMSAyLjRaIiBmaWxsPSJibGFjayIvPgo8L3N2Zz4K');\n    border-color: transparent;\n  }\n  .replayer-mouse:after {\n    content: '';\n    display: inline-block;\n    width: 32px;\n    height: 32px;\n    background: ${p => p.theme.purple300};\n    border-radius: 100%;\n    transform: translate(-50%, -50%);\n    opacity: 0.3;\n  }\n  .replayer-mouse.active:after {\n    animation: click 0.2s ease-in-out 1;\n  }\n  .replayer-mouse.touch-device {\n    background-image: none;\n    width: 70px;\n    height: 70px;\n    border-radius: 100%;\n    margin-left: -37px;\n    margin-top: -37px;\n    border: 4px solid rgba(73, 80, 246, 0);\n    transition: left 0s linear, top 0s linear, border-color 0.2s ease-in-out;\n  }\n  .replayer-mouse.touch-device.touch-active {\n    border-color: ${p => p.theme.purple200};\n    transition: left 0.25s linear, top 0.25s linear, border-color 0.2s ease-in-out;\n  }\n  .replayer-mouse.touch-device:after {\n    opacity: 0;\n  }\n  .replayer-mouse.touch-device.active:after {\n    animation: touch-click 0.2s ease-in-out 1;\n  }\n  @keyframes click {\n    0% {\n      opacity: 0.3;\n      width: 20px;\n      height: 20px;\n    }\n    50% {\n      opacity: 0.5;\n      width: 10px;\n      height: 10px;\n    }\n  }\n  @keyframes touch-click {\n    0% {\n      opacity: 0;\n      width: 20px;\n      height: 20px;\n    }\n    50% {\n      opacity: 0.5;\n      width: 10px;\n      height: 10px;\n    }\n  }\n`;\n\nexport default SentryPlayerRoot;\n","import * as Sentry from '@sentry/react';\nimport memoize from 'lodash/memoize';\nimport {duration} from 'moment';\n\nimport type {Crumb} from 'sentry/types/breadcrumbs';\nimport {BreadcrumbType} from 'sentry/types/breadcrumbs';\nimport {\n  breadcrumbFactory,\n  replayTimestamps,\n  rrwebEventListFactory,\n  spansFactory,\n} from 'sentry/utils/replays/replayDataUtils';\nimport splitAttachmentsByType from 'sentry/utils/replays/splitAttachmentsByType';\nimport type {\n  MemorySpan,\n  NetworkSpan,\n  RecordingEvent,\n  RecordingOptions,\n  ReplayCrumb,\n  ReplayError,\n  ReplayRecord,\n  ReplaySpan,\n} from 'sentry/views/replays/types';\n\ninterface ReplayReaderParams {\n  /**\n   * Loaded segment data\n   *\n   * This is a mix of rrweb data, breadcrumbs and spans/transactions sorted by time\n   * All three types are mixed together.\n   */\n  attachments: unknown[] | undefined;\n  errors: ReplayError[] | undefined;\n\n  /**\n   * The root Replay event, created at the start of the browser session.\n   */\n  replayRecord: ReplayRecord | undefined;\n}\n\ntype RequiredNotNull<T> = {\n  [P in keyof T]: NonNullable<T[P]>;\n};\n\nexport default class ReplayReader {\n  static factory({attachments, replayRecord, errors}: ReplayReaderParams) {\n    if (!attachments || !replayRecord || !errors) {\n      return null;\n    }\n\n    try {\n      return new ReplayReader({attachments, replayRecord, errors});\n    } catch (err) {\n      Sentry.captureException(err);\n\n      // If something happens then we don't really know if it's the attachments\n      // array or errors array to blame (it's probably attachments though).\n      // Either way we can use the replayRecord to show some metadata, and then\n      // put an error message below it.\n      return new ReplayReader({\n        attachments: [],\n        errors: [],\n        replayRecord,\n      });\n    }\n  }\n\n  private constructor({\n    attachments,\n    replayRecord,\n    errors,\n  }: RequiredNotNull<ReplayReaderParams>) {\n    const {rawBreadcrumbs, rawRRWebEvents, rawNetworkSpans, rawMemorySpans} =\n      splitAttachmentsByType(attachments);\n\n    const spans = [...rawMemorySpans, ...rawNetworkSpans] as ReplaySpan[];\n\n    // TODO(replays): We should get correct timestamps from the backend instead\n    // of having to fix them up here.\n    const {startTimestampMs, endTimestampMs} = replayTimestamps(\n      replayRecord,\n      rawRRWebEvents as RecordingEvent[],\n      rawBreadcrumbs as ReplayCrumb[],\n      spans\n    );\n    replayRecord.started_at = new Date(startTimestampMs);\n    replayRecord.finished_at = new Date(endTimestampMs);\n    replayRecord.duration = duration(\n      replayRecord.finished_at.getTime() - replayRecord.started_at.getTime()\n    );\n\n    this.sortedSpans = spansFactory(spans);\n    this.breadcrumbs = breadcrumbFactory(\n      replayRecord,\n      errors,\n      rawBreadcrumbs as ReplayCrumb[],\n      this.sortedSpans\n    );\n    this.rrwebEvents = rrwebEventListFactory(\n      replayRecord,\n      rawRRWebEvents as RecordingEvent[]\n    );\n\n    this.replayRecord = replayRecord;\n  }\n\n  private sortedSpans: ReplaySpan[];\n  private replayRecord: ReplayRecord;\n  private rrwebEvents: RecordingEvent[];\n  private breadcrumbs: Crumb[];\n\n  /**\n   * @returns Duration of Replay (milliseonds)\n   */\n  getDurationMs = () => {\n    return this.replayRecord.duration.asMilliseconds();\n  };\n\n  getReplay = () => {\n    return this.replayRecord;\n  };\n\n  getRRWebEvents = () => {\n    return this.rrwebEvents;\n  };\n\n  getCrumbsWithRRWebNodes = memoize(() =>\n    this.breadcrumbs.filter(\n      crumb => crumb.data && typeof crumb.data === 'object' && 'nodeId' in crumb.data\n    )\n  );\n\n  getUserActionCrumbs = memoize(() => {\n    const USER_ACTIONS = [\n      BreadcrumbType.ERROR,\n      BreadcrumbType.INIT,\n      BreadcrumbType.NAVIGATION,\n      BreadcrumbType.UI,\n      BreadcrumbType.USER,\n    ];\n    return this.breadcrumbs.filter(crumb => USER_ACTIONS.includes(crumb.type));\n  });\n\n  getConsoleCrumbs = memoize(() =>\n    this.breadcrumbs.filter(crumb => ['console', 'issue'].includes(crumb.category || ''))\n  );\n\n  getNonConsoleCrumbs = memoize(() =>\n    this.breadcrumbs.filter(crumb => crumb.category !== 'console')\n  );\n\n  getNavCrumbs = memoize(() =>\n    this.breadcrumbs.filter(crumb =>\n      [BreadcrumbType.INIT, BreadcrumbType.NAVIGATION].includes(crumb.type)\n    )\n  );\n\n  getNetworkSpans = memoize(() => this.sortedSpans.filter(isNetworkSpan));\n\n  getMemorySpans = memoize(() => this.sortedSpans.filter(isMemorySpan));\n\n  sdkConfig = memoize(() => {\n    const found = this.rrwebEvents.find(\n      event => event.type === 5 && event.data.tag === 'options'\n    ) as undefined | RecordingOptions;\n    return found?.data?.payload;\n  });\n\n  isNetworkDetailsSetup = memoize(() => {\n    const config = this.sdkConfig();\n    if (config) {\n      return this.sdkConfig()?.networkDetailHasUrls;\n    }\n\n    // Network data was added in JS SDK 7.50.0 while sdkConfig was added in v7.51.1\n    // So even if we don't have the config object, we should still fallback and\n    // look for spans with network data, as that means things are setup!\n    return this.getNetworkSpans().some(\n      span =>\n        Object.keys(span.data.request?.headers || {}).length ||\n        Object.keys(span.data.response?.headers || {}).length\n    );\n  });\n}\n\nconst isMemorySpan = (span: ReplaySpan): span is MemorySpan => {\n  return span.op === 'memory';\n};\n\nconst isNetworkSpan = (span: ReplaySpan): span is NetworkSpan => {\n  return span.op?.startsWith('navigation.') || span.op?.startsWith('resource.');\n};\n","export default function splitAttachmentsByType(attachments: any[]) {\n  const rawBreadcrumbs = [] as unknown[];\n  const rawRRWebEvents = [] as unknown[];\n  const rawNetworkSpans = [] as unknown[];\n  const rawMemorySpans = [] as unknown[];\n\n  attachments.forEach(attachment => {\n    if (attachment.data?.tag === 'performanceSpan') {\n      const span = attachment.data?.payload;\n      if (span.op === 'memory') {\n        rawMemorySpans.push(span);\n      }\n      if (span.op?.startsWith('navigation.') || span.op?.startsWith('resource.')) {\n        rawNetworkSpans.push(span);\n      }\n    } else if (attachment.data?.tag === 'breadcrumb') {\n      rawBreadcrumbs.push(attachment?.data?.payload);\n    } else {\n      rawRRWebEvents.push(attachment);\n    }\n  });\n\n  return {\n    rawBreadcrumbs,\n    rawRRWebEvents,\n    rawNetworkSpans,\n    rawMemorySpans,\n  };\n}\n","import {useCallback, useEffect, useMemo, useState} from 'react';\nimport * as Sentry from '@sentry/react';\n\nimport {Client} from 'sentry/api';\nimport parseLinkHeader, {ParsedHeader} from 'sentry/utils/parseLinkHeader';\nimport {mapResponseToReplayRecord} from 'sentry/utils/replays/replayDataUtils';\nimport ReplayReader from 'sentry/utils/replays/replayReader';\nimport RequestError from 'sentry/utils/requestError/requestError';\nimport useApi from 'sentry/utils/useApi';\nimport useProjects from 'sentry/utils/useProjects';\nimport type {ReplayError, ReplayRecord} from 'sentry/views/replays/types';\n\ntype State = {\n  /**\n   * If any request returned an error then nothing is being returned\n   */\n  fetchError: undefined | RequestError;\n\n  /**\n   * If a fetch is underway for the requested root reply.\n   * This includes fetched all the sub-resources like attachments and `sentry-replay-event`\n   */\n  fetchingAttachments: boolean;\n  fetchingErrors: boolean;\n  fetchingReplay: boolean;\n};\n\ntype Options = {\n  /**\n   * The organization slug\n   */\n  orgSlug: string;\n\n  /**\n   * The projectSlug and replayId concatenated together\n   */\n  replaySlug: string;\n\n  /**\n   * Default: 50\n   * You can override this for testing\n   */\n  errorsPerPage?: number;\n\n  /**\n   * Default: 100\n   * You can override this for testing\n   */\n  segmentsPerPage?: number;\n};\n\ninterface Result {\n  fetchError: undefined | RequestError;\n  fetching: boolean;\n  onRetry: () => void;\n  projectSlug: string | null;\n  replay: ReplayReader | null;\n  replayErrors: ReplayError[];\n  replayId: string;\n  replayRecord: ReplayRecord | undefined;\n}\n\nconst INITIAL_STATE: State = Object.freeze({\n  fetchError: undefined,\n  fetchingAttachments: true,\n  fetchingErrors: true,\n  fetchingReplay: true,\n});\n\n/**\n * A react hook to load core replay data over the network.\n *\n * Core replay data includes:\n * 1. The root replay EventTransaction object\n *    - This includes `startTimestamp`, and `tags`\n * 2. RRWeb, Breadcrumb, and Span attachment data\n *    - We make an API call to get a list of segments, each segment contains a\n *      list of attachments\n *    - There may be a few large segments, or many small segments. It depends!\n *      ie: If the replay has many events/errors then there will be many small segments,\n *      or if the page changes rapidly across each pageload, then there will be\n *      larger segments, but potentially fewer of them.\n * 3. Related Event data\n *    - Event details are not part of the attachments payload, so we have to\n *      request them separately\n *\n * This function should stay focused on loading data over the network.\n * Front-end processing, filtering and re-mixing of the different data streams\n * must be delegated to the `ReplayReader` class.\n *\n * @param {orgSlug, replaySlug} Where to find the root replay event\n * @returns An object representing a unified result of the network requests. Either a single `ReplayReader` data object or fetch errors.\n */\nfunction useReplayData({\n  replaySlug,\n  orgSlug,\n  errorsPerPage = 50,\n  segmentsPerPage = 100,\n}: Options): Result {\n  const replayId = parseReplayId(replaySlug);\n  const projects = useProjects();\n\n  const api = useApi();\n\n  const [state, setState] = useState<State>(INITIAL_STATE);\n  const [attachments, setAttachments] = useState<unknown[]>([]);\n  const [errors, setErrors] = useState<ReplayError[]>([]);\n  const [replayRecord, setReplayRecord] = useState<ReplayRecord>();\n\n  const projectSlug = useMemo(() => {\n    if (!replayRecord) {\n      return null;\n    }\n    return projects.projects.find(p => p.id === replayRecord.project_id)?.slug ?? null;\n  }, [replayRecord, projects.projects]);\n\n  // Fetch every field of the replay. We're overfetching, not every field is used\n  const fetchReplay = useCallback(async () => {\n    const response = await api.requestPromise(makeFetchReplayApiUrl(orgSlug, replayId));\n    const mappedRecord = mapResponseToReplayRecord(response.data);\n    setReplayRecord(mappedRecord);\n    setState(prev => ({...prev, fetchingReplay: false}));\n  }, [api, orgSlug, replayId]);\n\n  const fetchAttachments = useCallback(async () => {\n    if (!replayRecord || !projectSlug) {\n      return;\n    }\n\n    if (!replayRecord.count_segments) {\n      setState(prev => ({...prev, fetchingAttachments: false}));\n      return;\n    }\n\n    const pages = Math.ceil(replayRecord.count_segments / segmentsPerPage);\n    const cursors = new Array(pages).fill(0).map((_, i) => `0:${segmentsPerPage * i}:0`);\n\n    await Promise.allSettled(\n      cursors.map(cursor => {\n        const promise = api.requestPromise(\n          `/projects/${orgSlug}/${projectSlug}/replays/${replayRecord.id}/recording-segments/`,\n          {\n            query: {\n              download: true,\n              per_page: segmentsPerPage,\n              cursor,\n            },\n          }\n        );\n        promise.then(response => {\n          setAttachments(prev => (prev ?? []).concat(...response));\n        });\n        return promise;\n      })\n    );\n    setState(prev => ({...prev, fetchingAttachments: false}));\n  }, [segmentsPerPage, api, orgSlug, replayRecord, projectSlug]);\n\n  const fetchErrors = useCallback(async () => {\n    if (!replayRecord) {\n      return;\n    }\n\n    // Clone the `finished_at` time and bump it up one second because finishedAt\n    // has the `ms` portion truncated, while replays-events-meta operates on\n    // timestamps with `ms` attached. So finishedAt could be at time `12:00:00.000Z`\n    // while the event is saved with `12:00:00.450Z`.\n    const finishedAtClone = new Date(replayRecord.finished_at);\n    finishedAtClone.setSeconds(finishedAtClone.getSeconds() + 1);\n\n    const paginatedErrors = fetchPaginatedReplayErrors(api, {\n      orgSlug,\n      replayId: replayRecord.id,\n      start: replayRecord.started_at,\n      end: finishedAtClone,\n      limit: errorsPerPage,\n    });\n\n    for await (const pagedResults of paginatedErrors) {\n      setErrors(prev => [...prev, ...(pagedResults || [])]);\n    }\n\n    setState(prev => ({...prev, fetchingErrors: false}));\n  }, [api, orgSlug, replayRecord, errorsPerPage]);\n\n  const onError = useCallback(error => {\n    Sentry.captureException(error);\n    setState(prev => ({...prev, fetchError: error}));\n  }, []);\n\n  const loadData = useCallback(\n    () => fetchReplay().catch(onError),\n    [fetchReplay, onError]\n  );\n\n  useEffect(() => {\n    loadData();\n  }, [loadData]);\n\n  useEffect(() => {\n    if (state.fetchError) {\n      return;\n    }\n    fetchErrors().catch(onError);\n  }, [state.fetchError, fetchErrors, onError]);\n\n  useEffect(() => {\n    if (state.fetchError) {\n      return;\n    }\n    fetchAttachments().catch(onError);\n  }, [state.fetchError, fetchAttachments, onError]);\n\n  const replay = useMemo(() => {\n    return ReplayReader.factory({\n      attachments,\n      errors,\n      replayRecord,\n    });\n  }, [attachments, errors, replayRecord]);\n\n  return {\n    replayErrors: errors,\n    fetchError: state.fetchError,\n    fetching: state.fetchingAttachments || state.fetchingErrors || state.fetchingReplay,\n    onRetry: loadData,\n    replay,\n    replayRecord,\n    projectSlug,\n    replayId,\n  };\n}\n\n// see https://github.com/getsentry/sentry/pull/47859\n// replays can apply to many projects when incorporating backend errors\n// this makes having project in the `replaySlug` obsolete\n// we must keep this url schema for now for backward compat but we should remove it at some point\n// TODO: remove support for projectSlug in replay url?\nfunction parseReplayId(replaySlug: string) {\n  const maybeProjectSlugAndReplayId = replaySlug.split(':');\n  if (maybeProjectSlugAndReplayId.length === 2) {\n    return maybeProjectSlugAndReplayId[1];\n  }\n\n  // if there is no projectSlug then we assume we just have the replayId\n  // all other cases would be a malformed url\n  return maybeProjectSlugAndReplayId[0];\n}\n\nfunction makeFetchReplayApiUrl(orgSlug: string, replayId: string) {\n  return `/organizations/${orgSlug}/replays/${replayId}/`;\n}\n\nasync function fetchReplayErrors(\n  api: Client,\n  {\n    orgSlug,\n    start,\n    end,\n    replayId,\n    limit = 50,\n    cursor = '0:0:0',\n  }: {\n    end: Date;\n    orgSlug: string;\n    replayId: string;\n    start: Date;\n    cursor?: string;\n    limit?: number;\n  }\n) {\n  return await api.requestPromise(`/organizations/${orgSlug}/replays-events-meta/`, {\n    includeAllArgs: true,\n    query: {\n      start: start.toISOString(),\n      end: end.toISOString(),\n      query: `replayId:[${replayId}]`,\n      per_page: limit,\n      cursor,\n    },\n  });\n}\n\nasync function* fetchPaginatedReplayErrors(\n  api: Client,\n  {\n    orgSlug,\n    start,\n    end,\n    replayId,\n    limit = 50,\n  }: {\n    end: Date;\n    orgSlug: string;\n    replayId: string;\n    start: Date;\n    limit?: number;\n  }\n): AsyncGenerator<ReplayError[]> {\n  function next(nextCursor: string) {\n    return fetchReplayErrors(api, {\n      orgSlug,\n      replayId,\n      start,\n      end,\n      limit,\n      cursor: nextCursor,\n    });\n  }\n  let cursor: undefined | ParsedHeader = {\n    cursor: '0:0:0',\n    results: true,\n    href: '',\n  };\n  while (cursor && cursor.results) {\n    const [{data}, , resp] = await next(cursor.cursor);\n    const pageLinks = resp?.getResponseHeader('Link') ?? null;\n    cursor = parseLinkHeader(pageLinks)?.next;\n    yield data;\n  }\n}\n\nexport default useReplayData;\n","import {useCallback} from 'react';\n\nimport {useLocalStorageState} from 'sentry/utils/useLocalStorageState';\n\ntype Opts = {\n  /**\n   * Key in localStorage.\n   * Use a format like: `${organization.id}:my-feature`\n   */\n  key: string;\n\n  /**\n   * Number of days before the dismissal is expired.\n   * After expiration the the user will need to re-dismiss things.\n   */\n  expirationDays?: number;\n};\n\nconst MS_PER_DAY = 1000 * 60 * 60 * 24;\n\nfunction isValid(timestamp: number, expirationDays: number) {\n  if (!timestamp || isNaN(timestamp)) {\n    return false;\n  }\n  const duration = Date.now() - timestamp;\n  const days = duration / MS_PER_DAY;\n  return days < expirationDays;\n}\n\n/**\n * Nominally for tracking dismissal/acknowledgement of in-app alerts and\n * notifications, specifically those that don't need to be persisted server side.\n *\n * Dismissal can be 'permanent' or have an expiration after some number of days.\n *\n * The real lifecycle depends on whether users reset localStorage or not, if you\n * need something really permanent then save the users' preference to the server.\n */\nfunction useDismissAlert({expirationDays = Number.MAX_SAFE_INTEGER, key}: Opts) {\n  const [dismissedTimestamp, setDismissedTimestamp] = useLocalStorageState<\n    undefined | string\n  >(key, val => (val ? String(val) : undefined));\n\n  const isDismissed =\n    expirationDays === Number.MAX_SAFE_INTEGER\n      ? Boolean(dismissedTimestamp)\n      : isValid(Number(dismissedTimestamp), expirationDays);\n\n  const dismiss = useCallback(() => {\n    setDismissedTimestamp(Date.now().toString());\n  }, [setDismissedTimestamp]);\n\n  return {\n    isDismissed,\n    dismiss,\n  };\n}\n\nexport default useDismissAlert;\n","import styled from '@emotion/styled';\n\nconst FluidHeight = styled('div')`\n  display: flex;\n  flex-direction: column;\n  flex-wrap: nowrap;\n  flex-grow: 1;\n  overflow: hidden;\n  height: 100%;\n`;\n\nexport default FluidHeight;\n"],"names":["BufferingOverlay","_ref","className","_jsx","Overlay","children","_jsxs","Message","IconClock","size","t","displayName","_styled","target","name","styles","space","p","theme","gray300","borderRadius","white","zIndex","initial","FastForwardBadge","speed","Badge","FastForwardTooltip","title","IconArrow","direction","Tooltip","PlayerDOMAlert","dismiss","isDismissed","useDismissAlert","key","DOMAlertContainer","DOMAlert","StyledIconInfo","DismissButton","priority","icon","IconClose","onClick","fontSizeMedium","blue400","IconInfo","Button","BasePlayerRoot","_ref2","isPreview","dimensions","videoDimensions","fastForwardSpeed","initRoot","isBuffering","isFetching","useReplayContext","windowEl","useRef","viewEl","windowDimensions","setWindowDimensions","useState","width","height","organization","useOrganization","didLog","setDidLog","useEffect","aspect_ratio","scale","Math","min","scale_bucket","floor","trackAnalytics","useVideoSizeLogger","current","updateWindowDimensions","useCallback","clientWidth","clientHeight","useResizeObserver","ref","onResize","window","ResizeObserver","style","transform","SizingWindow","PositionedFastForward","PositionedBuffering","PositionedLoadingIndicator","backgroundSecondary","gray100","LoadingIndicator","PlayerRoot","purple300","purple200","ReplayReader","static","attachments","replayRecord","errors","err","Sentry","constructor","_defineProperty","this","duration","asMilliseconds","rrwebEvents","memoize","breadcrumbs","filter","crumb","data","USER_ACTIONS","BreadcrumbType","includes","type","category","sortedSpans","isNetworkSpan","isMemorySpan","found","find","event","tag","payload","sdkConfig","networkDetailHasUrls","getNetworkSpans","some","span","Object","keys","request","headers","length","response","rawBreadcrumbs","rawRRWebEvents","rawNetworkSpans","rawMemorySpans","forEach","attachment","op","push","startsWith","splitAttachmentsByType","spans","startTimestampMs","endTimestampMs","replayTimestamps","started_at","Date","finished_at","getTime","spansFactory","breadcrumbFactory","rrwebEventListFactory","INITIAL_STATE","freeze","fetchError","undefined","fetchingAttachments","fetchingErrors","fetchingReplay","replaySlug","orgSlug","errorsPerPage","segmentsPerPage","replayId","maybeProjectSlugAndReplayId","split","parseReplayId","projects","useProjects","api","useApi","state","setState","setAttachments","setErrors","setReplayRecord","projectSlug","useMemo","id","project_id","slug","fetchReplay","async","requestPromise","makeFetchReplayApiUrl","mappedRecord","mapResponseToReplayRecord","prev","fetchAttachments","count_segments","pages","ceil","cursors","Array","fill","map","_","i","Promise","allSettled","cursor","promise","query","download","per_page","then","concat","fetchErrors","finishedAtClone","setSeconds","getSeconds","paginatedErrors","_ref3","start","end","limit","results","href","resp","nextCursor","includeAllArgs","toISOString","fetchReplayErrors","pageLinks","getResponseHeader","parseLinkHeader","next","e","reject","fetchPaginatedReplayErrors","pagedResults","onError","error","loadData","catch","replay","factory","replayErrors","fetching","onRetry","expirationDays","Number","MAX_SAFE_INTEGER","dismissedTimestamp","setDismissedTimestamp","useLocalStorageState","val","String","Boolean","timestamp","isNaN","now","isValid","toString"],"sourceRoot":""}