"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_group_tagFacets_index_tsx"],{"./app/components/group/tagFacets/index.tsx":(e,t,i)=>{i.d(t,{$c:()=>Z,Ix:()=>D,Pf:()=>_,Rj:()=>w,V6:()=>k,WN:()=>N,ZP:()=>S});var o=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=i("../node_modules/react/index.js"),n=i("../node_modules/lodash/keyBy.js"),a=i.n(n),r=i("./app/components/loadingError.tsx"),l=i("./app/components/placeholder.tsx"),u=i("./app/components/sidebarSection.tsx"),c=i("./app/components/tooltip.tsx"),d=i("./app/icons/index.tsx"),p=i("./app/locale.tsx"),g=i("./app/styles/space.tsx"),m=i("./app/utils/formatters.tsx"),h=i("./app/utils/queryString.tsx"),f=i("./app/utils/useLocation.tsx"),x=i("./app/utils/useOrganization.tsx"),b=i("./app/views/issueDetails/utils.tsx"),v=i("./app/components/group/tagFacets/tagFacetsDistributionMeter.tsx"),y=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const Z=["device","device.class","os","release","environment","transaction"],w=["browser","transaction","release","url","environment"],_=["transaction","url","user","release","organization.slug"],k=["transaction","environment","release"];function D(e){const t={};return Object.keys(e).forEach((i=>{t[i]="release"===i?{...e[i],topValues:e[i].topValues.map((e=>({...e,name:(0,m.ko)(e.name)})))}:"device"===i?{...e[i],topValues:e[i].topValues.map((e=>({...e,name:e.readable??e.name})))}:e[i]})),t}function S(e){let{tagKeys:t,environments:i,groupId:o,tagFormatter:n,project:u}=e;const c=(0,x.Z)(),{isLoading:d,isError:g,data:m,refetch:h}=(0,b.by)({groupId:o,environment:i}),f=(0,s.useMemo)((()=>{if(!m)return{};const e=a()(m,"key"),t=n?.(e)??e;return c.features.includes("device-classification")||delete t["device.class"],t}),[m,n,c]),v=t.filter((e=>Object.keys(f).includes(e))),Z=Object.keys(f).filter((e=>!t.includes(e))).sort();return d?(0,y.tZ)(E,{children:(0,y.BX)(z,{children:[(0,y.tZ)(l.Z,{height:"40px"}),(0,y.tZ)(l.Z,{height:"40px"}),(0,y.tZ)(l.Z,{height:"40px"}),(0,y.tZ)(l.Z,{height:"40px"})]})}):g?(0,y.tZ)(E,{children:(0,y.tZ)(r.Z,{message:(0,p.t)("There was an error loading tags for this issue."),onRetry:h})}):(0,y.tZ)(E,{children:(0,y.tZ)(s.Fragment,{children:0===Object.keys(f).length?(0,y.tZ)(O,{"data-test-id":"no-tags",children:i.length?(0,p.t)("No tags found in the selected environments"):(0,p.t)("No tags found")}):(0,y.BX)(T,{children:[(0,y.tZ)("span",{"data-test-id":"top-distribution-wrapper",children:(0,y.tZ)(j,{groupId:o,organization:c,project:u,tagKeys:v,tagsData:f,expandFirstTag:!0})}),(0,y.tZ)(j,{groupId:o,organization:c,project:u,tagKeys:Z,tagsData:f})]})})})}function E(e){let{children:t}=e;return(0,y.BX)(u.Eq,{children:[(0,y.BX)(u.Dx,{children:[(0,p.t)("All Tags"),(0,y.tZ)(A,{children:(0,y.tZ)(c.u,{title:(0,p.t)("The tags associated with all events in this issue"),disableForVisualTest:!0,children:(0,y.tZ)(d.BS,{size:"sm",color:"gray200"})})})]}),t]})}function j(e){let{groupId:t,organization:i,project:o,tagKeys:s,tagsData:n,expandFirstTag:a}=e;const r=(0,f.T)(),l={...r.query};return(0,y.tZ)(N,{children:s.map(((e,s)=>{const u=n[e],c=u?u.topValues:[],d=u?u.totalValues:0,p=`/organizations/${i.slug}/issues/${t}/tags/${e}/?referrer=tag-distribution-meter`,g=`/organizations/${i.slug}/issues/${t}/events/`,m=c?c.map((t=>{const i={...r,query:{...l,query:(0,h.os)(null,e,t.value)},pathname:g};return{...t,url:i}})):[];return(0,y.tZ)("li",{"aria-label":e,children:(0,y.tZ)(v.Z,{title:e,totalValues:d,segments:m,onTagClick:()=>{},project:o,expandByDefault:a&&0===s,otherUrl:p})},e)}))})}S.displayName="TagFacets",E.displayName="WrapperWithTitle",j.displayName="TagFacetsDistributionMeterWrapper";const z=(0,o.Z)("div",{target:"e1dti8s94"})("display:grid;gap:",(0,g.D)(1),";grid-auto-flow:row;margin-top:",(0,g.D)(1),";"),T=(0,o.Z)("div",{target:"e1dti8s93"})("margin-top:",(0,g.D)(2),";"),O=(0,o.Z)("p",{target:"e1dti8s92"})("margin-top:",(0,g.D)(.5),";"),N=(0,o.Z)("ol",{target:"e1dti8s91"})("list-style:none;padding:0;margin:0 0 ",(0,g.D)(2),";"),A=(0,o.Z)("span",{target:"e1dti8s90"})("vertical-align:middle;padding-left:",(0,g.D)(.5),";")},"./app/components/group/tagFacets/tagFacetsDistributionMeter.tsx":(e,t,i)=>{i.d(t,{Z:()=>D});var o=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=(i("../node_modules/core-js/modules/es.array.push.js"),i("../node_modules/react/index.js")),n=i("../node_modules/@emotion/is-prop-valid/dist/is-prop-valid.browser.esm.js"),a=i("../node_modules/framer-motion/dist/es/render/dom/motion.mjs"),r=i("../node_modules/lodash/debounce.js"),l=i.n(r),u=i("./app/components/button.tsx"),c=i("./app/components/links/link.tsx"),d=i("./app/components/tooltip.tsx"),p=i("./app/icons/iconChevron.tsx"),g=i("./app/locale.tsx"),m=i("./app/styles/space.tsx"),h=i("./app/utils.tsx"),f=i("./app/utils/analytics.tsx"),x=i("./app/utils/platform.tsx"),b=i("./app/utils/queryString.tsx"),v=i("./app/utils/useLocation.tsx"),y=i("./app/utils/useOrganization.tsx"),Z=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const w=["#402A65","#694D99","#9A81C4","#BBA6DF","#EAE2F8"],_=l()((e=>{let{tag:t,value:i,platform:o,is_mobile:s,organization:n}=e;(0,f.Gi)("issue_group_details.tags.bar.hovered",{tag:t,value:i,platform:o,is_mobile:s,organization:n})}),300);function k(e){let{colors:t=w,segments:i,title:o,totalValues:n,onTagClick:a,project:r,expandByDefault:l,otherUrl:u}=e;const m=(0,v.T)(),k=(0,y.Z)(),[D,P]=(0,s.useState)(!!l),[X,Y]=(0,s.useState)(null),G=i.slice(0,4),L=G.reduce(((e,t)=>e+t.count),0),U=L<n,W=(0,b.u3)(m.query.query,o,G.map((e=>{let{value:t}=e;return t}))),K={...m,query:{...m.query,query:W}};return U&&G.push({isOther:!0,name:(0,g.t)("Other"),value:"other",count:n-L,url:u??K??""}),(0,Z.tZ)(S,{children:(0,Z.BX)("details",{open:!0,"aria-expanded":D,onClick:e=>e.preventDefault(),children:[(0,Z.tZ)(I,{children:(0,Z.BX)(E,{clickable:!0,onClick:()=>P(!D),children:[!Array.isArray(i)||i.length<=0?(0,Z.tZ)(z,{children:(0,Z.tZ)(T,{children:o})}):(0,Z.BX)(z,{children:[(0,Z.tZ)(T,{children:o}),(0,Z.tZ)(d.u,{skipWrapper:!0,delay:800,title:G[0].name||(0,g.t)("n/a"),children:(0,Z.tZ)(O,{children:G[0].name||(0,g.t)("n/a")})}),(0,Z.tZ)(q,{borderless:!0,size:"zero",icon:(0,Z.tZ)(p.g,{direction:D?"up":"down",size:"xs"}),"aria-label":(0,g.t)("%s %s tag distribution",D?"Collapse":"Expand",o)})]}),0===n?(0,Z.tZ)(j,{children:(0,Z.tZ)("p",{children:(0,g.t)("No recent data.")})}):(0,Z.tZ)(j,{children:G.map(((e,i)=>{const s=(0,h.aQ)(e.count,n),l=Math.floor(s),u={index:i,onClick:()=>((0,f.Gi)("issue_group_details.tags.bar.clicked",{tag:o,value:e.value,platform:r?.platform,is_mobile:(0,x.an)(r?.platform),organization:k}),a?.(o,e))};return(0,Z.tZ)("div",{style:{width:s+"%"},onMouseOver:()=>{Y(e),_({tag:o,value:e.value,platform:r?.platform,is_mobile:(0,x.an)(r?.platform),organization:k})},onMouseLeave:()=>Y(null),children:e.isOther?(0,Z.tZ)(N,{"aria-label":(0,g.t)("Other segment"),color:t[t.length-1]}):(0,Z.tZ)(A,{"aria-label":`${e.value} ${(0,g.t)("segment")}`,color:t[i],...u,children:0===i&&l>6?`${l}%`:null})},e.isOther?"other":`segment-${e.value}`)}))})]})}),(0,Z.tZ)(C,{expanded:D,animate:D?{height:"100%",opacity:1}:{height:"0",opacity:0},children:(0,Z.tZ)(F,{children:G.map(((e,i)=>{const s=Math.floor((0,h.aQ)(e.count,n)),a=!!X&&X.value!==e.value,r=X?.value===e.value,l=e.isOther?(0,g.t)("Other %s tag values, %s of all events. View other tags.",o,`${s}%`):(0,g.t)("%s, %s, %s of all events. View events with this tag value.",o,e.value,`${s}%`);return(0,Z.tZ)("li",{children:(0,Z.tZ)(c.Z,{to:e.url,"aria-label":l,children:(0,Z.BX)(V,{onMouseOver:()=>Y(e),onMouseLeave:()=>Y(null),children:[(0,Z.tZ)(M,{color:t[e.isOther?t.length-1:i],focus:r}),(0,Z.tZ)(d.u,{skipWrapper:!0,delay:800,title:e.name,children:(0,Z.tZ)($,{unfocus:a,children:e.name??(0,Z.tZ)(R,{children:(0,g.t)("n/a")})})}),(0,Z.tZ)(B,{children:`${s}%`})]})})},`segment-${e.name}-${i}`)}))})})]})})}k.displayName="TagFacetsDistributionMeter";const D=k,S=(0,o.Z)("div",{target:"e1g8texm16"})("margin-bottom:",(0,m.D)(2),";"),E=(0,o.Z)("span",{target:"e1g8texm15"})((e=>e.clickable?"cursor: pointer":null),";"),j=(0,o.Z)("div",{target:"e1g8texm14"})({name:"andpxo",styles:"display:flex;overflow:hidden"}),z=(0,o.Z)("div",{target:"e1g8texm13"})("display:flex;font-size:",(e=>e.theme.fontSizeMedium),";justify-content:space-between;margin-bottom:",(0,m.D)(.25),";line-height:1.1;"),T=(0,o.Z)("div",{target:"e1g8texm12"})("flex:none;color:",(e=>e.theme.textColor),";font-weight:bold;font-size:",(e=>e.theme.fontSizeMedium),";margin-right:",(0,m.D)(1),";align-self:center;"),O=(0,o.Z)("div",{target:"e1g8texm11"})((e=>e.theme.overflowEllipsis),";display:flex;color:",(e=>e.theme.gray300),";text-align:right;font-size:",(e=>e.theme.fontSizeMedium),";",(e=>e.theme.overflowEllipsis),";align-self:center;"),N=(0,o.Z)("span",{target:"e1g8texm10"})("display:block;width:100%;height:",(0,m.D)(2),";color:inherit;outline:none;background-color:",(e=>e.color),";"),A=(0,o.Z)("span",{shouldForwardProp:n.Z,target:"e1g8texm9"})("&:hover{color:",(e=>e.theme.white),";}display:block;width:100%;height:",(0,m.D)(2),";color:",(e=>e.theme.white),";outline:none;background-color:",(e=>e.color),";text-align:right;font-size:",(e=>e.theme.fontSizeExtraSmall),";padding:1px ",(0,m.D)(.5)," 0 0;"),C=(0,o.Z)(a.E.div,{shouldForwardProp:e=>"animate"===e||"expanded"!==e&&(0,n.Z)(e),target:"e1g8texm8"})("height:0;opacity:0;",(e=>e.expanded?"":"overflow: hidden;"),";"),F=(0,o.Z)("ol",{target:"e1g8texm7"})("list-style:none;padding:0;margin:",(0,m.D)(1)," 0;"),V=(0,o.Z)("div",{target:"e1g8texm6"})("display:flex;align-items:center;cursor:pointer;padding:",(0,m.D)(.5)," 0;"),M=(0,o.Z)("span",{target:"e1g8texm5"})("padding:0;position:relative;width:11px;height:11px;text-indent:-9999em;display:inline-block;border-radius:50%;flex-shrink:0;background-color:",(e=>e.color),";&:after{content:'';border-radius:50%;position:absolute;top:0;left:0;width:100%;height:100%;outline:",(e=>e.theme.gray100)," ",(0,m.D)(.5)," solid;opacity:",(e=>e.focus?"1":"0"),";transition:opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);}"),$=(0,o.Z)("span",{target:"e1g8texm4"})("font-size:",(e=>e.theme.fontSizeSmall),";margin-left:",(0,m.D)(1),";overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:color 0.3s;color:",(e=>e.unfocus?e.theme.gray300:e.theme.gray400),";"),B=(0,o.Z)("span",{target:"e1g8texm3"})("font-size:",(e=>e.theme.fontSizeSmall),";margin-left:",(0,m.D)(1),";color:",(e=>e.theme.gray300),";text-align:right;flex-grow:1;"),q=(0,o.Z)(u.zx,{target:"e1g8texm2"})("color:",(e=>e.theme.gray300),";margin-left:",(0,m.D)(.5),";"),R=(0,o.Z)("span",{target:"e1g8texm1"})("color:",(e=>e.theme.gray300),";"),I=(0,o.Z)("summary",{target:"e1g8texm0"})({name:"l4bt0f",styles:"&::-webkit-details-marker{display:none;}"})},"./app/views/issueDetails/utils.tsx":(e,t,i)=>{i.d(t,{Ad:()=>h,M3:()=>x,V7:()=>c,V8:()=>v,by:()=>b,dG:()=>p,g5:()=>d,m7:()=>f,sC:()=>m});var o=i("../node_modules/react/index.js"),s=i("../node_modules/lodash/orderBy.js"),n=i.n(s),a=i("./app/actionCreators/group.tsx"),r=i("./app/api.tsx"),l=i("./app/locale.tsx"),u=i("./app/utils/useLocation.tsx");function c(e,t,i,o){(0,a.Gv)(e,{orgId:t,projectId:i,itemIds:[o],failSilently:!0,data:{hasSeen:!0}},{})}function d(e,t){return(new r.KU).requestPromise(`/issues/${e}/user-reports/`,{includeAllArgs:!0,query:t})}function p(e){const t=e.tags.find((e=>{let{key:t}=e;return"environment"===t}));return t?t.value:null}const g={commented:(0,l.t)("You're receiving workflow notifications because you have commented on this issue."),assigned:(0,l.t)("You're receiving workflow notifications because you were assigned to this issue."),bookmarked:(0,l.t)("You're receiving workflow notifications because you have bookmarked this issue."),changed_status:(0,l.t)("You're receiving workflow notifications because you have changed the status of this issue."),mentioned:(0,l.t)("You're receiving workflow notifications because you have been mentioned in this issue.")};function m(e){if(e.subscriptionDetails&&e.subscriptionDetails.disabled)return(0,l.t)("You have disabled workflow notifications for this project.");if(!e.isSubscribed)return(0,l.t)("Subscribe to workflow notifications for this issue");if(e.subscriptionDetails){const{reason:t}=e.subscriptionDetails;if("unknown"===t)return(0,l.t)("You're receiving workflow notifications because you are subscribed to this issue.");if(t&&g.hasOwnProperty(t))return g[t]}return(0,l.t)("You're receiving updates because you are subscribed to workflow notifications for this project.")}function h(e){return n()([...e],(e=>{let{dateCreated:t}=e;return new Date(t)}),["desc"])[0]}let f;function x(e,t){const{status:i,count:o,activity:s}=e,n=Number(o);switch(i){case"reprocessing":return f.REPROCESSING;case"unresolved":{const e=t??h(s);return"reprocess"===e?.type?0===n?f.REPROCESSED_AND_HASNT_EVENT:f.REPROCESSED_AND_HAS_EVENT:f.NO_STATUS}default:return f.NO_STATUS}}!function(e){e.REPROCESSED_AND_HASNT_EVENT="reprocessed_and_hasnt_event",e.REPROCESSED_AND_HAS_EVENT="reprocessed_and_has_event",e.REPROCESSING="reprocessing",e.NO_STATUS="no_status"}(f||(f={}));const b=function(e){let{groupId:t,environment:i=[]}=e,{enabled:o=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.zk)({groupId:t,environment:i,readable:!0,limit:4},{enabled:o})};function v(){const e=(0,u.T)().query.environment;return(0,o.useMemo)((()=>"string"==typeof e?[e]:e??[]),[e])}}}]);
//# sourceMappingURL=../sourcemaps/app_components_group_tagFacets_index_tsx.95642c1b3e9ce2bab86dc1256bdf5625.js.map