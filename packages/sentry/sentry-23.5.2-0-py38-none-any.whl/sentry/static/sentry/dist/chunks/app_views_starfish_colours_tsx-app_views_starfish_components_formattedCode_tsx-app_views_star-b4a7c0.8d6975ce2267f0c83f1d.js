"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_starfish_colours_tsx-app_views_starfish_components_formattedCode_tsx-app_views_star-b4a7c0"],{"./app/utils/discover/genericDiscoverQuery.tsx":(e,t,s)=>{s.d(t,{AA:()=>x,JC:()=>b,ZP:()=>D,o:()=>h});var r=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=(s("../node_modules/core-js/modules/es.error.cause.js"),s("../node_modules/react/index.js")),n=s("../node_modules/@tanstack/react-query/build/lib/useQuery.mjs"),a=s("./app/api.tsx"),o=s("./app/locale.tsx"),u=s("./app/utils/discover/eventView.tsx"),c=s("./app/utils/performance/contexts/performanceEventViewContext.tsx"),l=s("./app/utils/useApi.tsx"),d=s("./app/utils/useOrganization.tsx"),p=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class h{constructor(e,t){(0,r.Z)(this,"message",void 0),(0,r.Z)(this,"originalError",void 0),this.message=e,this.originalError=t}getOriginalError(){return this.originalError}}class m extends i.Component{constructor(){super(...arguments),(0,r.Z)(this,"state",{isLoading:!0,tableFetchID:void 0,error:null,tableData:null,pageLinks:null,api:new a.KU}),(0,r.Z)(this,"_shouldRefetchData",(e=>{const t=w(this.props),s=w(e);return!(0,u.ze)(t,s)||e.limit!==this.props.limit||e.route!==this.props.route||e.cursor!==this.props.cursor})),(0,r.Z)(this,"_parseError",(e=>{if(this.props.parseError)return this.props.parseError(e);if(!e)return null;const t=e.responseJSON?.detail;if("string"==typeof t)return new h(t,e);const s=t?.message;return new h("string"==typeof s?s:(0,o.t)("An unknown error occurred."),e)})),(0,r.Z)(this,"fetchData",(async()=>{const{queryBatching:e,beforeFetch:t,afterFetch:s,didFetch:r,eventView:i,orgSlug:n,route:a,setError:o}=this.props,{api:u}=this.state;if(!i.isValid())return;const c=`/organizations/${n}/${a}/`,l=Symbol("tableFetchID"),d=w(this.props);this.setState({isLoading:!0,tableFetchID:l}),o?.(void 0),t?.(u),u.clear();try{const[t,,i]=await x(u,c,d,{queryBatching:e});if(this.state.tableFetchID!==l)return;const n=s?s(t,this.props):t;r?.(n),this.setState((e=>({isLoading:!1,tableFetchID:void 0,error:null,pageLinks:i?.getResponseHeader("Link")??e.pageLinks,tableData:n})))}catch(e){const t=this._parseError(e);this.setState({isLoading:!1,tableFetchID:void 0,error:t,tableData:null}),o&&o(t??void 0)}}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){const t=this._shouldRefetchData(e),s=!1===e.eventView.isValid()&&this.props.eventView.isValid(),r=!!this.props.shouldRefetchData&&this.props.shouldRefetchData(e,this.props);(t||s||r)&&this.fetchData()}render(){const{isLoading:e,error:t,tableData:s,pageLinks:r}=this.state,i={isLoading:e,error:t,tableData:s,pageLinks:r},n=this.props.children;return n?.(i)}}function f(e){const t=(0,d.Z)({allowNull:!0})?.slug,s=(0,i.useContext)(c.uL)?.eventView,r=e.orgSlug??t,n=e.eventView??s;if(void 0===r||void 0===n)throw new Error("GenericDiscoverQuery requires both an orgSlug and eventView");const a={...e,orgSlug:r,eventView:n};return(0,p.tZ)(m,{...a})}m.displayName="_GenericDiscoverQuery",f.displayName="GenericDiscoverQuery";const v=200,g=2,y=e=>new Promise((t=>setTimeout(t,e)));async function x(e,t,s){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{queryBatching:i,retry:n}=r;if(i?.batchRequest)return i.batchRequest(e,t,{query:s,includeAllArgs:!0});const a=n?.baseTimeout??v,o=n?.timeoutMultiplier??g,u=n?.statusCodes??[],c=n?.tries??1;let l,d=0,p=0;for(;d<c&&(!l||u.includes(l.status));){p>0&&await y(p);try{return d++,await e.requestPromise(t,{method:"GET",includeAllArgs:!0,query:{...s}})}catch(e){l=e,p=a*o**(d-1)}}throw l}function w(e){const{cursor:t,limit:s,noPagination:r,referrer:i,getRequestPayload:n,eventView:a,location:o,forceAppendRawQueryString:u}=e,c=n?n(e):a.getEventsAPIPayload(o,u);return t&&(c.cursor=t),s&&(c.per_page=s),r&&(c.noPagination=r),i&&(c.referrer=i),Object.assign(c,e.queryExtras??{}),c}function b(e){const t=(0,l.Z)(),{orgSlug:s,route:r,options:i}=e,a=`/organizations/${s}/${r}/`,o=w(e);return(0,n.a)([r,o],(async()=>{const[s]=await x(t,a,o,{queryBatching:e.queryBatching});return s}),i)}const D=f},"./app/utils/performance/contexts/performanceEventViewContext.tsx":(e,t,s)=>{s.d(t,{bq:()=>i,uL:()=>a});var r=s("./app/utils/performance/contexts/utils.tsx");const[i,n,a]=(0,r.n)({name:"PerformanceEventViewContext"})},"./app/utils/performance/contexts/utils.tsx":(e,t,s)=>{s.d(t,{n:()=>i}),s("../node_modules/core-js/modules/es.error.cause.js");var r=s("../node_modules/react/index.js");function i(e){const{strict:t=!0,errorMessage:s=`useContext for "${e.name}" must be inside a Provider with a value`,name:i}=e,n=(0,r.createContext)(void 0);return n.displayName=i,[n.Provider,function(){const e=(0,r.useContext)(n);if(!e&&t)throw new Error(s);return e},n]}},"./app/views/starfish/colours.tsx":(e,t,s)=>{s.d(t,{SQ:()=>i,v$:()=>n});var r=s("./app/constants/chartPalette.tsx");const i=r.$[0][0],n=r.$[1][1];r.$[2][2]},"./app/views/starfish/components/formattedCode.tsx":(e,t,s)=>{s.d(t,{K:()=>n});var r=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=s("./app/styles/space.tsx");const n=(0,r.Z)("div",{target:"e1enucjs0"})("padding:",(0,i.D)(1),";margin-bottom:",(0,i.D)(3),";border-radius:",(e=>e.theme.borderRadius),";overflow-x:auto;white-space:pre;")},"./app/views/starfish/components/sparkline.tsx":(e,t,s)=>{s.d(t,{ZP:()=>d,Fk:()=>p});var r=s("../node_modules/echarts/lib/chart/line/install.js"),i=s("../node_modules/echarts/lib/extension.js"),n=s("../node_modules/echarts/core.js"),a=s("../node_modules/zrender/lib/svg/Painter.js");function o(e){e.registerPainter("svg",a.Z)}var u=s("../node_modules/echarts-for-react/lib/core.js"),c=(s("../node_modules/moment/moment.js"),s("./app/components/charts/components/markLine.tsx")),l=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function d(e){let{series:t,width:s,color:a,markLine:c}=e;if(i.D([r.N,o]),!t.data)return null;const d={data:t.data.map((e=>e.value)),type:"line",showSymbol:!1,smooth:!0};return(0,l.tZ)(u.Z,{echarts:n,option:{color:a,series:[d,c],xAxis:{show:!1,data:t.data.map((e=>e.name)),type:"category"},yAxis:{show:!1,type:"value"},grid:{left:3,top:3,right:3,bottom:3}},notMerge:!0,style:{height:25,width:s??200},lazyUpdate:!0,theme:"theme_name"})}function p(e,t,s){return{seriesName:e,type:"line",color:s.blue300,data:[],xAxisIndex:0,yAxisIndex:0,markLine:(0,c.Z)({silent:!0,animation:!1,lineStyle:{color:s.blue300,type:"dotted"},data:[{yAxis:t}],label:{show:!0,position:"insideStart",formatter:e}})}}d.displayName="Sparkline"},"./app/views/starfish/queries/useApplicationMetrics.tsx":(e,t,s)=>{s.d(t,{T:()=>c});var r=s("./app/utils/discover/eventView.tsx"),i=s("./app/utils/discover/types.tsx"),n=s("./app/utils/usePageFilters.tsx"),a=s("./app/views/starfish/utils/dates.tsx"),o=s("./app/views/starfish/utils/getDateQueryFilter.tsx"),u=s("./app/views/starfish/utils/useSpansQuery.tsx");const c=function(){const e=(0,n.Z)(),{startTime:t,endTime:s}=(0,a.tZ)(e),c=`\n    SELECT\n    count() as count,\n    sum(exclusive_time) as "sum(span.duration)"\n    FROM spans_experimental_starfish\n    WHERE 1 = 1\n    ${(0,o.z)(t,s)}\n`,l=r.ZP.fromSavedQuery({name:"",fields:["sum(span.duration)"],dataset:i.as.SPANS_METRICS,projects:[1],version:2}),{isLoading:d,data:p}=(0,u.bB)({eventView:l,queryString:c,initialData:[],enabled:Boolean(c)});return{isLoading:d,data:p[0]??{}}}},"./app/views/starfish/utils/constants.tsx":(e,t,s)=>{s.d(t,{M:()=>r});const r="http://localhost:8080"},"./app/views/starfish/utils/getDateQueryFilter.tsx":(e,t,s)=>{s.d(t,{z:()=>i});var r=s("./app/views/starfish/utils/dates.tsx");const i=(e,t)=>{const{start_timestamp:s,end_timestamp:i}=(0,r.SW)({start:e.format("YYYY-MM-DD HH:mm:ss"),end:t.format("YYYY-MM-DD HH:mm:ss")});return`\n  ${s?`AND greaterOrEquals(start_timestamp, '${s}')`:""}\n  ${i?`AND lessOrEquals(start_timestamp, '${i}')`:""}\n  `}},"./app/views/starfish/utils/useSpansQuery.tsx":(e,t,s)=>{s.d(t,{bB:()=>m}),s("../node_modules/core-js/modules/es.error.cause.js"),s("../node_modules/core-js/modules/es.array.push.js");var r=s("../node_modules/@tanstack/react-query/build/lib/useQuery.mjs"),i=s("../node_modules/moment/moment.js"),n=s.n(i),a=s("./app/utils/discover/discoverQuery.tsx"),o=s("./app/utils/discover/eventView.tsx"),u=s("./app/utils/discover/genericDiscoverQuery.tsx"),c=s("./app/utils/useLocation.tsx"),l=s("./app/utils/useOrganization.tsx"),d=s("./app/views/starfish/utils/constants.tsx"),p=s("../node_modules/react/index.js");const h="YYYY-MM-DDTHH:mm:ss";function m(e){let{eventView:t,queryString:s,initialData:r,forceUseDiscover:i,enabled:n}=e;const{options:a}=function(){const[e,t]=(0,p.useState)({useDiscover:!1});return{options:e,setOptions:t}}(),{useDiscover:o}=a,u=function(e){let{useDiscover:t,isTimeseriesQuery:s}=e;return t?s?v:g:f}({useDiscover:i??o,isTimeseriesQuery:(t?.yAxis?.length??0)>0});if(function(e){return e===g}(u)||function(e){return e===v}(u)){if(t)return u({eventView:t,initialData:r,enabled:n});throw new Error("eventView argument must be defined when Starfish useDiscover is true")}if(s)return u({queryString:s,initialData:r,enabled:n});throw new Error("queryString argument must be defined when Starfish useDiscover is false, ie when using scraped data via fetch API")}function f(e){let{queryString:t,initialData:s,enabled:i}=e;const{isLoading:n,data:a}=(0,r.a)({queryKey:[t],queryFn:()=>fetch(`${d.M}/?query=${t}`).then((e=>e.json())),retry:!1,initialData:s,enabled:i,refetchOnWindowFocus:!1});return{isLoading:n,data:a}}function v(e){let{eventView:t,enabled:s,initialData:r,referrer:i}=e;const n=(0,c.T)(),a=(0,l.Z)(),{isLoading:d,data:p}=(0,u.JC)({route:"events-stats",eventView:t,location:n,orgSlug:a.slug,getRequestPayload:()=>({...t.getEventsAPIPayload(n),yAxis:t.yAxis,topEvents:t.topEvents,excludeOther:1,partial:1,orderby:t.sorts?.[0]?(0,o.uZ)(t.sorts?.[0]):void 0,interval:t.interval}),options:{enabled:s,refetchOnWindowFocus:!1},referrer:i});return{isLoading:d,data:d&&r?r:y(p,t)}}function g(e){let{eventView:t,initialData:s,referrer:r}=e;const i=(0,c.T)(),n=(0,l.Z)(),{isLoading:o,data:u}=(0,a._)({eventView:t,orgSlug:n.slug,location:i,referrer:r});return{isLoading:o,data:o&&s?s:u?.data}}function y(e,t){if(!t.yAxis)return[];let s=[];const r=t.yAxis&&("string"==typeof t.yAxis||1===t.yAxis.length),i="string"==typeof t.yAxis?t.yAxis:t.yAxis[0];return e.data?x(e,r?i:"count"):(Object.keys(e).forEach((t=>{e[t].data?s=w(s,x(e[t],r?i:t)):Object.keys(e[t]).forEach((r=>{"order"!==r&&(s=w(s,x(e[t][r],r,t)))}))})),s.map((e=>({...e,interval:n()(1e3*parseInt(e.interval,10)).format(h)}))))}function x(e,t,s){const r=[];return e.data.forEach((e=>{let[i,[{count:n}]]=e;const a=r.find((e=>e.interval===i&&(!s||e.group===s)));a?a[t]=n:r.push({interval:i,[t]:n,group:s})})),r}function w(e,t){const s=JSON.parse(JSON.stringify(e));return t.forEach((e=>{let{interval:t,group:r,...i}=e;const n=s.find((e=>e.interval===t&&(!r||e.group===r)));n?Object.keys(i).forEach((e=>{n[e]=i[e]})):s.push({interval:t,group:r,...i})})),s}}}]);
//# sourceMappingURL=../sourcemaps/app_views_starfish_colours_tsx-app_views_starfish_components_formattedCode_tsx-app_views_star-b4a7c0.c47f8f16f77148b54e1422be1ac0064d.js.map