(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_starfish_views_spanSummaryPage_index_tsx"],{"./app/components/performanceDuration.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var a=n("./app/components/duration.tsx"),s=n("./app/utils.tsx"),r=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function i(e){const t=function(e){return(0,s.ri)(e.nanoseconds)}(e)?e.nanoseconds/1e9:function(e){return(0,s.ri)(e.milliseconds)}(e)?e.milliseconds/1e3:e.seconds;return(0,r.tZ)(a.Z,{abbreviation:e.abbreviation,seconds:t,fixedDigits:2})}i.displayName="PerformanceDuration";const o=i},"./app/utils/discover/discoverQuery.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>l,_:()=>o});var a=n("./app/utils/discover/genericDiscoverQuery.tsx"),s=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function r(e,t){return e.transactionName!==t.transactionName||e.transactionThreshold!==t.transactionThreshold||e.transactionThresholdMetric!==t.transactionThresholdMetric}function i(e){return(0,s.tZ)(a.ZP,{route:"events",shouldRefetchData:r,afterFetch:(e,t)=>{const{fields:n,...a}=e.meta??{};return{...e,meta:{...n,...a}}},...e})}function o(e){return(0,a.JC)({route:"events",shouldRefetchData:r,afterFetch:(e,t)=>{const{fields:n,...a}=e.meta??{};return{...e,meta:{...n,...a}}},...e})}i.displayName="DiscoverQuery";const l=i},"./app/utils/performance/contexts/pageError.tsx":(e,t,n)=>{"use strict";n.d(t,{De:()=>d,V_:()=>o,YY:()=>l});var a=n("../node_modules/react/index.js"),s=n("./app/components/alert.tsx"),r=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const i=(0,a.createContext)({pageError:void 0,setPageError:e=>{}});function o(e){let{children:t}=e;const[n,s]=(0,a.useState)();return(0,r.tZ)(i.Provider,{value:{pageError:n,setPageError:s},children:t})}function l(){const{pageError:e}=(0,a.useContext)(i);return e?(0,r.tZ)(s.bZ,{type:"error","data-test-id":"page-error-alert",showIcon:!0,children:e}):null}o.displayName="PageErrorProvider",l.displayName="PageErrorAlert";const d=()=>(0,a.useContext)(i)},"./app/utils/useKeyPress.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var a=n("../node_modules/react/index.js");const s=(e,t)=>{const[n,s]=(0,a.useState)(!1),r=t??document.body;return(0,a.useEffect)((()=>{const t=t=>{let{key:n}=t;n===e&&s(!0)},n=t=>{let{key:n}=t;n===e&&s(!1)};return r.addEventListener("keydown",t),r.addEventListener("keyup",n),()=>{r.removeEventListener("keydown",t),r.removeEventListener("keyup",n)}}),[e,r]),n}},"./app/utils/useOnClickOutside.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var a=n("../node_modules/react/index.js");const s=function(e,t){(0,a.useEffect)((()=>{const n=n=>{const a=e?.current;a&&!a.contains(n.target)&&t(n)};return document.addEventListener("mousedown",n),document.addEventListener("touchstart",n),()=>{document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",n)}}),[e,t])}},"./app/views/performance/transactionSummary/transactionSpans/spanDetails/spanDetailsTable.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>D,i:()=>$});var a=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=n("../node_modules/react/index.js"),r=n("./app/components/gridEditable/index.tsx"),i=n("./app/components/gridEditable/sortLink.tsx"),o=n("./app/components/links/link.tsx"),l=n("./app/components/pagination.tsx"),d=n("./app/components/performance/waterfall/rowBar.tsx"),c=n("./app/components/performance/waterfall/utils.tsx"),p=n("./app/components/performanceDuration.tsx"),u=n("./app/components/tooltip.tsx"),m=n("./app/locale.tsx"),h=n("./app/styles/space.tsx"),g=n("./app/utils.tsx"),f=n("./app/utils/discover/fieldRenderers.tsx"),y=n("./app/utils/discover/fields.tsx"),v=n("./app/utils/formatters.tsx"),x=n("./app/utils/performanceForSentry/index.tsx"),_=n("./app/views/performance/transactionSummary/utils.tsx"),Z=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function D(e){const{location:t,organization:n,project:a,examples:i,suspectSpan:o,transactionName:d,isLoading:c,pageLinks:p}=e;if(!(0,g.ri)(i))return null;const u=i.filter((e=>e.spans.length>0)).map((e=>({id:e.id,project:a?.slug,timestamp:1e3*e.finishTimestamp,transactionDuration:1e3*(e.finishTimestamp-e.startTimestamp),spanDuration:e.nonOverlappingExclusiveTime,occurrences:e.spans.length,cumulativeDuration:e.spans.reduce(((e,t)=>e+t.exclusiveTime),0),spans:e.spans})));return(0,Z.BX)(s.Fragment,{children:[(0,Z.tZ)(x.oF,{id:"SpanDetails-SpanDetailsTable",hasData:!!u.length,isLoading:c,children:(0,Z.tZ)(r.ZP,{isLoading:c,data:u,columnOrder:S,columnSortBy:[],grid:{renderHeadCell:w,renderBodyCell:b(t,n,d,o)},location:t})}),(0,Z.tZ)(l.Z,{pageLinks:p??null})]})}function w(e,t){const n=(0,y.qG)(e.key,E[e.key]);return(0,Z.tZ)(i.Z,{title:e.name,align:n,direction:void 0,canSort:!1,generateSortLink:()=>{}})}function b(e,t,n,a){return function(s,r){if("spanDuration"===s.key&&r.transactionDuration)return(0,Z.tZ)($,{spanOp:a?.op??"",spanDuration:r.spanDuration,transactionDuration:r.transactionDuration});let i=(0,f.Js)(s.key,E)(r,{location:e,organization:t});if("id"===s.key){const a=r.spans.length?r.spans.reduce(((e,t)=>e.exclusiveTime>=t.exclusiveTime?e:t)):null,s=(0,_.vd)(n)(t,r,e.query,a.id);i=(0,Z.tZ)(o.Z,{to:s,children:i})}return i}}D.displayName="SpanTable",w.displayName="renderHeadCell";const E={id:"string",timestamp:"date",spanDuration:"duration",occurrences:"integer",cumulativeDuration:"duration"},S=[{key:"id",name:(0,m.t)("Event ID"),width:r.z7},{key:"timestamp",name:(0,m.t)("Timestamp"),width:r.z7},{key:"spanDuration",name:(0,m.t)("Span Duration"),width:r.z7},{key:"occurrences",name:(0,m.t)("Count"),width:r.z7},{key:"cumulativeDuration",name:(0,m.t)("Cumulative Duration"),width:r.z7}],N=(0,a.Z)("div",{target:"e1y3mgni1"})("position:relative;display:flex;top:",(0,h.D)(.5),";background-color:",(e=>e.theme.gray100),";"),T=(0,a.Z)(d.e,{target:"e1y3mgni0"})({name:"1ics03r",styles:"position:relative;width:100%;top:0"});function $(e){const{spanOp:t,spanDuration:n,transactionDuration:a}=e,s=n/a,r=s<.7?"right":"inset";return(0,Z.tZ)(N,{children:(0,Z.tZ)("div",{style:{width:(0,c.yI)(s)},children:(0,Z.tZ)(u.u,{title:(0,m._N)("[percentage] of the transaction",{percentage:(0,v.rl)(s)}),containerDisplayMode:"block",children:(0,Z.tZ)(T,{style:{backgroundColor:(0,c.hd)(t)},children:(0,Z.tZ)(d.R,{durationDisplay:r,showDetail:!1,children:(0,Z.tZ)(p.Z,{abbreviation:!0,milliseconds:n})})})})})})}$.displayName="SpanDurationBar"},"./app/views/starfish/components/chart.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>S,K:()=>N}),n("../node_modules/core-js/modules/es.array.push.js");var a=n("../node_modules/react/index.js"),s=n("../node_modules/@emotion/react/dist/emotion-element-6a883da9.browser.esm.js"),r=n("../node_modules/echarts/lib/core/echarts.js"),i=n("../node_modules/lodash/max.js"),o=n.n(i),l=n("../node_modules/lodash/min.js"),d=n.n(l),c=n("./app/components/charts/areaChart.tsx"),p=n("./app/components/charts/barChart.tsx"),u=n("./app/components/charts/baseChart.tsx"),m=n("./app/components/charts/chartZoom.tsx"),h=n("./app/components/charts/components/tooltip.tsx"),g=n("./app/components/charts/lineChart.tsx"),f=n("./app/components/charts/series/lineSeries.tsx"),y=(n("../node_modules/echarts/lib/chart/scatter.js"),n("./app/utils/theme.tsx"));function v(e){return{symbolSize:y.ZP.charts.symbolSize,...e,type:"scatter",emphasis:{...e.emphasis,scale:!0}}}var x=n("./app/utils/discover/charts.tsx"),_=n("./app/utils/discover/fields.tsx"),Z=n("./app/utils/useRouter.tsx"),D=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const w="starfish_chart_group";function b(e){const t=e.map((e=>e.data.map((e=>e.value))));return o()(t.map(o()))}function E(e){let{data:t,previousData:n,statsPeriod:r,start:i,end:l,utc:y,loading:E,height:S,grid:N,disableXAxis:T,definedAxisTicks:$,chartColors:j,isBarChart:q,isLineChart:k,stacked:L,log:O,hideYAxisSplitLine:I,showLegend:C,scatterPlot:R,throughput:A,aggregateOutputFormat:F,onClick:M,forwardedRef:B,chartGroup:P,tooltipFormatterOptions:z={}}=e;const Y=(0,Z.Z)(),H=(0,s.u)(),W=(0,a.useRef)(null),K=B||W,X=K?.current?.getEchartsInstance();if(X&&!X.group&&(X.group=P??w),!t||t.length<=0)return null;const Q=j??H.charts.getColorPalette(4),U="duration"===F||t.every((e=>"duration"===(0,_.Px)(e.seriesName))),G="percentage"===F||t.every((e=>"percentage"===(0,_.Px)(e.seriesName)));let V=U?function(e){let t=0;if(e.length>2)for(let n=0;n<e.length;n++)t+=o()(e[n].data.map((e=>e.value)));else t=b(e);if(t<=1)return 1;const n=Math.log10(t),a=d()([o()([10**(n-Math.floor(n)),0]),10]);let s;s=a<=2.5?.2:a<=5?.5:a<=7.5?1:2;const r=10**Math.floor(n)*s;return Math.round(Math.ceil(t/r)*r)}([...t,...R?.[0]?.data?.length?R:[]]):G?b(t):void 0;1===V&&U&&(V+=1);const J=(0,x.Xp)(t);let ee;const te=[];A&&A.length>1&&(ee=[(0,f.Z)({name:"Throughput",data:A.map((e=>{let{interval:t,count:n}=e;return[t,n]})),yAxisIndex:1,lineStyle:{type:"dashed",width:1,opacity:.5},animation:!1,animationThreshold:1,animationDuration:0})],te.push({minInterval:J,splitNumber:$,max:V,type:"value",axisLabel:{color:H.chartLabel,formatter:e=>(0,x.gu)(e,"number",!0)},splitLine:I?{show:!1}:void 0}));const ne=[{minInterval:J,splitNumber:$,max:V,type:O?"log":"value",axisLabel:{color:H.chartLabel,formatter:e=>(0,x.gu)(e,F??(0,_.Px)(t[0].seriesName),void 0,J)},splitLine:I?{show:!1}:void 0},...te],ae={seriesOptions:{showSymbol:!1},grid:N,yAxes:ne,utc:y,legend:C?{top:0,right:10}:void 0,isGroupedByDate:!0,showTimeInTooltip:!0,tooltip:{formatter:(e,t)=>Array.from(document.querySelectorAll(":hover")).find((e=>e.classList.contains("echarts-for-react")))===K?.current?.ele?(0,h.Pf)({isGroupedByDate:!0,showTimeInTooltip:!0,utc:y,...z})(e,t):"",trigger:"axis",axisPointer:{type:"cross",label:{show:!1}},valueFormatter:(e,n)=>(0,x.CX)(e,F??(0,_.Px)(t&&t.length?t[0].seriesName:n)),nameFormatter:e=>"epm()"===e?"tpm()":e}};if(E)return k?(0,D.tZ)(g.w,{height:S,series:[],...ae}):q?(0,D.tZ)(p.v,{height:S,series:[],...ae}):(0,D.tZ)(c.T,{height:S,series:[],...ae});const se=t.map(((e,t)=>({...e,yAxisIndex:0,xAxisIndex:0}))),re=T?{show:!1,axisLabel:{show:!0,margin:0},axisLine:{show:!1}}:void 0;return(0,D.tZ)(m.Z,{router:Y,period:r,start:i,end:l,utc:y,children:e=>k?(0,D.tZ)(u.Z,{...e,ref:K,height:S,previousPeriod:n,additionalSeries:ee,xAxis:re,yAxes:ae.yAxes,tooltip:ae.tooltip,colors:Q,grid:N,legend:C?{top:0,right:0}:void 0,onClick:M,series:[...se.map((e=>{let{seriesName:t,data:n,...a}=e;return(0,f.Z)({...a,name:t,data:n?.map((e=>{let{value:t,name:n}=e;return[n,t]})),animation:!1,animationThreshold:1,animationDuration:0})})),...(R??[]).map((e=>{let{seriesName:t,data:n,...a}=e;return v({...a,name:t,data:n?.map((e=>{let{value:t,name:n}=e;return[n,t]})),animation:!1})}))]}):q?(0,D.tZ)(p.v,{height:S,series:se,xAxis:re,additionalSeries:ee,yAxes:ae.yAxes,tooltip:ae.tooltip,colors:Q,grid:N,legend:C?{top:0,right:0}:void 0}):(0,D.tZ)(c.T,{forwardedRef:K,height:S,...e,series:se,previousPeriod:n,additionalSeries:ee,xAxis:re,stacked:L,...ae})})}E.displayName="Chart";const S=E;function N(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const[t,n]=(0,a.useState)(!1);(0,a.useEffect)((()=>{e.every(Boolean)&&(r.$j(w),n(!0))}),[e,t])}},"./app/views/starfish/components/detailPanel.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>v});var a=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=n("../node_modules/react/index.js"),r=n("./app/components/button.tsx"),i=n("./app/icons/iconClose.tsx"),o=n("./app/locale.tsx"),l=n("./app/styles/space.tsx"),d=n("./app/utils/useKeyPress.tsx"),c=n("./app/utils/useOnClickOutside.tsx"),p=n("../node_modules/@emotion/is-prop-valid/dist/is-prop-valid.browser.esm.js"),u=n("../node_modules/framer-motion/dist/es/render/dom/motion.mjs"),m=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const h="50vw",g=(0,s.forwardRef)(f);function f(e,t){let{collapsed:n,children:a}=e;return(0,m.tZ)(y,{ref:t,collapsed:n,initial:{opacity:0,x:h},animate:n?{opacity:0,x:h}:{opacity:1,x:0},transition:{type:"spring",stiffness:500,damping:50},children:a})}f.displayName="SlideOverPanel";const y=(0,a.Z)(u.E.div,{shouldForwardProp:e=>["animate","transition","initial"].includes(e)||"collapsed"!==e&&(0,p.Z)(e),target:"e1iwvxg00"})("width:",h,";position:fixed;top:0;bottom:0;right:0;background:",(e=>e.theme.background),";color:",(e=>e.theme.textColor),";border-left:1px solid ",(e=>e.theme.border),";text-align:left;z-index:",(e=>e.theme.zIndex.sidebar-1),";",(e=>e.collapsed?"overflow: hidden;":"overflow-x: hidden;\n  overflow-y: scroll;"),";");function v(e){let{children:t,detailKey:n,onClose:a}=e;const[r,l]=(0,s.useState)({collapsed:!0}),p=(0,d.Z)("Escape");(0,s.useEffect)((()=>{n&&l({collapsed:!1})}),[n]);const u=(0,s.useRef)(null);return(0,c.Z)(u,(()=>{r.collapsed||(a?.(),l({collapsed:!0}))})),(0,s.useEffect)((()=>{p&&(r.collapsed||(a?.(),l({collapsed:!0})))}),[p]),(0,m.BX)(g,{collapsed:r.collapsed,ref:u,children:[(0,m.tZ)(_,{children:(0,m.tZ)(x,{priority:"link",size:"zero",borderless:!0,"aria-label":(0,o.t)("Close Details"),icon:(0,m.tZ)(i.b,{size:"sm"}),onClick:()=>{l({collapsed:!0}),a?.()}})}),(0,m.tZ)(Z,{children:t})]})}v.displayName="Detail";const x=(0,a.Z)(r.zx,{target:"e1clb2dw2"})("color:",(e=>e.theme.gray300),";&:hover{color:",(e=>e.theme.gray400),";}"),_=(0,a.Z)("div",{target:"e1clb2dw1"})("justify-content:flex-end;display:flex;padding:",(0,l.D)(2),";"),Z=(0,a.Z)("div",{target:"e1clb2dw0"})("padding:0 ",(0,l.D)(4),";")},"./app/views/starfish/components/samplesTable/common.tsx":(e,t,n)=>{"use strict";n.d(t,{fd:()=>i});var a=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=n("./app/locale.tsx"),r=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function i(e){let{duration:t,p50:n}=e;const a=t-n;if(Math.floor(t)===Math.floor(n))return(0,r.tZ)(o,{children:(0,s.t)("At baseline")});const i=a>0?`+${a.toFixed(2)}ms above`:`${a.toFixed(2)}ms below`;return(0,r.tZ)(l,{value:a,children:i})}i.displayName="DurationComparisonCell";const o=(0,a.Z)("div",{target:"e1tr2orr1"})({name:"2qga7i",styles:"text-align:right"}),l=(0,a.Z)("div",{target:"e1tr2orr0"})("text-align:right;color:",(e=>e.value<0?e.theme.green400:e.theme.red400),";")},"./app/views/starfish/components/textAlign.tsx":(e,t,n)=>{"use strict";n.d(t,{Dq:()=>s,_F:()=>i,xe:()=>r});var a=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js");const s=(0,a.Z)("span",{target:"e16p96xr2"})({name:"evqzij",styles:"text-align:right;width:100%"}),r=(0,a.Z)("span",{target:"e16p96xr1"})({name:"zq26zb",styles:"text-align:left;width:100%"}),i=(0,a.Z)("span",{target:"e16p96xr0"})({name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"})},"./app/views/starfish/utils/dates.tsx":(e,t,n)=>{"use strict";n.d(t,{Pr:()=>l,SW:()=>c,ie:()=>o,tZ:()=>p}),n("../node_modules/core-js/modules/es.error.cause.js");var a=n("../node_modules/moment/moment.js"),s=n.n(a),r=n("./app/utils/dates.tsx");function i(e,t){const n=s()(t).diff(s()(e)),a=s()(e).add(n/2);return(0,r.v5)(a)}function o(e){let{start:t,end:n,statsPeriod:a}=e;if(a)return i((0,r.Yz)("hours",(0,r.YJ)(a)).toDate(),new Date);if(!t||!n)throw new Error("start and end required");return i(t,n)}const l=/^(\d+)([h,d])$/,d="YYYY-MM-DD HH:mm:ss",c=e=>{if(!e)return{};const[t,n,a]=e.period?.match(l)??[];return{start_timestamp:(e.start&&s()(e.start).format(d))??(n&&a&&s()().subtract(n,a).startOf("minute").format(d)),end_timestamp:e.end&&s()(e.end).format(d)}};function p(e){const[t,n,a]=e.selection.datetime.period?.match(l)??[];return{startTime:n&&a?s()().subtract(n,a):s()(e.selection.datetime.start),endTime:s()(e.selection.datetime.end??void 0)}}},"./app/views/starfish/utils/zeroFillSeries.tsx":(e,t,n)=>{"use strict";n.d(t,{b:()=>r}),n("../node_modules/core-js/modules/es.array.push.js");var a=n("../node_modules/moment/moment.js"),s=n.n(a);function r(e,t,n,a,r){if(!e?.data?.length)return e;r||(r=0);const o=e.data[0],l=e.data[e.data.length-1],d=s()(o.name).creationData().format?.toString();if(!d)return e;const c=[],p=n&&i(n),u=a&&i(a),m=[...p&&p.diff(s()(o.name))<0?[{value:r,name:p.format(d)}]:[],...e.data,...u&&u.diff(s()(l.name))>0?[{value:r,name:u.format(d)}]:[]];let h,g,f,y,v;for(let e=0;e<m.length-1;e++){for(0===e&&c.push({...m[e],name:s()(m[e].name).format(d)}),h=m[e],g=m[e+1],f=s()(h.name),y=s()(g.name),v=s().duration(y.diff(f));v.asMilliseconds()>t.asMilliseconds();)f.add(t),c.push({value:r,name:s()(f).format(d)}),v=s().duration(s()(g.name).diff(f));c.push({...g,name:s()(g.name).format(d)})}return{...e,data:c}}function i(e){const t=e.hour(),n=e.clone().startOf("day");return t<12?n:n.add(12,"hour")}},"./app/views/starfish/views/spanSummaryPage/index.tsx":(e,t,n)=>{"use strict";n.r(t),n.d(t,{Block:()=>Ke,BlockContainer:()=>Ge,default:()=>Je});var a=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=n("./app/components/datePageFilter.tsx"),r=n("./app/components/layouts/thirds.tsx"),i=n("./app/components/organizations/pageFilters/container.tsx"),o=n("./app/components/questionTooltip.tsx"),l=n("./app/components/timeSince.tsx"),d=n("./app/locale.tsx"),c=n("./app/styles/space.tsx"),p=n("./app/utils/performance/contexts/pageError.tsx"),u=n("./app/components/version.tsx"),m=n("./app/components/versionHoverCard.tsx"),h=n("./app/utils/useOrganization.tsx"),g=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function f(e){let{release:t}=e;const n=(0,h.Z)();return(0,g.tZ)(y,{children:(0,g.tZ)(m.ZP,{organization:n,projectSlug:"sentry",releaseVersion:t.version,showUnderline:!0,underlineColor:"linkUnderline",children:(0,g.tZ)(u.Z,{version:String(t.version),truncate:!0})})})}f.displayName="ReleasePreview";const y=(0,a.Z)("div",{target:"e1eb1lni0"})("font-size:",(e=>e.theme.fontSizeMedium),";");var v=n("./app/utils/queryClient.tsx"),x=n("./app/views/starfish/utils/constants.tsx");n("../node_modules/core-js/modules/es.array.push.js");var _=n("./app/utils/usePageFilters.tsx"),Z=n("./app/views/starfish/utils/dates.tsx"),D=n("./app/views/starfish/utils/getDateQueryFilter.tsx");const w=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"span-metrics";const a=(0,_.Z)(),{startTime:s,endTime:r}=(0,Z.tZ)(a),i=(0,D.z)(s,r),o=[];t.transactionName&&o.push(`transaction = ${t.transactionName}`);const l=e?`\n  SELECT\n  count() as count,\n  min(timestamp) as first_seen,\n  max(timestamp) as last_seen,\n  sum(exclusive_time) as total_time,\n  quantile(0.5)(exclusive_time) as p50,\n  divide(count, multiply(12, 60)) as spm\n  FROM spans_experimental_starfish\n  WHERE group_id = '${e.group_id}'\n  ${i}\n  ${o.join(" AND ")}`:"",{isLoading:d,error:c,data:p}=(0,v.aM)({queryKey:["span-metrics",e?.group_id,i],queryFn:()=>fetch(`${x.M}/?query=${l}&referrer=${n}`).then((e=>e.json())),retry:!1,initialData:[],enabled:Boolean(e)});return{isLoading:d,error:c,data:p[0]??{}}};var b=n("../node_modules/moment/moment.js"),E=n.n(b),S=n("./app/utils/discover/discoverQuery.tsx"),N=n("./app/utils/discover/eventView.tsx"),T=(n("./app/utils/discover/genericDiscoverQuery.tsx"),n("./app/utils/discover/types.tsx"),n("./app/utils/useLocation.tsx"));n("./app/views/starfish/utils/useSpansQuery.tsx");const $=e=>{const t=`/api/0/projects/sentry/sentry/events/${e?.replaceAll("-","")}/`;return(0,v.aM)({enabled:!!e,queryKey:["event",e],queryFn:()=>fetch(t).then((e=>e.json())),retry:!1,initialData:{}})};var j=n("../node_modules/lodash/omit.js"),q=n.n(j),k=n("./app/utils/useRouter.tsx"),L=n("./app/views/starfish/components/detailPanel.tsx"),O=n("../node_modules/@emotion/react/dist/emotion-element-6a883da9.browser.esm.js"),I=n("./app/views/starfish/components/chart.tsx"),C=n("./app/views/starfish/utils/zeroFillSeries.tsx");const R=e=>{let{description:t,transactionName:n,datetime:a,groupId:s}=e;const{start_timestamp:r,end_timestamp:i}=(0,Z.SW)(a);return`SELECT\n     toStartOfInterval(start_timestamp, INTERVAL 12 HOUR) as interval,\n     quantile(0.5)(exclusive_time) as p50,\n     quantile(0.95)(exclusive_time) as p95,\n     divide(count(), multiply(12, 60)) as spm,\n     count() as count,\n     countIf(greaterOrEquals(status, 400) AND lessOrEquals(status, 599)) as failure_count,\n     failure_count / count as failure_rate\n     FROM spans_experimental_starfish\n     WHERE module = 'http'\n     ${t?`AND description = '${t}'`:""}\n     ${s?`AND group_id = '${s}'`:""}\n     ${n?`AND transaction = '${n}'`:""}\n     ${r?`AND greaterOrEquals(start_timestamp, '${r}')`:""}\n     ${i?`AND lessOrEquals(start_timestamp, '${i}')`:""}\n     GROUP BY interval\n     ORDER BY interval asc\n  `};let A;!function(e){e.FASTEST="fastest",e.MEDIAN="median",e.SLOWEST="slowest"}(A||(A={}));const F=e=>{const{groupId:t}=e,n=(0,_.Z)(),{startTime:a,endTime:s}=(0,Z.tZ)(n),r=(0,D.z)(a,s),i=`\n      SELECT\n      count() AS count,\n      quantile(0.5)(exclusive_time) as p50,\n      span_operation,\n      action,\n      module,\n      description\n    FROM\n      spans_experimental_starfish\n    WHERE\n    group_id = '${t}'\n    ${r}\n    GROUP BY\n      span_operation,\n      description,\n      action,\n      module\n  `;return(0,v.aM)({queryKey:["spansInTransaction",t,r],queryFn:()=>fetch(`${x.M}/?query=${i}&format=sql`).then((e=>e.json())),retry:!1,initialData:[]})},M=e=>{let{groupId:t,transactionName:n,user:a,populationType:s,datetime:r,p50:i}=e;const{start_timestamp:o,end_timestamp:l}=(0,Z.SW)(r);return`\n    SELECT transaction_id, transaction, description, user, domain, span_id, sum(exclusive_time) as exclusive_time, abs(minus(exclusive_time, ${i})) as diff\n    FROM spans_experimental_starfish\n    WHERE group_id = '${t}'\n    ${n?`AND transaction = '${n}'`:""}\n    ${a?`AND user = '${a}'`:""}\n    ${o?`AND greaterOrEquals(start_timestamp, '${o}')`:""}\n    ${l?`AND lessOrEquals(start_timestamp, '${l}')`:""}\n    GROUP BY transaction_id, transaction, description, user, domain, span_id\n    ORDER BY ${s!==A.SLOWEST&&s?s===A.FASTEST?"exclusive_time asc":"diff asc":"exclusive_time desc"}\n    LIMIT 3\n `},B=e=>{let{description:t,transactionName:n,datetime:a,groupId:s,module:r,interval:i}=e;const{start_timestamp:o,end_timestamp:l}=(0,Z.SW)(a);return`SELECT\n     toStartOfInterval(start_timestamp, INTERVAL 12 HOUR) as interval,\n     quantile(0.5)(exclusive_time) as p50,\n     quantile(0.95)(exclusive_time) as p95,\n     count() as count,\n     divide(count(), multiply(${i}, 60)) as spm,\n     countIf(greaterOrEquals(status, 400) AND lessOrEquals(status, 599)) as failure_count,\n     failure_count / count as failure_rate\n     FROM spans_experimental_starfish\n     WHERE module = '${r}'\n     ${t?`AND description = '${t}'`:""}\n     ${s?`AND group_id = '${s}'`:""}\n     ${n?`AND transaction = '${n}'`:""}\n     ${o?`AND greaterOrEquals(start_timestamp, '${o}')`:""}\n     ${l?`AND lessOrEquals(start_timestamp, '${l}')`:""}\n     GROUP BY interval\n     ORDER BY interval asc\n  `},P=e=>{let{description:t,transactionName:n,datetime:a,groupId:s,module:r}=e;const{start_timestamp:i,end_timestamp:o}=(0,Z.SW)(a);return`\n    SELECT\n    count() AS count,\n    quantile(0.5)(exclusive_time) as p50,\n    quantile(0.95)(exclusive_time) as p95,\n    countIf(greaterOrEquals(status, 400) AND lessOrEquals(status, 599)) as failure_count,\n    failure_count / count() as failure_rate,\n    sum(exclusive_time) as total_exclusive_time,\n    count(DISTINCT transaction_id) as count_unique_transaction_id,\n    count(DISTINCT transaction) as count_unique_transaction,\n    min(timestamp) as first_seen,\n    max(timestamp) as last_seen\n    FROM spans_experimental_starfish\n    WHERE 1 == 1\n    ${r?`AND module = '${r}'`:""}\n    ${t?`AND description = '${t}'`:""}\n    ${s?`AND group_id = '${s}'`:""}\n    ${n?`AND transaction = '${n}'`:""}\n    ${i?`AND greaterOrEquals(start_timestamp, '${i}')`:""}\n    ${o?`AND lessOrEquals(start_timestamp, '${o}')`:""}\n    ORDER BY count DESC\n    LIMIT 5\n `};var z=n("../node_modules/lodash/keyBy.js"),Y=n.n(z);const H=e=>{let{groupId:t,transactionName:n}=e;const{data:a,isLoading:s,isRefetching:r}=F({groupId:t}),i=(e=>{const{groupId:t,transactionName:n,user:a,p50:s}=e,r=(0,_.Z)(),i={queryKey:[t,n,a,r.selection.datetime,"spanSamples"],retry:!1,initialData:[],enabled:Boolean(t&&n&&s)},o={groupId:t,transactionName:n,user:a,datetime:r.selection.datetime,p50:s};return(0,v.hu)({queries:[{...i,queryKey:[...i.queryKey,"spanSamplesSlowest"],queryFn:()=>fetch(`${x.M}/?query=${M({...o,populationType:A.SLOWEST})}`).then((e=>e.json()))},{...i,queryKey:[...i.queryKey,"spanSamplesMedian"],queryFn:()=>fetch(`${x.M}/?query=${M({...o,populationType:A.MEDIAN})}`).then((e=>e.json()))},{...i,queryKey:[...i.queryKey,"spanSamplesFastest"],queryFn:()=>fetch(`${x.M}/?query=${M({...o,populationType:A.FASTEST})}`).then((e=>e.json()))}]})})({groupId:t,transactionName:n,p50:a[0]?.p50??0}),{data:o}=i.reduce(((e,t)=>t.isLoading?(e.isLoading=!0,e):(t.data.forEach((t=>{e.spanIds.has(t.span_id)||(e.spanIds.add(t.span_id),e.data.push(t))})),e)),{isLoading:!1,data:[],spanIds:new Set}),l=W(o),d=Y()(l?.data?.data,"id");return{data:o.map((e=>{const t=d[e.transaction_id.replaceAll("-","")];return{transaction:e.transaction,transaction_id:e.transaction_id,"project.name":t?.["project.name"],span_id:e.span_id,timestamp:t?.timestamp,spanOp:e.span_operation,spanDuration:e.exclusive_time,transactionDuration:t?.["transaction.duration"],exclusive_time:e.exclusive_time,p50Comparison:e.p50_comparison,user:e.user}})),isLoading:s||i.reduce(((e,t)=>e||t.isLoading),!1),isRefetching:r||i.reduce(((e,t)=>e||t.isRefetching),!1)}},W=e=>{const t=(0,T.T)(),{slug:n}=(0,h.Z)(),a=N.ZP.fromNewQueryWithLocation({fields:["id","timestamp","project.name"],name:"Starfish - Sample List - transaction data",projects:[1],version:2,query:`id:[${e.map((e=>e.transaction_id.replaceAll("-",""))).join(",")}]`},t);return(0,S._)({eventView:a,location:t,orgSlug:n})};function K(e){let{groupId:t,transactionName:n,spanDescription:a}=e;const s=(0,O.u)(),r=(0,_.Z)(),{isLoading:i,data:o}=F({groupId:t}),l=o?.[0]?.span_operation,d=o?.[0]?.module,{startTime:c,endTime:p}=X(r),{isLoading:u,data:m}=(e=>{const{description:t,groupId:n,spanGroupOperation:a,transactionName:s,module:r}=e,i=(0,_.Z)(),{getSeriesQuery:o}=function(e){switch(e){case"db":case"cache":default:return{getSeriesQuery:B,getAggregatesQuery:P};case"http.client":return{getSeriesQuery:R,getAggregatesQuery:P}}}(a),l=o({datetime:i.selection.datetime,groupId:n,module:r,description:t,interval:12,transactionName:s});return(0,v.aM)({queryKey:["seriesdata",s,r,i.selection.datetime,n],queryFn:()=>fetch(`${x.M}/?query=${l}&referrer=sidebar-aggregates`).then((e=>e.json())),retry:!1,initialData:[]})})({groupId:t,spanGroupOperation:l,transactionName:n,description:a,module:d}),{p50:h,p95:f}=function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s={};return e.length>0&&Object.keys(e[0]).filter((e=>"interval"!==e)).forEach((e=>{s[e]={data:[],seriesName:`${e}()`,...a}})),e.forEach((e=>{Object.keys(e).forEach((t=>{"interval"!==t&&s[t].data.push({name:e.interval,value:e[t]})}))})),Object.entries(s).forEach((e=>{let[a,r]=e;s[a]=(0,C.b)(r,E().duration(12,"hours"),t,n)})),s}(m,c,p),{data:y,isLoading:Z}=H({groupId:t,transactionName:n}),D=y.map((e=>{let{timestamp:t,spanDuration:n,transaction_id:a}=e;return{data:[{name:t,value:n}],seriesName:a.split("-")[0]}}));return(0,g.tZ)(I.Z,{statsPeriod:"24h",height:140,data:h&&f?[h,f]:[],start:"",end:"",loading:i||u,scatterPlot:Z?void 0:D,utc:!1,chartColors:s.charts.getColorPalette(4).slice(3,6),stacked:!0,isLineChart:!0,definedAxisTicks:4})}K.displayName="DurationChart";const X=e=>{const[t,n,a]=e.selection.datetime.period?.match(Z.Pr)??[];return{startTime:n&&a?E()().subtract(n,a):E()(e.selection.datetime.start),endTime:E()(e.selection.datetime.end??void 0)}},Q=K;var U=n("./app/utils/formatters.tsx"),G=n("./app/views/starfish/queries/useApplicationMetrics.tsx");const V=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"span-transaction-metrics";const a=(0,_.Z)(),{startTime:s,endTime:r}=(0,Z.tZ)(a),i=(0,D.z)(s,r),o=e&&t&&t.length>0?`\n    SELECT\n      transaction,\n      quantile(0.5)(exclusive_time) as p50,\n      sum(exclusive_time) as "sum(span.self_time)",\n      sum(exclusive_time) as total_time,\n      divide(count(), multiply(12, 60)) as spm\n    FROM spans_experimental_starfish\n    WHERE group_id = '${e.group_id}'\n    ${i}\n    AND transaction IN ('${t.join("','")}')\n    GROUP BY transaction\n `:"",{isLoading:l,error:d,data:c}=(0,v.aM)({queryKey:["span-transactions-metrics",e?.group_id,t?.join(",")||"",i],queryFn:()=>fetch(`${x.M}/?query=${o}&referrer=${n}`).then((e=>e.json())),retry:!1,initialData:[],enabled:Boolean(o)});return{isLoading:l,error:d,data:Y()(c,"transaction")}};function J(e){const{groupId:t,transactionName:n}=e,{data:a}=V({group_id:t},[n]),{data:s}=(0,G.T)(),r=a[n]?.spm,i=a[n]?.p50,o=a[n]?.total_time;return(0,g.BX)(Ge,{children:[(0,g.BX)(Ke,{title:(0,d.t)("Throughput"),children:[r?.toFixed(2)," / min"]}),(0,g.BX)(Ke,{title:(0,d.t)("Duration (P50)"),children:[i?.toFixed(2)," ms"]}),(0,g.BX)(Ke,{title:(0,d.t)("App Impact"),children:[(0,U.rl)(o/s["sum(span.duration)"])," %"]})]})}J.displayName="SampleInfo";const ee=J;var te=n("../node_modules/react-router/es/index.js"),ne=n("./app/components/dateTime.tsx"),ae=n("./app/components/gridEditable/index.tsx"),se=n("./app/views/performance/transactionSummary/transactionSpans/spanDetails/spanDetailsTable.tsx"),re=n("./app/views/starfish/components/samplesTable/common.tsx"),ie=n("./app/views/starfish/components/textAlign.tsx");const oe=[{key:"transaction_id",name:"Event ID",width:200},{key:"duration",name:"Span Duration",width:200},{key:"p50_comparison",name:"Compared to P50",width:200}];function le(e){let{isLoading:t,data:n,p50:a}=e;const s=(0,T.T)();return(0,g.tZ)(ae.ZP,{isLoading:t,data:n,columnOrder:oe,columnSortBy:[],grid:{renderHeadCell:function(e){return"p50_comparison"===e.key?(0,g.tZ)(ie.Dq,{children:(0,g.tZ)(ie._F,{children:e.name})}):(0,g.tZ)(ie._F,{children:e.name})},renderBodyCell:function(e,t){return"transaction_id"===e.key?(0,g.tZ)(te.Link,{to:`/performance/${t["project.name"]}:${t.transaction_id}#span-${t.span_id.slice(19).replace("-","")}`,children:t.transaction_id.slice(0,8)}):"duration"===e.key?(0,g.tZ)(se.i,{spanOp:t.spanOp,spanDuration:t.spanDuration,transactionDuration:t.transactionDuration}):"p50_comparison"===e.key?(0,g.tZ)(re.fd,{duration:t.spanDuration,p50:a}):"timestamp"===e.key?(0,g.tZ)(ne.Z,{date:t.timestamp,year:!0,timeZone:!0,seconds:!0}):(0,g.tZ)("span",{children:t[e.key]})}},location:s})}function de(e){let{groupId:t,transactionName:n}=e;const{data:a}=F({groupId:t}),s=a[0]?.p50??0,{data:r,isLoading:i}=H({groupId:t,transactionName:n});return(0,g.tZ)(le,{data:r,isLoading:i,p50:s})}le.displayName="SpanSamplesTable",de.displayName="SampleTable";const ce=de;function pe(e){let{groupId:t,transactionName:n,spanDescription:a}=e;const s=(0,k.Z)();return(0,g.BX)(L.Z,{detailKey:t,onClose:()=>{s.push({pathname:s.location.pathname,query:q()(s.location.query,"transaction")})},children:[(0,g.tZ)("h3",{children:n}),(0,g.tZ)(ee,{groupId:t,transactionName:n}),(0,g.tZ)("h5",{children:(0,d.t)("Duration (p50, p95)")}),(0,g.tZ)(Q,{groupId:t,transactionName:n,spanDescription:a}),(0,g.tZ)(ce,{groupId:t,transactionName:n})]})}pe.displayName="SampleList";const ue=pe;var me=n("../node_modules/react/index.js"),he=n("./app/views/starfish/colours.tsx"),ge=n("./app/views/starfish/components/formattedCode.tsx");const fe=(e,t)=>{let n="";return e.split("").map(((a,s)=>{n+=a;let r=null;if(n===t.action?r=(0,g.BX)(ye,{children:[t.action," "]},s):n===t.domain?r=(0,g.BX)(ve,{children:[t.domain," "]},s):["FROM","INNER","JOIN","WHERE","ON","AND","NOT","NULL","IS"].includes(n)?r=(0,g.tZ)(xe,{children:n},s):["(",")"].includes(n)?r=(0,g.tZ)(_e,{children:n},s):(" "===a||"\n"===a||")"===e[s+1]||s===e.length-1)&&(r=n),r){n="";const e=r;return r=null,e}return null}))},ye=(0,a.Z)("b",{target:"e1sm9bxn3"})("color:",(e=>e.theme.blue400),";"),ve=(0,a.Z)("b",{target:"e1sm9bxn2"})("color:",(e=>e.theme.green400),";margin-right:-",(0,c.D)(.5),";"),xe=(0,a.Z)("b",{target:"e1sm9bxn1"})("color:",(e=>e.theme.yellow400),";"),_e=(0,a.Z)("b",{target:"e1sm9bxn0"})("color:",(e=>e.theme.pink400),";");function Ze(e){let{span:t}=e;return t.span_operation.startsWith("db")?(0,g.tZ)(De,{span:t}):(0,g.tZ)("div",{children:t.description})}function De(e){let{span:t}=e;return(0,g.tZ)(we,{children:(0,g.tZ)(ge.K,{children:fe(t.formatted_desc||t.description||"",{action:t.action||"",domain:t.domain||""})})})}Ze.displayName="SpanDescription",De.displayName="DatabaseSpanDescription";const we=(0,a.Z)("div",{target:"elfaq7i0"})("font-size:",(e=>e.theme.fontSizeMedium),";");var be=n("./app/views/starfish/components/sparkline.tsx");const Ee=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"span-metrics-series";const n=(0,_.Z)(),{startTime:a,endTime:s}=(0,Z.tZ)(n),r=(0,D.z)(a,s),i=e?`\n  SELECT\n    toStartOfInterval(start_timestamp, INTERVAL 12 HOUR) as interval,\n    count() as count,\n    divide(count, multiply(12, 60)) as spm,\n    quantile(0.95)(exclusive_time) as p95,\n    quantile(0.50)(exclusive_time) as p50,\n    countIf(greaterOrEquals(status, 400) AND lessOrEquals(status, 599)) as "failure_count",\n    "failure_count" / "count" as "failure_rate"\n  FROM spans_experimental_starfish\n  WHERE group_id = '${e.group_id}'\n  ${r}\n  GROUP BY interval\n  ORDER BY interval\n`:"",{isLoading:o,error:l,data:d}=(0,v.aM)({queryKey:["span-metrics-series",e?.group_id],queryFn:()=>fetch(`${x.M}/?query=${i}&referrer=${t}`).then((e=>e.json())),retry:!1,initialData:[],enabled:Boolean(e)});return{isLoading:o,error:l,data:Y()(["spm","p50","p95","failure_rate"].map((e=>{const t={seriesName:e,data:d.map((t=>({value:t[e],name:t.interval})))};return(0,C.b)(t,E().duration(12,"hours"))})),"seriesName")}};function Se(e){let{span:t}=e;const n=(0,T.T)(),{data:a}=(0,G.T)(),{data:s}=w(t),{data:r}=Ee(t);return(0,g.tZ)(ae.ZP,{isLoading:!1,data:[{description:t.description??"",metrics:s,metricSeries:r,app_impact:(0,U.rl)(s.total_time/a["sum(span.duration)"])}],columnOrder:qe,columnSortBy:[],grid:{renderHeadCell:e=>(0,g.tZ)("span",{children:e.name}),renderBodyCell:(e,n)=>(0,g.tZ)(Ne,{span:t,column:e,row:n})},location:n})}function Ne(e){let{span:t,column:n,row:a}=e;return"description"===n.key?(0,g.tZ)(Te,{span:t,row:a,column:n}):"p50(span.self_time)"===n.key?(0,g.tZ)($e,{span:t,row:a,column:n}):"epm()"===n.key?(0,g.tZ)(je,{span:t,row:a,column:n}):(0,g.tZ)("span",{children:a[n.key]})}function Te(e){let{span:t}=e;return(0,g.tZ)(Ze,{span:t})}function $e(e){let{row:t}=e;const n=(0,O.u)(),a=t.metrics?.p50,s=t.metricSeries?.p50;return(0,g.tZ)(me.Fragment,{children:s?(0,g.tZ)(be.ZP,{color:he.v$,series:s,markLine:a?(0,be.Fk)(`${a.toFixed(2)}`,a,n):void 0}):null})}function je(e){let{row:t}=e;const n=(0,O.u)(),a=t.metrics?.spm,s=t.metricSeries?.spm;return(0,g.tZ)(me.Fragment,{children:s?(0,g.tZ)(be.ZP,{color:he.SQ,series:s,markLine:a?(0,be.Fk)(`${a.toFixed(2)}`,a,n):void 0}):null})}Se.displayName="SpanBaselineTable",Ne.displayName="BodyCell",Te.displayName="DescriptionCell",$e.displayName="P50Cell",je.displayName="EPMCell";const qe=[{key:"description",name:"Description",width:500},{key:"epm()",name:"Throughput (TPM)",width:ae.z7},{key:"p50(span.self_time)",name:"Duration (P50)",width:ae.z7},{key:"app_impact",name:"App Impact",width:ae.z7}];var ke=n("../node_modules/query-string/index.js"),Le=n("./app/components/links/link.tsx"),Oe=n("./app/components/truncate.tsx"),Ie=n("../node_modules/lodash/groupBy.js"),Ce=n.n(Ie);const Re=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"span-transaction-metrics-series";const a=(0,_.Z)(),{startTime:s,endTime:r}=(0,Z.tZ)(a),i=(0,D.z)(s,r),o=e&&t&&t.length>0?`SELECT\n     transaction,\n     toStartOfInterval(start_timestamp, INTERVAL 12 hour) as interval,\n     quantile(0.50)(exclusive_time) AS p50,\n     divide(count(), multiply(12, 60)) as spm\n   FROM spans_experimental_starfish\n   WHERE\n     transaction IN ('${t.join("','")}')\n     AND group_id = '${e.group_id}'\n     ${i}\n   GROUP BY transaction, interval\n   ORDER BY transaction, interval\n `:"",{isLoading:l,error:d,data:c}=(0,v.aM)({queryKey:["span-metrics-series",e?.group_id,t?.join(",")||""],queryFn:()=>fetch(`${x.M}/?query=${o}&referrer=${n}`).then((e=>e.json())),retry:!1,initialData:[],enabled:Boolean(o)}),p={},u=Ce()(c,"transaction");return Object.keys(u).forEach((e=>{const t=Y()(["spm","p50"].map((e=>{const t={seriesName:e,data:c.map((t=>({value:t[e],name:t.interval})))};return(0,C.b)(t,E().duration(12,"hours"))})),"seriesName");p[e]=t})),{isLoading:l,error:d,data:p}},Ae=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"span-transactions";const n=(0,_.Z)(),{startTime:a,endTime:s}=(0,Z.tZ)(n),r=(0,D.z)(a,s),i=e?`\n  SELECT\n    transaction,\n    count() AS count\n  FROM spans_experimental_starfish\n  WHERE\n    group_id = '${e.group_id}'\n    ${r}\n  GROUP BY transaction\n  ORDER BY -power(10, floor(log10(count()))), -quantile(0.75)(exclusive_time)\n  LIMIT 5\n`:"",{isLoading:o,error:l,data:d}=(0,v.aM)({queryKey:["span-transactions",e?.group_id],queryFn:()=>fetch(`${x.M}/?query=${i}&referrer=${t}`).then((e=>e.json())),retry:!1,initialData:[],enabled:Boolean(e)});return{isLoading:o,error:l,data:d}};function Fe(e){let{span:t,openSidebar:n,onClickTransaction:a}=e;const s=(0,T.T)(),{data:r}=(0,G.T)(),{data:i,isLoading:o}=Ae(t),{data:l}=V(t,i.map((e=>e.transaction))),{data:d}=Re(t,i.map((e=>e.transaction))),c=i.map((e=>({...e,app_impact:(0,U.rl)(l[e.transaction]?.["sum(span.self_time)"]/r["sum(span.duration)"]),metrics:l[e.transaction],metricSeries:d[e.transaction]})));return(0,g.tZ)(ae.ZP,{isLoading:o,data:c,columnOrder:Ye,columnSortBy:[],grid:{renderHeadCell:e=>(0,g.tZ)("span",{children:e.name}),renderBodyCell:(e,s)=>(0,g.tZ)(Me,{span:t,column:e,row:s,openSidebar:n,onClickTransactionName:a})},location:s})}function Me(e){let{span:t,column:n,row:a,openSidebar:s,onClickTransactionName:r}=e;return"transaction"===n.key?(0,g.tZ)(Be,{span:t,row:a,column:n,openSidebar:s,onClickTransactionName:r}):"p50(transaction.duration)"===n.key?(0,g.tZ)(Pe,{span:t,row:a,column:n}):"epm()"===n.key?(0,g.tZ)(ze,{span:t,row:a,column:n}):(0,g.tZ)("span",{children:a[n.key]})}function Be(e){let{span:t,column:n,row:a}=e;return(0,g.tZ)(me.Fragment,{children:(0,g.tZ)(Le.Z,{to:`/starfish/span/${encodeURIComponent(t.group_id)}?${ke.stringify({transaction:a.transaction})}`,children:(0,g.tZ)(Oe.Z,{value:a[n.key],maxLength:75})})})}function Pe(e){let{row:t}=e;const n=(0,O.u)(),a=t.metrics?.p50,s=t.metricSeries?.p50;return(0,g.tZ)(me.Fragment,{children:s?(0,g.tZ)(be.ZP,{color:he.v$,series:s,markLine:a?(0,be.Fk)(`${a.toFixed(2)}`,a,n):void 0}):null})}function ze(e){let{row:t}=e;const n=(0,O.u)(),a=t.metrics?.spm,s=t.metricSeries?.spm;return(0,g.tZ)(me.Fragment,{children:s?(0,g.tZ)(be.ZP,{color:he.SQ,series:s,markLine:a?(0,be.Fk)(`${a.toFixed(2)}`,a,n):void 0}):null})}Fe.displayName="SpanTransactionsTable",Me.displayName="BodyCell",Be.displayName="TransactionCell",Pe.displayName="P50Cell",ze.displayName="EPMCell";const Ye=[{key:"transaction",name:"In Endpoint",width:500},{key:"epm()",name:"Throughput (TPM)",width:ae.z7},{key:"p50(transaction.duration)",name:"Duration (P50)",width:ae.z7},{key:"app_impact",name:"App Impact",width:ae.z7}];function He(e){let{params:t,location:n}=e;const{groupId:a}=t,{transaction:o}=n.query,{data:c}=((e,t)=>{const n=`\n  SELECT\n    group_id,\n    action,\n    description,\n    span_operation\n    FROM spans_experimental_starfish\n    WHERE group_id = '${e}'\n    LIMIT 1\n  `,a=(0,v.aM)({queryKey:["span-by-id",e],queryFn:()=>fetch(`${x.M}/?query=${n}&referrer=span-summary-page&format=sql`).then((e=>e.json())),retry:!1,initialData:[],enabled:Boolean(e)});return{...a,data:a.data[0]}})(a),{data:u}=w({group_id:a}),{data:m}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"span-first-seen-event";const{data:n}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"first-seen-span";const n=e?`\n    SELECT transaction_id\n    FROM spans_experimental_starfish\n    WHERE group_id = '${e.group_id}'\n    ORDER BY start_timestamp ASC\n    LIMIT 1\n `:null,a=(0,v.aM)({queryKey:["span","first",e?.group_id],queryFn:()=>fetch(`${x.M}/?query=${n}&referrer=${t}`).then((e=>e.json())),retry:!1,initialData:[],enabled:Boolean(e)});return{...a,data:a.data[0]}}(e,t);return $(n?.transaction_id)}({group_id:a}),{data:h}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"span-last-seen-event";const{data:n}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"last-seen-span";const n=e?`\n    SELECT transaction_id\n    FROM spans_experimental_starfish\n    WHERE group_id = '${e.group_id}'\n    ORDER BY start_timestamp DESC\n    LIMIT 1\n `:null,a=(0,v.aM)({queryKey:["span","last",e?.group_id],queryFn:()=>fetch(`${x.M}/?query=${n}&referrer=${t}`).then((e=>e.json())),retry:!1,initialData:[],enabled:Boolean(e)});return{...a,data:a.data[0]}}(e,t);return $(n?.transaction_id)}({group_id:a});return(0,g.tZ)(r.T3,{children:(0,g.tZ)(i.Z,{children:(0,g.BX)(p.V_,{children:[(0,g.BX)(r.h4,{children:[(0,g.tZ)(r.oB,{children:(0,g.tZ)(r.Dx,{children:" Span Summary "})})," "]}),(0,g.tZ)(r.uT,{children:(0,g.BX)(r.or,{fullWidth:!0,children:[(0,g.tZ)(p.YY,{}),(0,g.tZ)(We,{children:(0,g.tZ)(s.Z,{alignDropdown:"left"})}),(0,g.BX)(Ge,{children:[(0,g.tZ)(Ke,{title:(0,d.t)("Operation"),children:c?.span_operation}),(0,g.BX)(Ke,{title:(0,d.t)("First Seen"),description:(0,d.t)("The first time this span was ever seen in the current retention window"),children:[(0,g.tZ)(l.Z,{date:u?.first_seen}),m?.release&&(0,g.tZ)(f,{release:m?.release})]}),(0,g.BX)(Ke,{title:(0,d.t)("Last Seen"),description:(0,d.t)("The most recent time this span was seen"),children:[(0,g.tZ)(l.Z,{date:u?.last_seen}),h?.release&&(0,g.tZ)(f,{release:h?.release})]})]}),c&&(0,g.tZ)(Se,{span:c}),c&&(0,g.tZ)(Fe,{span:c}),o&&c?.group_id&&(0,g.tZ)(ue,{groupId:c.group_id,transactionName:o})]})})]})})})}He.displayName="SpanSummaryPage";const We=(0,a.Z)("div",{target:"eby1jon5"})("display:flex;flex-direction:row;gap:",(0,c.D)(1),";align-items:center;margin-bottom:",(0,c.D)(2),";");function Ke(e){let{title:t,description:n,children:a}=e;return(0,g.BX)(Ve,{children:[(0,g.BX)(Xe,{children:[t,n&&(0,g.tZ)(Ue,{children:(0,g.tZ)(o.Z,{size:"sm",position:"right",title:n})})]}),(0,g.tZ)(Qe,{children:a})]})}Ke.displayName="Block";const Xe=(0,a.Z)("h3",{target:"eby1jon4"})("color:",(e=>e.theme.gray300),";font-size:",(e=>e.theme.fontSizeMedium),";margin:0;margin-bottom:",(0,c.D)(1),";"),Qe=(0,a.Z)("h4",{target:"eby1jon3"})({name:"3in70x",styles:"margin:0;font-weight:normal"}),Ue=(0,a.Z)("span",{target:"eby1jon2"})("margin-left:",(0,c.D)(1),";"),Ge=(0,a.Z)("div",{target:"eby1jon1"})("display:flex;&>div:last-child{padding-right:",(0,c.D)(1),";}padding-bottom:",(0,c.D)(2),";"),Ve=(0,a.Z)("div",{target:"eby1jon0"})("padding-right:",(0,c.D)(4),";flex:1;"),Je=He},"../node_modules/lodash/groupBy.js":(e,t,n)=>{var a=n("../node_modules/lodash/_baseAssignValue.js"),s=n("../node_modules/lodash/_createAggregator.js"),r=Object.prototype.hasOwnProperty,i=s((function(e,t,n){r.call(e,n)?e[n].push(t):a(e,n,[t])}));e.exports=i}}]);
//# sourceMappingURL=../sourcemaps/app_views_starfish_views_spanSummaryPage_index_tsx.1186277653159b119db2868f89779434.js.map