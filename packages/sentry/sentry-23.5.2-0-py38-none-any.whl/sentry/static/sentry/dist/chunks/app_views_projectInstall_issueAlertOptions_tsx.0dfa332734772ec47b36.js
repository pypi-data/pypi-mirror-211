"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_projectInstall_issueAlertOptions_tsx"],{"./app/views/projectInstall/issueAlertOptions.tsx":(t,e,n)=>{n.d(e,{FZ:()=>y,ZP:()=>w,rq:()=>_});var s,i,a=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=(n("../node_modules/core-js/modules/es.error.cause.js"),n("../node_modules/react/index.js")),o=n("../node_modules/@sentry/core/esm/exports.js"),l=n("../node_modules/lodash/isEqual.js"),d=n.n(l),c=n("./app/components/asyncComponent.tsx"),p=n("./app/components/forms/controls/radioGroup.tsx"),u=n("./app/components/forms/controls/selectControl.tsx"),h=n("./app/components/input.tsx"),E=n("./app/components/layouts/thirds.tsx"),m=n("./app/locale.tsx"),S=n("./app/styles/space.tsx"),g=n("./app/utils/withOrganization.tsx"),v=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");!function(t){t[t.ERRORS=0]="ERRORS",t[t.USERS=1]="USERS"}(s||(s={})),function(t){t[t.ALERT_ON_EVERY_ISSUE=0]="ALERT_ON_EVERY_ISSUE",t[t.CUSTOMIZED_ALERTS=1]="CUSTOMIZED_ALERTS",t[t.CREATE_ALERT_LATER=2]="CREATE_ALERT_LATER"}(i||(i={}));const R="sentry.rules.conditions.event_frequency.EventUniqueUserFrequencyCondition",A="sentry.rules.conditions.event_frequency.EventFrequencyCondition",_="sentry.rules.conditions.event_frequency.EventFrequencyPercentCondition",y="sentry.rules.conditions.reappeared_event.ReappearedEventCondition",f={id:"sentry.mail.actions.NotifyEmailAction",targetType:"IssueOwners"},T={[s.ERRORS]:A,[s.USERS]:R};function b(t,e,n){let i;switch(e){case s.ERRORS:i=A;break;case s.USERS:i=R;break;default:throw new RangeError("Supplied metric value is not handled")}return{interval:t,id:i,value:n}}class C extends c.Z{getDefaultState(){return{...super.getDefaultState(),conditions:[],intervalChoices:[],alertSetting:i.ALERT_ON_EVERY_ISSUE.toString(),metric:s.ERRORS,interval:"",threshold:""}}getAvailableMetricOptions(){return[{value:s.ERRORS,label:(0,m.t)("occurrences of")},{value:s.USERS,label:(0,m.t)("users affected by")}].filter((t=>{let{value:e}=t;return this.state.conditions?.some?.((t=>t?.id===T[e]))}))}getIssueAlertsChoices(t){const e=[i.CUSTOMIZED_ALERTS.toString(),(0,v.BX)(x,{onClick:t=>{t.preventDefault();const e=i.CUSTOMIZED_ALERTS.toString();this.setStateAndUpdateParents({alertSetting:e})},children:[(0,m.t)("When there are more than"),(0,v.tZ)(Z,{type:"number",min:"0",name:"",placeholder:"10",value:this.state.threshold,onChange:t=>this.setStateAndUpdateParents({threshold:t.target.value}),"data-test-id":"range-input"}),(0,v.tZ)(O,{value:this.state.metric,options:this.getAvailableMetricOptions(),onChange:t=>this.setStateAndUpdateParents({metric:t.value})}),(0,m.t)("a unique error in"),(0,v.tZ)(O,{value:this.state.interval,options:this.state.intervalChoices?.map((t=>{let[e,n]=t;return{value:e,label:n}})),onChange:t=>this.setStateAndUpdateParents({interval:t.value})})]},i.CUSTOMIZED_ALERTS)];return[[i.ALERT_ON_EVERY_ISSUE.toString(),(0,m.t)("Alert me on every new issue")],...t?[e]:[],[i.CREATE_ALERT_LATER.toString(),(0,m.t)("I'll create my own alerts later")]].map((t=>{let[e,n]=t;return[e,(0,v.tZ)(q,{children:n},e)]}))}getUpdatedData(){let t,e;switch(parseInt(this.state.alertSetting,10)){case i.ALERT_ON_EVERY_ISSUE:t=!0,e=!1;break;case i.CREATE_ALERT_LATER:t=!1,e=!1;break;case i.CUSTOMIZED_ALERTS:t=!1,e=!0;break;default:throw new RangeError("Supplied alert creation action is not handled")}return{defaultRules:t,shouldCreateCustomRule:e,name:"Send a notification for new issues",conditions:this.state.interval.length>0&&this.state.threshold.length>0?[b(this.state.interval,this.state.metric,this.state.threshold)]:void 0,actions:[{...f,...this.props.organization.features.includes("issue-alert-fallback-targeting")?{fallthroughType:"ActiveMembers"}:{}}],actionMatch:"all",frequency:5}}setStateAndUpdateParents(t){this.setState(t,(()=>{this.props.onChange(this.getUpdatedData())}))}getEndpoints(){return[["conditions",`/projects/${this.props.organization.slug}/rule-conditions/`]]}onLoadAllEndpointsSuccess(){const t=this.state.conditions?.filter?.((t=>Object.values(T).includes(t?.id)));if(!t||0===t.length)return void this.setStateAndUpdateParents({conditions:void 0});const{intervalChoices:e,interval:n}=function(t){const e=t.map((t=>t.formFields?.interval?.choices)).reduce(((t,e)=>t&&e&&d()(t,e)?t:null));return{intervalChoices:e,interval:e?.[0]?.[0]}}(t);if(!e||!n)return o.$e((t=>{t.setExtra("props",this.props),t.setExtra("state",this.state),o.Tb(new Error("Interval choices or sent from API endpoint is inconsistent or empty"))})),void this.setStateAndUpdateParents({conditions:void 0});this.setStateAndUpdateParents({conditions:t,intervalChoices:e,interval:n})}renderBody(){const t=this.getIssueAlertsChoices(this.state.conditions?.length>0);return(0,v.BX)(r.Fragment,{children:[(0,v.tZ)(L,{withMargins:!0,children:(0,m.t)("2. Set your alert frequency")}),(0,v.tZ)(U,{children:(0,v.tZ)(I,{choices:t,label:(0,m.t)("Options for creating an alert"),onChange:t=>this.setStateAndUpdateParents({alertSetting:t}),value:this.state.alertSetting})})]})}}const w=(0,g.Z)(C),U=(0,a.Z)("div",{target:"e1ypwq0i6"})("padding-top:",(0,S.D)(2),";padding-bottom:",(0,S.D)(4),";"),x=(0,a.Z)("div",{target:"e1ypwq0i5"})("display:grid;grid-template-columns:repeat(5, max-content);gap:",(0,S.D)(1),";align-items:center;"),Z=(0,a.Z)(h.Z,{target:"e1ypwq0i4"})({name:"m0jwvv",styles:"width:80px"}),O=(0,a.Z)(u.Z,{target:"e1ypwq0i3"})({name:"efbx4f",styles:"width:160px"}),I=(0,a.Z)(p.Z,{target:"e1ypwq0i2"})("margin-bottom:",(0,S.D)(2),";"),L=(0,a.Z)(E.Dx,{target:"e1ypwq0i1"})("margin-top:65px;margin-bottom:0;padding-bottom:",(0,S.D)(3),";border-bottom:1px solid rgba(0, 0, 0, 0.1);"),q=(0,a.Z)("div",{target:"e1ypwq0i0"})({name:"p9mutn",styles:"min-height:35px;display:flex;flex-direction:column;justify-content:center"})}}]);
//# sourceMappingURL=../sourcemaps/app_views_projectInstall_issueAlertOptions_tsx.2fb8798ba3f298bb46b0cd392f612c65.js.map