"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_profiling_flamegraph_flamegraphZoomView_tsx-app_utils_profiling_flamegraph_fla-8da03b"],{"./app/components/gridEditable/sortLink.tsx":(e,t,r)=>{r.d(t,{Z:()=>p});var n=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=r("../node_modules/react-router/es/index.js"),i=r("./app/components/links/link.tsx"),s=r("./app/icons/index.tsx"),a=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function l(e){let{align:t,title:r,canSort:n,generateSortLink:i,onClick:s,direction:l,replace:p}=e;const h=i();if(!h||!n)return(0,a.tZ)(u,{align:t,children:r});const f=l?(0,a.tZ)(d,{size:"xs",direction:"desc"===l?"down":"up"}):null;return(0,a.BX)(c,{align:t,to:h,onClick:e=>{p&&(e.preventDefault(),o.browserHistory.replace(h)),s?.(e)},children:[r," ",f]})}l.displayName="SortLink";const c=(0,n.Z)((e=>{const{align:t,css:r,...n}=e;return(0,a.tZ)(i.Z,{...n})}),{target:"esdhr0u2"})("display:block;width:100%;white-space:nowrap;color:inherit;&:hover,&:active,&:focus,&:visited{color:inherit;}",(e=>e.align?`text-align: ${e.align};`:""),";"),u=(0,n.Z)("div",{target:"esdhr0u1"})("display:block;width:100%;white-space:nowrap;",(e=>e.align?`text-align: ${e.align};`:""),";"),d=(0,n.Z)(s.CC,{target:"esdhr0u0"})({name:"40f4ru",styles:"vertical-align:top"}),p=l},"./app/components/profiling/flamegraph/flamegraphZoomView.tsx":(e,t,r)=>{r.d(t,{L:()=>ne});var n=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=r("../node_modules/react/index.js"),i=r("../node_modules/gl-matrix/esm/vec2.js"),s=r("./app/actionCreators/indicator.tsx"),a=r("../node_modules/react-dom/profiling.js"),l=r("../node_modules/react-popper/lib/esm/usePopper.js"),c=r("./app/components/links/link.tsx"),u=r("./app/components/profiling/flex.tsx"),d=r("./app/components/profiling/profilingContextMenu.tsx"),p=r("./app/icons/index.tsx"),h=r("./app/locale.tsx"),f=r("./app/utils.tsx"),m=r("./app/utils/events.tsx"),g=r("./app/utils/profiling/flamegraph/hooks/useFlamegraphPreferences.ts"),v=r("./app/utils/profiling/flamegraph/hooks/useFlamegraphState.ts"),_=r("./app/utils/profiling/routes.tsx"),w=r("./app/utils/useApi.tsx"),x=r("./app/utils/useOrganization.tsx"),b=r("./app/utils/useProjects.tsx"),y=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const C=["by system vs application frame","by system frame","by application frame","by symbol name","by library","by recursion","by frequency"],R=["top down","bottom up"],S=["call order","alphabetical","left heavy"];function E(e){return void 0!==e&&("node"===e||"python"===e)}function k(e){const t=(0,w.Z)(),{projects:r}=(0,b.Z)(),n=(0,x.Z)(),i=(0,g.K)(),s=(0,v.T)(),[a,l]=(0,o.useState)({type:"initial"}),c=r.find((t=>t.id===String(e.profileGroup?.metadata?.projectID)));(0,o.useEffect)((()=>{if(!e.hoveredNode||!e.profileGroup)return l({type:"initial"});if(!E(e.profileGroup.metadata.platform))return;if(!c||!e.hoveredNode)return;const r=e.profileGroup.metadata,o=r.release?.lastCommit?.id,i=r.platform,s=e.hoveredNode.frame;return l({type:"loading"}),t.requestPromise(`/projects/${n.slug}/${c.slug}/stacktrace-link/`,{query:{file:s.file,platform:i,commitId:o,...s.path&&{absPath:s.path}}}).then((e=>{l({type:"resolved",data:e})})),()=>{t.clear()}}),[e.hoveredNode,t,c,n,e.profileGroup]);const u=(0,o.useCallback)((()=>{if("resolved"!==a.type)return;if(!a.data.sourceUrl||"github"!==a.data.config?.provider?.key)return;const t=(0,f.ri)(e.hoveredNode)&&(0,f.ri)(e.hoveredNode.frame.line)?`${a.data.sourceUrl}#L${e.hoveredNode.frame.line}`:a.data.sourceUrl;window.open(t,"_blank","noopener,noreferrer")}),[e.hoveredNode,a]);return e.contextMenu.open?(0,y.BX)(o.Fragment,{children:[(0,y.tZ)(d.rE,{onClick:()=>e.contextMenu.setOpen(!1)}),(0,y.BX)(d.n2,{...e.contextMenu.getMenuProps(),style:{position:"absolute",left:e.contextMenu.position?.left??-9999,top:e.contextMenu.position?.top??-9999,maxHeight:e.contextMenu.containerCoordinates?.height??"auto"},children:[e.hoveredNode?(0,y.BX)(d.dE,{children:[(0,y.tZ)(d.mP,{children:(0,h.t)("Frame")}),e.hoveredNode.profileIds&&(0,y.tZ)(Z,{contextMenu:e.contextMenu,profileIds:e.hoveredNode.profileIds,frameName:e.hoveredNode.frame.name,framePackage:e.hoveredNode.frame.package,organizationSlug:n.slug,projectSlug:c?.slug,subMenuPortalRef:e.contextMenu.subMenuRef.current}),(0,y.tZ)(d.pb,{...e.contextMenu.getMenuItemProps({onClick:e.onHighlightAllOccurencesClick}),checked:e.isHighlightingAllOccurences,children:(0,h.t)("Highlight all occurrences")}),(0,y.tZ)(d.Oz,{...e.contextMenu.getMenuItemProps({onClick:()=>{e.onCopyFunctionNameClick(),e.contextMenu.setOpen(!1)}}),icon:(0,y.tZ)(p.vU,{size:"xs"}),children:(0,h.t)("Copy function name")}),(0,y.tZ)(d.Oz,{disabled:"resolved"!==a.type||!("resolved"===a.type&&a.data.sourceUrl),tooltip:E(e.profileGroup?.metadata?.platform)?"resolved"!==a.type||a.data.sourceUrl&&"github"===a.data.config?.provider?.key?void 0:(0,h.t)("Could not find source code location in GitHub"):(0,h.t)("Open in GitHub is not yet supported for this platform"),...e.contextMenu.getMenuItemProps({onClick:u}),icon:(0,y.tZ)(p.Uv,{size:"xs"}),children:(0,h.t)("Open in GitHub")})]}):null,(0,y.BX)(d.dE,{children:[(0,y.tZ)(d.mP,{children:(0,h.t)("Color Coding")}),C.map(((t,r)=>(0,y.tZ)(d.pb,{...e.contextMenu.getMenuItemProps({onClick:()=>s({type:"set color coding",payload:t})}),onClick:()=>s({type:"set color coding",payload:t}),checked:i.colorCoding===t,children:t},r)))]}),(0,y.BX)(d.dE,{children:[(0,y.tZ)(d.mP,{children:(0,h.t)("View")}),R.map(((t,r)=>(0,y.tZ)(d.pb,{...e.contextMenu.getMenuItemProps({onClick:()=>s({type:"set view",payload:t})}),onClick:()=>s({type:"set view",payload:t}),checked:i.view===t,children:t},r)))]}),(0,y.BX)(d.dE,{children:[(0,y.tZ)(d.mP,{children:(0,h.t)("Sorting")}),S.map(((t,r)=>e.disableCallOrderSort&&"call order"===t?null:(0,y.tZ)(d.pb,{...e.contextMenu.getMenuItemProps({onClick:()=>s({type:"set sorting",payload:t})}),onClick:()=>s({type:"set sorting",payload:t}),checked:i.sorting===t,children:t},r)))]})]}),(0,y.tZ)("div",{ref:t=>e.contextMenu.subMenuRef.current=t,id:"sub-menu-portal"})]}):null}var I={name:"vk31ov",styles:"max-height:250px"},F={name:"1sv8rb9",styles:"color:unset"};function Z(e){const[t,r]=(0,o.useState)(!1),n=(0,o.useRef)(null),i=(0,l.D)(n.current,e.subMenuPortalRef,{placement:"right-start",modifiers:[{name:"offset",options:{offset:[-16,0]}}]}),s=(0,o.useCallback)((e=>{r(e),i.update?.()}),[i]),f=(0,o.useRef)();(0,o.useEffect)((()=>{const t=t=>{f.current=t.target,setTimeout((()=>{f.current&&(n.current?.contains(f.current)||e.subMenuPortalRef?.contains(f.current)||s(!1))}),250)};return document.addEventListener("mouseover",t),()=>{document.removeEventListener("mouseover",t)}}),[e.subMenuPortalRef,s]);const g=(0,o.useCallback)((t=>e.projectSlug?(0,_.u$)({orgSlug:e.organizationSlug,projectSlug:e.projectSlug,profileId:t,frameName:e.frameName,framePackage:e.framePackage}):{}),[e.frameName,e.framePackage,e.organizationSlug,e.projectSlug]);return(0,y.BX)(o.Fragment,{children:[(0,y.tZ)(d.Oz,{icon:(0,y.tZ)(p.eb,{size:"xs"}),...e.contextMenu.getMenuItemProps({onClick:()=>{s(!0)},ref:e=>n.current=e}),onMouseEnter:()=>{s(!0)},children:(0,y.BX)(u.k,{w:"100%",justify:"space-between",align:"center",children:[(0,y.BX)(u.k.Item,{children:[(0,h.t)("Appears in %s profiles",e.profileIds.length)," "]}),(0,y.tZ)(p.g6,{direction:"right",size:"xs"})]})}),t&&e.subMenuPortalRef&&(0,a.createPortal)((0,y.tZ)(d.n2,{style:i.styles.popper,css:I,children:(0,y.BX)(d.dE,{children:[(0,y.tZ)(d.mP,{children:(0,h.t)("Profiles")}),e.profileIds.map((t=>{const r=g(t);return(0,y.tZ)(d.Oz,{...e.contextMenu.getMenuItemProps({}),children:(0,y.BX)(c.Z,{to:r,css:F,children:[(0,m.XQ)(t)," "]})},t)}))]})}),e.subMenuPortalRef)]})}Z.displayName="ProfileIdsSubMenu";var O=r("./app/components/profiling/flamegraph/flamegraphTooltip.tsx"),L=r("./app/utils/profiling/canvasScheduler.tsx");function D(e,t){let r=e;for(;r;){const e=M(r,t);if(e)return e;if(!r.parent)break;r=r.parent}return e}function M(e,t){const r=e.parent;if(!r)return null;const n=r.children.indexOf(e);if(-1===n)throw Error("frame.parent.children does not include current frame");return"right"===t?n<r.children.length-1?r.children[n+1]:null:n>0?r.children[n-1]:null}r("../node_modules/core-js/modules/es.error.cause.js");const j={ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right",Tab:"down","Shift+Tab":"up"};var P=r("./app/utils/profiling/flamegraph/hooks/useFlamegraphSearch.ts"),A=r("./app/utils/profiling/flamegraph/useFlamegraphTheme.ts"),T=r("./app/utils/profiling/flamegraphFrame.tsx"),N=r("./app/utils/profiling/gl/utils.ts"),z=r("./app/utils/profiling/hooks/useContextMenu.tsx");const B="__fgdb__";var H=r("./app/utils/profiling/renderers/flamegraphTextRenderer.tsx"),X=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),G=r("./app/utils/profiling/speedscope.tsx");function W(e,t){const r=e[0]*t+e[6];return r>1?Math.round(r):Math.round(10*r)/10}class V{constructor(e,t,r){(0,X.Z)(this,"canvas",void 0),(0,X.Z)(this,"context",void 0),(0,X.Z)(this,"theme",void 0),(0,X.Z)(this,"formatter",void 0),this.canvas=e,this.theme=t,this.formatter=r,this.context=(0,N.fw)(e,"2d")}draw(e,t,r,n){let o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this.context.font=`${this.theme.SIZES.LABEL_FONT_SIZE*window.devicePixelRatio}px ${this.theme.FONTS.FONT}`,this.context.textBaseline="top",this.context.lineWidth=this.theme.SIZES.GRID_LINE_WIDTH/2,this.context.fillStyle=this.theme.COLORS.GRID_FRAME_BACKGROUND_COLOR,this.context.fillRect(0,0,t.width,this.theme.SIZES.TIMELINE_HEIGHT*window.devicePixelRatio),this.context.fillStyle=this.theme.COLORS.GRID_LINE_COLOR,this.context.fillRect(0,0,t.width,this.theme.SIZES.GRID_LINE_WIDTH/2),this.context.fillRect(0,this.theme.SIZES.TIMELINE_HEIGHT*window.devicePixelRatio,t.width,this.theme.SIZES.GRID_LINE_WIDTH/2),o){const o=(0,G.NV)(e,n,W);for(let e=0;e<o.length;e++){const n=Math.round(o[e]*r[0]+r[6]),i=this.formatter(o[e]);this.context.fillStyle=this.theme.COLORS.LABEL_FONT_COLOR,this.context.fillText(i,n-(0,N.X1)(i,this.context).width-this.theme.SIZES.LABEL_FONT_PADDING*window.devicePixelRatio,this.theme.SIZES.LABEL_FONT_PADDING*window.devicePixelRatio),this.context.strokeStyle=this.theme.COLORS.GRID_LINE_COLOR,this.context.strokeRect(n-this.theme.SIZES.GRID_LINE_WIDTH/2,t.y,this.theme.SIZES.GRID_LINE_WIDTH/2,t.height)}}}}r("../node_modules/core-js/modules/es.array.push.js");class U{constructor(e,t,r,n){(0,X.Z)(this,"canvas",void 0),(0,X.Z)(this,"context",void 0),(0,X.Z)(this,"theme",void 0),(0,X.Z)(this,"flamegraph",void 0),(0,X.Z)(this,"intervals",void 0),this.canvas=e,this.flamegraph=t,this.theme=n,this.intervals=function(e,t){if(!t.length)return[];const r=t[0];if("number"!=typeof r)throw new Error("Invalid weights, expected an array of numbers");const n=[e+r];for(let e=1;e<t.length;e++){const r=n[e-1];n.push(r+t[e])}return n}(r.x,this.flamegraph.profile.rawWeights),this.context=(0,N.fw)(e,"2d")}draw(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.context;if(0===this.intervals.length)return;const n=this.theme.SIZES.LABEL_FONT_SIZE*window.devicePixelRatio+this.theme.SIZES.LABEL_FONT_PADDING*window.devicePixelRatio*2-this.theme.SIZES.LABEL_FONT_PADDING;r.strokeStyle=`rgba(${this.theme.COLORS.SAMPLE_TICK_COLOR.join(",")})`,r.lineWidth=this.theme.SIZES.INTERNAL_SAMPLE_TICK_LINE_WIDTH;for(let o=0;o<this.intervals.length;o++){const i=this.intervals[o];if(i<t.left)continue;if(i>t.right)break;const s=Math.round(i*e[0]+e[6]);r.strokeRect(s,0,0,n)}}}var Y=r("./app/utils/profiling/renderers/selectedFrameRenderer.tsx"),K=r("./app/views/profiling/profileGroupProvider.tsx"),$=r("./app/components/profiling/flamegraph/interactions/useCanvasScroll.tsx"),q=r("./app/components/profiling/flamegraph/interactions/useCanvasZoomOrScroll.tsx"),J=r("./app/components/profiling/flamegraph/interactions/useDrawHoveredBorderEffect.tsx"),Q=r("./app/components/profiling/flamegraph/interactions/useDrawSelectedBorderEffect.tsx"),ee=r("./app/components/profiling/flamegraph/interactions/useInteractionViewCheckPoint.tsx"),te=r("./app/components/profiling/flamegraph/interactions/useWheelCenterZoom.tsx");function re(e,t){return!!(t&&e&&t.length>1&&t.includes(e))}function ne(e){let{canvasPoolManager:t,canvasBounds:r,flamegraphRenderer:n,flamegraph:a,flamegraphCanvas:l,flamegraphCanvasRef:c,flamegraphOverlayCanvasRef:u,flamegraphView:d,setFlamegraphCanvasRef:p,setFlamegraphOverlayCanvasRef:f,disablePanX:m=!1,disableZoom:g=!1,disableGrid:_=!1,disableCallOrderSort:w=!1}=e;const x=(0,A.W)(),b=(0,K.A)(),C=(0,P.f)(),R=function(){const[e,t]=(0,o.useState)("1"===sessionStorage.getItem(B));return(0,o.useEffect)((()=>{function e(e){(e.ctrlKey||e.metaKey)&&e.shiftKey&&"KeyI"===e.code&&(e.preventDefault(),t((e=>{const t=!e;return t?sessionStorage.setItem(B,"1"):sessionStorage.removeItem(B),t})))}return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)})),e}(),[S,E]=(0,o.useState)(null),I=(0,v.T)(),F=(0,L.IZ)(t),Z=(0,o.useRef)(null),[X,{previousState:W,nextState:ne}]=(0,v.I)(),[se,ae]=(0,o.useState)(null),[le,ce]=(0,o.useState)(null),ue=(0,o.useRef)(null),de=(0,o.useMemo)((()=>u?new H.G(u,x,a):null),[a,u,x]),pe=(0,o.useMemo)((()=>!u||_?null:new V(u,x,a.formatter)),[u,a,x,_]),he=(0,o.useMemo)((()=>R&&u&&d?.configSpace?new U(u,a,d.configSpace,x):null),[R,u,a,d?.configSpace,x]),fe=(0,o.useMemo)((()=>u?new Y.d(u):null),[u]),me=(0,o.useMemo)((()=>le&&n?n.findHoveredNode(le):null),[le,n]),ge=(0,o.useRef)(null),ve=(0,z.a)({container:c}),[_e,we]=(0,o.useState)(re(me,ue.current));(0,o.useEffect)((()=>{if(!(l&&d&&de&&n))return;const e=()=>{de.context.clearRect(0,0,de.canvas.width,de.canvas.height)},t=()=>{de.draw(d.toOriginConfigView(d.configView),d.fromTransformedConfigView(l.physicalSpace),C.results.frames)},r=()=>{he&&he.draw(d.fromTransformedConfigView(l.physicalSpace),d.configView)},o=pe?()=>{pe.draw(d.configView,l.physicalSpace,d.fromConfigView(l.physicalSpace),d.toConfigView(l.logicalSpace),"flamechart"===a.profile.type)}:void 0,i=()=>{n.draw(d.fromTransformedConfigView(l.physicalSpace))};return F.registerBeforeFrameCallback(i),F.registerBeforeFrameCallback(e),F.registerAfterFrameCallback(t),o&&F.registerAfterFrameCallback(o),F.registerAfterFrameCallback(r),F.draw(),()=>{F.unregisterBeforeFrameCallback(e),F.unregisterAfterFrameCallback(t),F.unregisterAfterFrameCallback(r),o&&F.unregisterAfterFrameCallback(o),F.unregisterBeforeFrameCallback(i)}}),[l,d,F,a,x,de,pe,n,he,t,C.results.frames]),(0,o.useEffect)((()=>{if(n){if(X.search.highlightFrames){let e=a.findAllMatchingFrames(X.search.highlightFrames.name,X.search.highlightFrames.package);e.length||X.search.highlightFrames.package||!X.search.highlightFrames.name||(e=a.findAllMatchingFramesBy(X.search.highlightFrames.name,["name"]));const t=e.reduce(((e,t)=>(e.set((0,T.M)(t),{frame:t,match:[]}),e)),new Map);n.setSearchResults("",t),ue.current=e}X.search.query&&!X.search.highlightFrames&&(n.setSearchResults(X.search.query,X.search.results.frames),ue.current=null),X.search.query||X.search.highlightFrames||(n.setSearchResults("",new Map),ue.current=null)}}),[a,n,X.search.results.frames,X.search.query,X.search.highlightFrames]),(0,ee.C)({view:d,lastInteraction:S}),(0,Q.B)({scheduler:F,selectedRef:ue,canvas:l,view:d,eventKey:"highlight frame",theme:x,renderer:fe}),(0,J.B)({scheduler:F,hoveredNode:me||(ve.open?ge.current:null),canvas:l,view:d,theme:x,renderer:fe}),(0,o.useEffect)((()=>{if(!l||!d)return;const e=()=>{ce(null)},t=(e,t)=>{e&&(ue.current=[e]),ce(null)};return F.on("reset zoom",e),F.on("zoom at frame",t),()=>{F.off("reset zoom",e),F.off("zoom at frame",t)}}),[l,t,I,F,d]),(0,o.useEffect)((()=>{const e=e=>{if(d){if("z"===e.key&&e.metaKey){const r=e.shiftKey?"redo":"undo";if("undo"===r){const e=W?.position?.view;e?.isEmpty()?t.dispatch("reset zoom",[]):e&&!e?.equals(d.configView)&&t.dispatch("set config view",[e,d])}if("redo"===r){const e=ne?.position?.view;e&&!e.equals(d.configView)&&t.dispatch("set config view",[e,d])}I({type:r})}if(e.target===c){const r=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t)return null;const n=e.shiftKey?`Shift+${e.key}`:e.key;let o=j[n];if(!o)return null;!r||"up"!==o&&"down"!==o||(o="up"===o?"down":"up");const i=function(e,t){if("up"===t){const t=e.parent;return t?.frame.isRoot?e:t||M(e,"left")||e}if("down"===t){const t=e.children?.[0];return t||D(e,"right")||e}const r=D(e,t);if(r){const n=function(e,t,r){let n=e,o=n.children["right"===r?0:n.children.length-1];for(;n&&o;){if(n.depth===t)return n;o=n.children["right"===r?0:n.children.length-1],o&&(n=o)}return n}(r,e.depth,t);if(n)return n}return e}(t,o);return i===t?null:(e.preventDefault(),i)}(e,ue.current?.[0],a.inverted);r&&t.dispatch("zoom at frame",[r,"min"])}}};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[t,I,ne,W,d,F,c,a.inverted]);const xe=(0,o.useCallback)((e=>{E("click"),ae((0,N.YG)(e.nativeEvent.offsetX,e.nativeEvent.offsetY))}),[]),be=(0,o.useCallback)((e=>{if(e.preventDefault(),e.stopPropagation(),!le)return E(null),void ae(null);me?(t.dispatch("zoom at frame",[me,"exact"]),t.dispatch("show in table view",[me]),t.dispatch("highlight frame",[[me],"selected"]),n?.setSearchResults("",new Map)):(t.dispatch("highlight frame",[null,"selected"]),C.query||n?.setSearchResults("",new Map)),E("click"),ae(null)}),[le,me,t,n,C.query]),ye=(0,o.useCallback)((e=>{if(!l||!d||!se)return;const r=(0,N.i7)(e.nativeEvent.offsetX,e.nativeEvent.offsetY,se,d,l);r&&(t.dispatch("transform config view",[r,d]),ae((0,N.YG)(e.nativeEvent.offsetX,e.nativeEvent.offsetY)))}),[l,d,se,t]),Ce=(0,o.useCallback)((e=>{l&&d&&(ce(d.getTransformedConfigViewCursor(i.al(e.nativeEvent.offsetX,e.nativeEvent.offsetY),l)),se?(ye(e),E("pan")):E(null))}),[l,d,ce,ye,se]),Re=(0,o.useCallback)((()=>{me&&t.dispatch("highlight frame",[[me],"selected"]),E(null),ae(null)}),[me,t]),Se=(0,o.useCallback)((()=>{ce(null),ae(null),E(null)}),[]),Ee=(0,te.T)(l,d,t,g),ke=(0,$.g)(l,d,t,m);(0,q.k)({setConfigSpaceCursor:ce,setLastInteraction:E,handleWheel:Ee,handleScroll:ke,canvas:c}),(0,o.useEffect)((()=>{const e=e=>{Z.current&&!Z.current.contains(e.target)&&(ve.open&&(e.preventDefault(),e.stopPropagation()),ce(null))};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}}),[Z,ve,t]);const Ie=(0,o.useCallback)((e=>{ge.current=me,ve.handleContextMenu(e),we(re(me,ue.current))}),[ve,me]),Fe=(0,o.useCallback)((()=>{if(!ge.current||!d)return;if(re(ge.current,ue.current))return we(!1),I({type:"set highlight all frames",payload:null}),void t.dispatch("highlight frame",[null,"selected"]);we(!0);const e=ge.current.frame.name,r=ge.current.frame.package??ge.current.frame.module??"";I({type:"set highlight all frames",payload:{name:e,package:r}});let n=a.findAllMatchingFrames(e,r);n.length||r||!e||"node"!==b.metadata.platform||(n=a.findAllMatchingFramesBy(e,["name"]));const o=n.map((e=>new G.UL(e.start,e.depth,e.end-e.start,1))),i=(0,N.v5)(d.configView,o).transformRect(d.configSpaceTransform);t.dispatch("highlight frame",[n,"selected"]),t.dispatch("set config view",[i,d])}),[t,a,d,I,b.metadata.platform]),Ze=(0,o.useCallback)((()=>{ge.current&&navigator.clipboard.writeText(ge.current.frame.name).then((()=>{(0,s.S9)((0,h.t)("Function name copied to clipboard"))})).catch((()=>{(0,s.Iw)((0,h.t)("Failed to copy function name to clipboard"))}))}),[]);return(0,y.BX)(oe,{ref:Z,children:[(0,y.tZ)(ie,{ref:p,onMouseDown:xe,onMouseMove:Ce,onMouseLeave:Se,onMouseUp:Re,onDoubleClick:be,onContextMenu:Ie,cursor:"pan"===S?"grabbing":"default",tabIndex:1}),(0,y.tZ)(ie,{ref:f,pointerEvents:"none"}),(0,y.tZ)(k,{contextMenu:ve,profileGroup:b,hoveredNode:ge.current,isHighlightingAllOccurences:_e,onCopyFunctionNameClick:Ze,onHighlightAllOccurencesClick:Fe,disableCallOrderSort:w}),l&&n&&d&&le&&me?(0,y.tZ)(O.BX,{frame:me,configSpaceCursor:le,flamegraphCanvas:l,flamegraphRenderer:n,flamegraphView:d,canvasBounds:r,platform:b.metadata.platform}):null]})}ne.displayName="FlamegraphZoomView";const oe=(0,n.Z)("div",{target:"e1w58dh81"})({name:"18v3aye",styles:"display:flex;flex-direction:column;height:100%;width:100%;position:relative"}),ie=(0,n.Z)("canvas",{target:"e1w58dh80"})("left:0;top:0;width:100%;height:100%;user-select:none;position:absolute;pointer-events:",(e=>e.pointerEvents||"auto"),";cursor:",(e=>e.cursor||"default"),";&:focus{outline:none;}")},"./app/components/profiling/flamegraph/interactions/useCanvasScroll.tsx":(e,t,r)=>{r.d(t,{g:()=>i});var n=r("../node_modules/react/index.js"),o=r("./app/utils/profiling/gl/utils.ts");function i(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return(0,n.useCallback)((n=>{if(!e||!t)return;const s=Math.abs(n.deltaY)>Math.abs(n.deltaX)?"vertical":"horizontal",a=n.deltaY>0?"down":"up";t.isViewAtTopEdgeOf(t.configSpace)&&"vertical"===s&&"up"===a||t.isViewAtBottomEdgeOf(t.configSpace)&&"vertical"===s&&"down"===a||(n.preventDefault(),r.dispatch("transform config view",[(0,o.Zw)(i?0:n.deltaX,n.deltaY,t,e),t]))}),[e,t,r,i])}},"./app/components/profiling/flamegraph/interactions/useCanvasZoomOrScroll.tsx":(e,t,r)=>{r.d(t,{k:()=>i});var n=r("../node_modules/react/index.js"),o=r("./app/views/profiling/utils.tsx");function i(e){let{handleWheel:t,handleScroll:r,canvas:i,setConfigSpaceCursor:s,setLastInteraction:a}=e;(0,n.useEffect)((()=>{if(!i)return;let e={current:void 0};function n(n){void 0!==e.current&&window.cancelAnimationFrame(e.current),e=(0,o.lk)((()=>{a(null)}),300),s(null),n.metaKey||n.ctrlKey?(t(n),a("zoom")):(r(n),a("scroll"))}return i.addEventListener("wheel",n),()=>{void 0!==e.current&&window.cancelAnimationFrame(e.current),i.removeEventListener("wheel",n)}}),[i,t,r,s,a])}},"./app/components/profiling/flamegraph/interactions/useDrawHoveredBorderEffect.tsx":(e,t,r)=>{r.d(t,{B:()=>i});var n=r("../node_modules/react/index.js"),o=r("./app/utils/profiling/speedscope.tsx");function i(e){let{scheduler:t,view:r,theme:i,canvas:s,renderer:a,hoveredNode:l}=e;(0,n.useEffect)((()=>{if(!s||!r||!a)return;const e=()=>{l&&a.draw([new o.UL(l.start,l.depth,l.end-l.start,1)],{BORDER_COLOR:i.COLORS.HOVERED_FRAME_BORDER_COLOR,BORDER_WIDTH:i.SIZES.HOVERED_FRAME_BORDER_WIDTH},r.fromTransformedConfigView(s.physicalSpace))};return t.registerAfterFrameCallback(e),t.draw(),()=>{t.unregisterAfterFrameCallback(e)}}),[r,s,t,l,a,i])}},"./app/components/profiling/flamegraph/interactions/useDrawSelectedBorderEffect.tsx":(e,t,r)=>{r.d(t,{B:()=>i});var n=r("../node_modules/react/index.js"),o=r("./app/utils/profiling/speedscope.tsx");function i(e){let{scheduler:t,view:r,theme:i,canvas:s,eventKey:a,renderer:l,selectedRef:c}=e;(0,n.useEffect)((()=>{if(!s||!r||!l)return;function e(e,r){"selected"===r&&(c.current=e),t.draw()}const n=()=>{c.current&&l.draw(c.current.map((e=>new o.UL(e.start,e.depth,e.end-e.start,1))),{BORDER_COLOR:i.COLORS.SELECTED_FRAME_BORDER_COLOR,BORDER_WIDTH:i.SIZES.HIGHLIGHTED_FRAME_BORDER_WIDTH},r.fromTransformedConfigView(s.physicalSpace))};return t.on(a,e),t.registerAfterFrameCallback(n),t.draw(),()=>{t.off(a,e),t.unregisterAfterFrameCallback(n)}}),[r,s,t,l,a,i,c])}},"./app/components/profiling/flamegraph/interactions/useInteractionViewCheckPoint.tsx":(e,t,r)=>{r.d(t,{C:()=>s});var n=r("../node_modules/react/index.js"),o=r("./app/utils/profiling/flamegraph/hooks/useFlamegraphState.ts"),i=r("./app/utils/usePrevious.tsx");function s(e){let{view:t,lastInteraction:r}=e;const s=(0,i.Z)(r),a=(0,n.useRef)(null),l=(0,o.T)();(0,n.useEffect)((()=>{t&&(null===s&&r?a.current=t.configView.clone():a.current&&!a.current.equals(t.configView)&&l({type:"checkpoint",payload:t.configView.clone()}))}),[l,r,s,t])}},"./app/components/profiling/flamegraph/interactions/useWheelCenterZoom.tsx":(e,t,r)=>{r.d(t,{T:()=>s});var n=r("../node_modules/react/index.js"),o=r("../node_modules/gl-matrix/esm/vec2.js"),i=r("./app/utils/profiling/gl/utils.ts");function s(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return(0,n.useCallback)((n=>{if(!e||!t||s)return;n.preventDefault();const a=1-.01*n.deltaY*-1;r.dispatch("transform config view",[(0,i.NR)(a,o.al(n.offsetX,n.offsetY),t,e),t])}),[e,t,r,s])}},"./app/components/profiling/flex.tsx":(e,t,r)=>{r.d(t,{k:()=>a});var n=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js");const o=e=>"string"==typeof e?e:"number"==typeof e?e+"px":void 0,i=(0,n.Z)("div",{target:"e12bnk0l1"})("display:flex;height:",(e=>o(e.h)),";width:",(e=>o(e.w)),";min-height:",(e=>o(e.minH)),";max-height:",(e=>o(e.maxH)),";padding:",(e=>o(e.p)),";padding-left:",(e=>o(e.pl||e.px)),";padding-right:",(e=>o(e.pr||e.px)),";padding-top:",(e=>o(e.pt||e.py)),";padding-bottom:",(e=>o(e.pb||e.py)),";margin:",(e=>o(e.m)),";margin-left:",(e=>o(e.ml||e.mx)),";margin-right:",(e=>o(e.mr||e.mx)),";margin-top:",(e=>o(e.mt||e.my)),";margin-bottom:",(e=>o(e.mb||e.my)),";flex-direction:",(e=>e.column?"column":"row"),";justify-content:",(e=>e.justify),";align-items:",(e=>e.align),";gap:",(e=>o(e.gap)),";flex-wrap:",(e=>e.wrap),";"),s=(0,n.Z)("div",{target:"e12bnk0l0"})("flex-grow:",(e=>e.grow),";flex-shrink:",(e=>e.shrink),";flex-basis:",(e=>e.basis),";overflow:hidden;"),a=Object.assign(i,{...i,Container:i,Item:s})},"./app/components/profiling/profilingContextMenu.tsx":(e,t,r)=>{r.d(t,{Oz:()=>h,VL:()=>_,dE:()=>x,mP:()=>b,n2:()=>c,pb:()=>p,rE:()=>y});var n=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=r("../node_modules/react/index.js"),i=r("./app/components/tooltip.tsx"),s=r("./app/icons/index.tsx"),a=r("./app/styles/space.tsx"),l=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const c=(0,n.Z)((0,o.forwardRef)(((e,t)=>(0,l.tZ)("div",{ref:t,role:"menu",...e}))),{target:"e1lv89pz11"})("position:absolute;font-size:",(e=>e.theme.fontSizeMedium),";z-index:",(e=>e.theme.zIndex.dropdown),";background:",(e=>e.theme.backgroundElevated),";border:1px solid ",(e=>e.theme.border),";border-radius:",(e=>e.theme.borderRadius),";box-shadow:",(e=>e.theme.dropShadowHeavy),";width:auto;min-width:164px;overflow:auto;padding-bottom:",(0,a.D)(.5),";"),u=(0,n.Z)("div",{target:"e1lv89pz10"})("cursor:pointer;display:flex;align-items:center;font-weight:normal;padding:0 ",(0,a.D)(1),";border-radius:",(e=>e.theme.borderRadius),";box-sizing:border-box;background:",(e=>0===e.tabIndex?e.theme.hover:void 0),";&:focus{color:",(e=>e.theme.textColor),";background:",(e=>e.theme.hover),";outline:none;}"),d=(0,n.Z)("label",{target:"e1lv89pz9"})({name:"1h5wbu2",styles:"display:flex;align-items:center;font-weight:normal;margin:0;cursor:pointer;flex:1 1 100%"}),p=(0,o.forwardRef)(((e,t)=>{const{children:r,checked:n,...o}=e;return(0,l.tZ)(w,{children:(0,l.tZ)(u,{ref:t,role:"menuitem",...o,children:(0,l.BX)(d,{children:[(0,l.BX)(m,{children:[(0,l.tZ)(v,{type:"checkbox",checked:n,onChange:()=>{}}),(0,l.tZ)(s.DL,{})]}),(0,l.tZ)(g,{children:r})]})})})})),h=(0,o.forwardRef)(((e,t)=>{const{children:r,tooltip:n,...o}=e;return(0,l.tZ)(w,{children:(0,l.tZ)(i.u,{title:n,children:(0,l.BX)(f,{disabled:e.disabled,ref:t,role:"menuitem",...o,children:[e.icon?(0,l.tZ)(m,{children:e.icon}):null,r]})})})})),f=(0,n.Z)("button",{target:"e1lv89pz8"})("border:none;display:flex;flex:1;align-items:center;padding:",(0,a.D)(.5)," ",(0,a.D)(1),";border-radius:",(e=>e.theme.borderRadius),";box-sizing:border-box;background:",(e=>0===e.tabIndex?e.theme.hover:"transparent"),"!important;pointer-events:",(e=>e.disabled?"none":void 0),";opacity:",(e=>e.disabled?.7:void 0),";&:focus{color:",(e=>e.theme.textColor),";background:",(e=>e.theme.hover),";outline:none;}svg{margin-right:",(0,a.D)(.5),";}"),m=(0,n.Z)("div",{target:"e1lv89pz7"})("display:flex;align-items:center;height:1.4em;width:1em;gap:",(0,a.D)(1),";padding:",(0,a.D)(1)," 0;position:relative;"),g=(0,n.Z)("div",{target:"e1lv89pz6"})("position:relative;width:100%;display:flex;gap:",(0,a.D)(.5),";justify-content:space-between;padding:",(0,a.D)(.5)," 0;margin-left:",(0,a.D)(.5),";text-transform:capitalize;margin-bottom:0;line-height:1.4;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"),v=(0,n.Z)("input",{target:"e1lv89pz5"})("position:absolute;opacity:0;cursor:pointer;height:0;padding-right:",(0,a.D)(1),";&+svg{position:absolute;left:50%;top:50%;transform:translate(-50%, -50%);width:1em;height:1.4em;display:none;}&:checked+svg{display:block;}"),_=(0,n.Z)((0,o.forwardRef)(((e,t)=>{const{children:r,...n}=e;return(0,l.tZ)(w,{children:(0,l.tZ)(u,{ref:t,role:"menuitem",...n,children:(0,l.tZ)(g,{children:r})})})})),{target:"e1lv89pz4"})("cursor:pointer;color:",(e=>e.theme.textColor),";background:transparent;padding:0 ",(0,a.D)(.5),";&:focus{outline:none;}&:active:{background:transparent;}"),w=(0,n.Z)("div",{target:"e1lv89pz3"})("padding:0 ",(0,a.D)(.5),";display:flex;>span{display:flex;}>div,>span,button{flex:1;}"),x=(0,n.Z)("div",{target:"e1lv89pz2"})("padding-top:0;padding-bottom:",(0,a.D)(1),";&:last-of-type{padding-bottom:0;}"),b=(0,n.Z)((e=>{const{children:t,...r}=e;return(0,l.tZ)("div",{...r,children:t})}),{target:"e1lv89pz1"})("text-transform:uppercase;line-height:1.5;font-weight:600;color:",(e=>e.theme.subText),";margin-bottom:0;cursor:default;font-size:75%;padding:",(0,a.D)(.5)," ",(0,a.D)(1.5),";"),y=(0,n.Z)("div",{target:"e1lv89pz0"})("width:100%;height:100%;position:absolute;left:0;top:0;z-index:",(e=>e.theme.zIndex.dropdown-1),";")},"./app/utils/profiling/flamegraph/flamegraphStateProvider/flamegraphContext.tsx":(e,t,r)=>{r.d(t,{a$:()=>i,HK:()=>l,J_:()=>a,YY:()=>s});var n=r("../node_modules/react/index.js"),o=r("./app/utils/profiling/speedscope.tsx");const i={profiles:{selectedRoot:null,threadId:null},position:{view:o.UL.Empty()},preferences:{timelines:{ui_frames:!0,minimap:!0,transaction_spans:!0},colorCoding:"by system vs application frame",sorting:"call order",view:"top down",layout:"table bottom"},search:{index:null,highlightFrames:null,results:{frames:new Map,spans:new Map},query:""}},s=function(e){const t=Object.keys(e);return(r,n)=>{const o={};for(const i of t)o[i]=e[i](r[i],n);return o}}({profiles:function(e,t){switch(t.type){case"set selected root":return{...e,selectedRoot:t.payload};case"set thread id":return{...e,selectedRoot:null,threadId:t.payload};default:return e}},position:function(e,t){return"checkpoint"===t.type?{view:o.UL.From(t.payload)}:e},preferences:function(e,t){switch(t.type){case"set layout":return{...e,layout:t.payload};case"set color coding":return{...e,colorCoding:t.payload};case"set sorting":return{...e,sorting:t.payload};case"set view":return{...e,view:t.payload};case"toggle timeline":return{...e,timelines:{...e.timelines,[t.payload.timeline]:t.payload.value}};default:return e}},search:function(e,t){switch(t.type){case"clear search":return{...e,query:"",index:null,highlightFrames:null,results:{frames:new Map,spans:new Map}};case"set highlight all frames":return{...e,highlightFrames:t.payload};case"set search results":return{...e,highlightFrames:null,...t.payload};case"set search index position":return{...e,index:t.payload};default:return e}}}),a=(0,n.createContext)(null),l=(0,n.createContext)(null)},"./app/utils/profiling/flamegraph/flamegraphStateProvider/flamegraphContextProvider.tsx":(e,t,r)=>{r.d(t,{H:()=>a});var n=r("../node_modules/react/index.js");r("../node_modules/core-js/modules/es.error.cause.js");var o=r("./app/utils/profiling/flamegraph/flamegraphStateProvider/flamegraphContext.tsx"),i=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function s(e){return!!e&&("string"==typeof e.name||"string"==typeof e.package)}function a(e){const[t,r,{nextState:a,previousState:l}]=function(e,t){const[r,o]=(0,n.useReducer)(function(e){return(t,r)=>{if(function(e){return!!e.type&&("undo"===e.type||"redo"===e.type)}(r))return function(e,t){if("undo"===t.type)return void 0===e.previous?e:e.previous;if("redo"===t.type)return void 0===e.next?e:e.next;throw new Error("Unreachable case")}(t,r);const n={next:void 0,previous:t,current:e(t.current,r)};return t.next=n,n}}(e),{current:t,previous:void 0,next:void 0});return(0,n.useMemo)((()=>[r.current,o,{previousState:r.previous?.current,nextState:r.next?.current}]),[r,o])}(o.YY,(c=e.initialState,{profiles:{selectedRoot:null,threadId:c?.profiles?.threadId??o.a$.profiles.threadId},position:{view:c?.position?.view??o.a$.position.view},preferences:{timelines:{...o.a$.preferences.timelines,...c?.preferences?.timelines??{}},layout:c?.preferences?.layout??o.a$.preferences.layout,colorCoding:c?.preferences?.colorCoding??o.a$.preferences.colorCoding,sorting:c?.preferences?.sorting??o.a$.preferences.sorting,view:c?.preferences?.view??o.a$.preferences.view},search:{...o.a$.search,highlightFrames:s(c?.search?.highlightFrames)?{name:void 0,package:void 0,...c?.search?.highlightFrames}:s(o.a$.search.highlightFrames)?o.a$.search.highlightFrames:null,query:c?.search?.query??o.a$.search.query}}));var c;const u=(0,n.useMemo)((()=>[t,{nextState:a,previousState:l}]),[t,a,l]);return(0,i.tZ)(o.J_.Provider,{value:u,children:(0,i.tZ)(o.HK.Provider,{value:r,children:e.children})})}a.displayName="FlamegraphStateProvider"},"./app/utils/profiling/flamegraph/hooks/useFlamegraphPreferences.ts":(e,t,r)=>{r.d(t,{K:()=>i}),r("../node_modules/core-js/modules/es.error.cause.js");var n=r("../node_modules/react/index.js"),o=r("./app/utils/profiling/flamegraph/flamegraphStateProvider/flamegraphContext.tsx");function i(){const e=(0,n.useContext)(o.J_);if(null===e)throw new Error("useFlamegraphPreferences called outside of FlamegraphStateProvider");return e[0].preferences}},"./app/utils/profiling/flamegraph/hooks/useFlamegraphProfiles.tsx":(e,t,r)=>{r.d(t,{X:()=>i}),r("../node_modules/core-js/modules/es.error.cause.js");var n=r("../node_modules/react/index.js"),o=r("./app/utils/profiling/flamegraph/flamegraphStateProvider/flamegraphContext.tsx");function i(){const e=(0,n.useContext)(o.J_);if(null===e)throw new Error("useFlamegraphProfiles called outside of FlamegraphStateProvider");return e[0].profiles}},"./app/utils/profiling/flamegraph/hooks/useFlamegraphSearch.ts":(e,t,r)=>{r.d(t,{f:()=>i}),r("../node_modules/core-js/modules/es.error.cause.js");var n=r("../node_modules/react/index.js"),o=r("./app/utils/profiling/flamegraph/flamegraphStateProvider/flamegraphContext.tsx");function i(){const e=(0,n.useContext)(o.J_);if(null===e)throw new Error("useFlamegraphSearch called outside of FlamegraphStateProvider");return e[0].search}},"./app/utils/profiling/flamegraph/hooks/useFlamegraphState.ts":(e,t,r)=>{r.d(t,{I:()=>i,T:()=>s}),r("../node_modules/core-js/modules/es.error.cause.js");var n=r("../node_modules/react/index.js"),o=r("./app/utils/profiling/flamegraph/flamegraphStateProvider/flamegraphContext.tsx");function i(){const e=(0,n.useContext)(o.J_);if(null===e)throw new Error("useFlamegraphState called outside of FlamegraphStateProvider");return e}function s(){const e=(0,n.useContext)(o.HK);if(null===e)throw new Error("useFlamegraphState called outside of FlamegraphStateProvider");return e}},"./app/utils/profiling/hooks/useContextMenu.tsx":(e,t,r)=>{r.d(t,{a:()=>s});var n=r("../node_modules/react/index.js"),o=r("./app/utils/profiling/colors/utils.tsx"),i=r("./app/utils/profiling/speedscope.tsx");function s(e){let{container:t}=e;const[r,s]=(0,n.useState)(!1),[a,l]=(0,n.useState)(null),[c,u]=(0,n.useState)(null),[d,p]=(0,n.useState)(null),h=function(){const[e,t]=(0,n.useState)(null),r=[],{tabIndex:o,setTabIndex:i,onKeyDown:s}=function(e){const[t,r]=(0,n.useState)(null),o=(0,n.useCallback)((n=>{0!==e.length&&("Escape"===n.key&&r(null),"ArrowDown"!==n.key&&"Tab"!==n.key||(n.preventDefault(),t===e.length-1||null===t?r(0):r((t??0)+1)),("ArrowUp"===n.key||"Tab"===n.key&&n.shiftKey)&&(n.preventDefault(),r(0===t||null===t?e.length-1:(t??0)-1)))}),[t,e]);return{tabIndex:t,setTabIndex:r,onKeyDown:o}}(r);return(0,n.useEffect)((()=>{e&&null===o&&e.focus()}),[e,o]),{menuRef:e,getItemProps:function(){const e=r.length;return r.push({id:e,node:null}),{tabIndex:o===e?0:-1,ref:t=>{r[e]&&(o===e&&t?.focus(),r[e].node=t)},onMouseOver:()=>{i(e)},onMouseEnter:()=>{i(e)},onKeyDown:s}},getMenuProps:function(){return{tabIndex:-1,ref:t,onKeyDown:s}},tabIndex:o,setTabIndex:i}}(),f=(0,n.useRef)(null),m=(0,n.useCallback)((e=>{e||h.setTabIndex(null),s(e)}),[h]),g=(0,n.useCallback)((()=>{const e=h.getMenuProps();return{...e,onKeyDown:t=>{"Escape"===t.key&&m(!1),e.onKeyDown(t)}}}),[h,m]),v=(0,n.useCallback)((function(){let{onClick:e,ref:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=h.getItemProps();return{...r,ref:e=>{t&&t(e),r.ref(e)},onClick:t=>{t.preventDefault(),e?.()},onKeyDown:t=>{"Escape"===t.key&&m(!1),"Enter"===t.key&&e?.(),r.onKeyDown(t)}}}),[h,m]),_=(0,n.useCallback)((e=>{if(!t)return;e.preventDefault(),e.stopPropagation();const r=t.getBoundingClientRect();u(new i.UL(e.clientX-r.left,e.clientY-r.top,0,0)),m(!0)}),[m,t]);(0,n.useEffect)((()=>{const e=e=>{!h.menuRef||h.menuRef.contains(e.target)||f.current&&f.current?.contains(e.target)||s(!1)};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}}),[h.menuRef]),(0,n.useEffect)((()=>{if(!h.menuRef)return;const e=new window.ResizeObserver((e=>{const t=e[0].contentRect;l(new i.UL(0,0,t.width,t.height))}));return e.observe(h.menuRef),()=>{e.disconnect()}}),[h.menuRef]),(0,n.useEffect)((()=>{if(!t)return;const e=new window.ResizeObserver((e=>{const t=e[0].contentRect;p(new i.UL(0,0,t.width,t.height))}));return e.observe(t),()=>{e.disconnect()}}),[t]);const w=c&&d&&a?function(e,t,r){const n=Math.floor(t.height-r.height),i=t.top,s=t.left,a=Math.floor(t.right-r.width);return{left:(0,o.uZ)(e.x+6,s,a),top:(0,o.uZ)(e.y+6,i,n)}}(c,d,a):null;return{open:r,setOpen:m,position:w,containerCoordinates:d,contextMenuCoordinates:w,menuRef:h.menuRef,subMenuRef:f,handleContextMenu:_,getMenuProps:g,getMenuItemProps:v}}r("../node_modules/core-js/modules/es.array.push.js")},"./app/utils/profiling/hooks/useCurrentProjectFromRouteParam.tsx":(e,t,r)=>{r.d(t,{y:()=>i});var n=r("./app/utils/useParams.tsx"),o=r("./app/utils/useProjects.tsx");function i(){const e=(0,n.U)(),t=(0,o.Z)({limit:1,slugs:[e?.projectId]});return t.projects?.[0]??null}},"./app/utils/profiling/renderers/flamegraphRendererWebGL.tsx":(e,t,r)=>{r.d(t,{l:()=>f});var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=(r("../node_modules/core-js/modules/es.typed-array.at.js"),r("../node_modules/core-js/modules/es.typed-array.fill.js"),r("../node_modules/core-js/modules/es.typed-array.find-last.js"),r("../node_modules/core-js/modules/es.typed-array.find-last-index.js"),r("../node_modules/core-js/modules/es.typed-array.set.js"),r("../node_modules/core-js/modules/es.typed-array.sort.js"),r("../node_modules/core-js/modules/es.error.cause.js"),r("../node_modules/gl-matrix/esm/mat3.js")),i=r("./app/utils/profiling/flamegraphFrame.tsx"),s=r("./app/utils/profiling/gl/utils.ts"),a=r("./app/utils/profiling/renderers/flamegraphRenderer.tsx"),l=r("./app/utils/profiling/speedscope.tsx"),c=r("./app/utils/profiling/renderers/shaders.tsx");const u=new l.UL(0,0,1,1),d=o.Ue(),p=new Float32Array(6).fill(1),h=new Float32Array(6).fill(0);class f extends a.o{constructor(e,t,r){if(super(e,t,r,arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.r),(0,n.Z)(this,"gl",null),(0,n.Z)(this,"program",null),(0,n.Z)(this,"positions",new Float32Array),(0,n.Z)(this,"bounds",new Float32Array),(0,n.Z)(this,"colors",new Float32Array),(0,n.Z)(this,"searchResults",new Float32Array),(0,n.Z)(this,"lastDragPosition",null),(0,n.Z)(this,"attributes",{a_position:null,a_color:null,a_bounds:null,a_is_search_result:null}),(0,n.Z)(this,"uniforms",{u_border_width:null,u_draw_border:null,u_model:null,u_grayscale:null,u_projection:null}),24*this.frames.length!==this.colorBuffer.length)throw new Error("Color buffer length does not match the number of vertices");this.colors=new Float32Array(this.colorBuffer),this.initCanvasContext(),this.initVertices(),this.initShaders()}initVertices(){const e=this.frames.length;this.bounds=new Float32Array(24*e),this.positions=new Float32Array(12*e),this.searchResults=new Float32Array(6*e);for(let t=0;t<e;t++){const e=this.frames[t],r=e.start,n=e.end,o=e.depth,i=e.depth+1,s=12*t;this.positions[s]=r,this.positions[s+1]=o,this.positions[s+2]=n,this.positions[s+3]=o,this.positions[s+4]=r,this.positions[s+5]=i,this.positions[s+6]=r,this.positions[s+7]=i,this.positions[s+8]=n,this.positions[s+9]=o,this.positions[s+10]=n,this.positions[s+11]=i;const a=6*t*4;for(let e=0;e<6;e++){const t=a+4*e;this.bounds[t]=r,this.bounds[t+1]=o,this.bounds[t+2]=n,this.bounds[t+3]=i}}}initCanvasContext(){if(!this.canvas)throw new Error("Cannot initialize context from null canvas");if(this.gl=(0,s.fw)(this.canvas,"webgl"),!this.gl)throw new Error("Uninitialized WebGL context");this.gl.enable(this.gl.BLEND),this.gl.blendFuncSeparate(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA),(0,s.Lo)(this.canvas)}initShaders(){if(!this.gl)throw new Error("Uninitialized WebGL context");this.uniforms={u_border_width:null,u_draw_border:null,u_grayscale:null,u_model:null,u_projection:null},this.attributes={a_bounds:null,a_color:null,a_is_search_result:null,a_position:null};const e=(0,s.ef)(this.gl,this.gl.VERTEX_SHADER,(0,c.uf)()),t=(0,s.ef)(this.gl,this.gl.FRAGMENT_SHADER,(0,c.Dx)(this.theme));this.program=(0,s.HO)(this.gl,e,t);for(const e in this.uniforms)this.uniforms[e]=(0,s.DL)(this.gl,this.program,e);this.attributes.a_is_search_result=(0,s.IL)(this.gl,this.program,"a_is_search_result"),(0,s.Xi)(this.gl,this.searchResults,this.gl.STATIC_DRAW),(0,s.FW)(this.gl,this.attributes.a_is_search_result,{size:1,type:this.gl.FLOAT,normalized:!1,stride:0,offset:0}),this.attributes.a_color=(0,s.IL)(this.gl,this.program,"a_color"),(0,s.Xi)(this.gl,this.colors,this.gl.STATIC_DRAW),(0,s.FW)(this.gl,this.attributes.a_color,{size:4,type:this.gl.FLOAT,normalized:!1,stride:0,offset:0}),this.attributes.a_position=(0,s.IL)(this.gl,this.program,"a_position"),(0,s.Xi)(this.gl,this.positions,this.gl.STATIC_DRAW),(0,s.FW)(this.gl,this.attributes.a_position,{size:2,type:this.gl.FLOAT,normalized:!1,stride:0,offset:0}),this.attributes.a_bounds=(0,s.IL)(this.gl,this.program,"a_bounds"),(0,s.Xi)(this.gl,this.bounds,this.gl.STATIC_DRAW),(0,s.FW)(this.gl,this.attributes.a_bounds,{size:4,type:this.gl.FLOAT,normalized:!1,stride:0,offset:0}),this.gl.useProgram(this.program),this.gl.uniform1i(this.uniforms.u_draw_border,this.options.draw_border?1:0),this.gl.uniform1i(this.uniforms.u_grayscale,0)}setSearchResults(e,t){this.program&&this.gl&&(this.gl.uniform1i(this.uniforms.u_grayscale,e.length>0||t.size>0?1:0),this.updateSearchResultsBuffer(t))}updateSearchResultsBuffer(e){if(this.program&&this.gl){for(let t=0;t<this.frames.length;t++)this.searchResults.set(e.has((0,i.M)(this.frames[t]))?p:h,6*t);this.attributes.a_is_search_result=(0,s.IL)(this.gl,this.program,"a_is_search_result"),(0,s.Xi)(this.gl,this.searchResults,this.gl.STATIC_DRAW),(0,s.FW)(this.gl,this.attributes.a_is_search_result,{size:1,type:this.gl.FLOAT,normalized:!1,stride:0,offset:0})}}draw(e){if(!this.gl)throw new Error("Uninitialized WebGL context");if(this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),!this.positions.length||!this.program)return;const t=(0,s.AN)(this.gl.canvas.width,this.gl.canvas.height);this.gl.uniformMatrix3fv(this.uniforms.u_projection,!1,t),this.gl.uniformMatrix3fv(this.uniforms.u_model,!1,e),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);const r=o.U_(d,e),n=u.transformRect(r);this.gl.uniform2f(this.uniforms.u_border_width,n.width,n.height),this.gl.drawArrays(this.gl.TRIANGLES,0,6*this.frames.length)}}},"./app/utils/profiling/renderers/selectedFrameRenderer.tsx":(e,t,r)=>{r.d(t,{d:()=>i});var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=r("./app/utils/profiling/gl/utils.ts");class i{constructor(e){(0,n.Z)(this,"canvas",void 0),(0,n.Z)(this,"context",void 0),this.canvas=e,this.context=(0,o.fw)(e,"2d")}draw(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.context;n.strokeStyle=t.BORDER_COLOR,n.lineWidth=t.BORDER_WIDTH;for(let o=0;o<e.length;o++){const i=e[o].transformRect(r);n.beginPath(),n.strokeRect(i.x+t.BORDER_WIDTH,i.y+t.BORDER_WIDTH,i.width-2*t.BORDER_WIDTH,i.height-2*t.BORDER_WIDTH)}}}},"./app/utils/profiling/renderers/shaders.tsx":(e,t,r)=>{r.d(t,{Dx:()=>o,TF:()=>i,uf:()=>n,x7:()=>s});const n=()=>"\nattribute vec2 a_position;\nattribute vec4 a_color;\nattribute vec4 a_bounds;\nattribute float a_is_search_result;\n\nuniform mat3 u_model;\nuniform mat3 u_projection;\n\nvarying vec4 v_color;\nvarying vec2 v_pos;\nvarying vec4 v_bounds;\nvarying float v_is_search_result;\n\nvoid main() {\n  vec2 scaled = (u_model * vec3(a_position.xy, 1)).xy;\n  vec2 pos = (u_projection * vec3(scaled.xy, 1)).xy;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n\n  v_color = a_color;\n  v_pos = a_position.xy;\n  v_bounds = a_bounds;\n  v_is_search_result = a_is_search_result;\n}\n",o=e=>`\nprecision mediump float;\n\nuniform vec2 u_border_width;\nuniform bool u_draw_border;\nuniform bool u_grayscale;\n\nvarying vec4 v_color;\nvarying vec4 v_bounds;\nvarying vec2 v_pos;\nvarying float v_is_search_result;\n\nvoid main() {\n  float minX = v_bounds.x + u_border_width.x;\n  float maxX = v_bounds.z - u_border_width.x;\n\n  float minY = v_bounds.y + u_border_width.y;\n  float maxY = v_bounds.y + 1.0 - u_border_width.y;\n\n  float width = maxX - minX;\n\n  vec4 color = vec4(v_color);\n\n  if(u_grayscale && v_is_search_result == 0.0) {\n    color = vec4(${e.COLORS.FRAME_GRAYSCALE_COLOR.join(",")});\n  }\n\n  if (u_draw_border) {\n    if(width <= u_border_width.x) {\n      if(v_pos.y > minY && v_pos.y < maxY){\n        gl_FragColor = color;\n      } else {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n      }\n    } else if (v_pos.x > minX && v_pos.x < maxX && v_pos.y > minY && v_pos.y < maxY) {\n      gl_FragColor = color;\n    } else {\n      gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n  } else {\n    gl_FragColor = color;\n  }\n}\n`,i=()=>"\nattribute vec2 a_position;\nattribute float a_frame_type;\nattribute vec4 a_bounds;\n\nuniform mat3 u_model;\nuniform mat3 u_projection;\n\nvarying float v_frame_type;\nvarying vec2 v_pos;\nvarying vec4 v_bounds;\n\nvoid main() {\n  vec2 scaled = (u_model * vec3(a_position.xy, 1)).xy;\n  vec2 pos = (u_projection * vec3(scaled.xy, 1)).xy;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n\n  v_frame_type = a_frame_type;\n  v_pos = a_position.xy;\n  v_bounds = a_bounds;\n}\n",s=e=>`\nprecision mediump float;\n\nuniform vec2 u_border_width;\n\nvarying float v_frame_type;\nvarying vec4 v_bounds;\nvarying vec2 v_pos;\n\nvoid main() {\n  float minX = v_bounds.x + u_border_width.x;\n  float maxX = v_bounds.z - u_border_width.x;\n\n  float minY = v_bounds.y + u_border_width.y;\n  float maxY = v_bounds.y + 1.0 - u_border_width.y;\n\n  float width = maxX - minX;\n  vec4 color = vec4(0.0, 0.0, 0.0, 0.0);\n\n  if(v_frame_type == 1.0) {\n    color = vec4(${e.COLORS.UI_FRAME_COLOR_FROZEN.join(",")});\n  } else {\n    color = vec4(${e.COLORS.UI_FRAME_COLOR_SLOW.join(",")});\n  }\n\n  if(width <= u_border_width.x) {\n    if(v_pos.y > minY && v_pos.y < maxY){\n      gl_FragColor = color;\n    } else {\n      gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n  } else if (v_pos.x > minX && v_pos.x < maxX && v_pos.y > minY && v_pos.y < maxY) {\n    gl_FragColor = color;\n  } else {\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n  }\n}\n`},"./app/utils/useDevicePixelRatio.tsx":(e,t,r)=>{r.d(t,{j:()=>o});var n=r("../node_modules/react/index.js");function o(){const[e,t]=(0,n.useState)(window.devicePixelRatio),r=(0,n.useCallback)((()=>{t(window.devicePixelRatio)}),[]);return(0,n.useLayoutEffect)((()=>(window.matchMedia(`(resolution: ${e}dppx)`).addEventListener("change",r,{once:!0}),()=>{window.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`).removeEventListener("change",r)})),[e,r]),e}},"./app/views/profiling/utils.tsx":(e,t,r)=>{r.d(t,{NN:()=>s,lk:()=>i}),r("./app/components/gridEditable/sortLink.tsx");var n=r("./app/locale.tsx");r("./app/utils.tsx"),r("./app/utils/queryString.tsx");const o={version:(0,n.t)("App Version"),device_manufacturer:(0,n.t)("Device Manufacturer"),device_model:(0,n.t)("Device Model"),device_os_version:(0,n.t)("Device Os Version"),transaction_name:(0,n.t)("Transaction Name")};function i(e,t){const r={current:0},n=performance.now();return r.current=window.requestAnimationFrame((function o(){r.current&&window.cancelAnimationFrame(r.current),performance.now()-n>t?e():r.current=window.requestAnimationFrame(o)})),r}Object.entries(o).map((e=>{let[t,r]=e;return{label:r,value:t}}));const s={start:null,end:null,utc:!1,period:"24h"}}}]);
//# sourceMappingURL=../sourcemaps/app_components_profiling_flamegraph_flamegraphZoomView_tsx-app_utils_profiling_flamegraph_fla-8da03b.ad7e23822c9e215f4750c5e20317ac9b.js.map