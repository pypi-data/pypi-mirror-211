(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_monitors_components_monitorForm_tsx-node_modules_lodash_groupBy_js"],{"./app/utils/slugify.tsx":(e,t,n)=>{"use strict";function r(e){return e.normalize("NFKD").toLowerCase().replace(" ","-").replace(/[^a-z0-9-_]/g,"")}n.d(t,{Z:()=>r})},"./app/utils/useMembers.tsx":(e,t,n)=>{"use strict";n.d(t,{L:()=>m});var r=n("../node_modules/react/index.js"),s=n("../node_modules/lodash/uniqBy.js"),o=n.n(s),i=n("./app/stores/memberListStore.tsx"),a=n("./app/stores/organizationStore.tsx"),l=n("./app/stores/useLegacyStore.tsx"),c=n("./app/utils/parseLinkHeader.tsx"),u=n("./app/utils/useApi.tsx");async function d(e,t){let{emails:n,ids:r,search:s,limit:o,lastSearch:i,cursor:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const l={};void 0!==r&&r.length>0&&(l.query=r.map((e=>`user.id:${e}`)).join(" ")),void 0!==n&&n.length>0&&(l.query=n.map((e=>`email:${e}`)).join(" ")),s&&(l.query=`${l.query??""} ${s}`.trim()),(i===s||!i&&!s)&&a&&(l.cursor=a),void 0!==o&&(l.per_page=o);let u=!1,d=null;const[m,,p]=await e.requestPromise(`/organizations/${t}/members/`,{includeAllArgs:!0,query:l}),h=p?.getResponseHeader("Link");if(h){const e=(0,c.Z)(h);u=e?.next?.results,d=e?.next?.cursor}return{results:m,hasMore:u,nextCursor:d}}function m(){let{ids:e,emails:t,limit:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=(0,u.Z)(),{organization:c}=(0,l.X)(a.Z),m=(0,l.X)(i.Z),p=c?.slug,[h,f]=(0,r.useState)(new Set),[g,y]=(0,r.useState)(new Set),b=(0,r.useMemo)((()=>new Set(m.members.map((e=>e.id)))),[m.members]),x=(0,r.useMemo)((()=>e?.filter((e=>!b.has(e)&&!h.has(e)))??[]),[e,h,b]),Z=(0,r.useMemo)((()=>new Set(m.members.map((e=>e.email)))),[m.members]),v=(0,r.useMemo)((()=>t?.filter((e=>!Z.has(e)&&!g.has(e)))??[]),[t,g,Z]),w=v.length>0||x.length>0,_=!w&&m.members.length>0,[k,S]=(0,r.useState)({initiallyLoaded:_,fetching:!1,hasMore:m.hasMore,lastSearch:null,nextCursor:m.cursor,fetchError:null}),M=(0,r.useCallback)((async function(){if(void 0!==p){S((e=>({...e,fetching:!0})));try{const{results:e,hasMore:t,nextCursor:r}=await d(s,p,{ids:x,emails:v,limit:n}),a=e.map((e=>e.user)).filter((e=>null!==e)),l=o()([...a,...m.members],(e=>{let{id:t}=e;return t})),c=x.filter((t=>!e.some((e=>e.user?.id===t))));c.length>0&&f((e=>new Set([...e,...c])));const u=v.filter((t=>!e.some((e=>e.user?.email===t))));u.length>0&&y((e=>new Set([...e,...u]))),i.Z.loadInitialData(l),S((e=>({...e,hasMore:t,fetching:!1,initiallyLoaded:!0,nextCursor:r})))}catch(e){console.error(e),S((t=>({...t,fetching:!1,initiallyLoaded:!0,fetchError:e})))}}}),[s,v,x,n,p,m.members]),j=(0,r.useCallback)((async function(e){const t=k.lastSearch,r=e?k.nextCursor:m.cursor;if(void 0!==p){S((e=>({...e,fetching:!0})));try{s.clear();const{results:a,hasMore:l,nextCursor:c}=await d(s,p,{search:e,limit:n,lastSearch:t,cursor:r}),u=a.map((e=>e.user)).filter((e=>null!==e)),h=o()([...m.members,...u],(e=>{let{email:t}=e;return t}));e?h.length>m.members.length&&i.Z.loadInitialData(h):i.Z.loadInitialData(h,l,c),S((t=>({...t,hasMore:l&&m.hasMore,fetching:!1,lastSearch:e??null,nextCursor:c})))}catch(e){console.error(e),S((t=>({...t,fetching:!1,fetchError:e})))}}else console.error("Cannot fetch members without an organization in context")}),[s,n,p,k.lastSearch,k.nextCursor,m.cursor,m.hasMore,m.members]),C=(0,r.useCallback)((function(e){return""!==e?j(e):(k.hasMore===m.hasMore&&k.nextCursor===m.cursor||S((t=>({...t,lastSearch:e,hasMore:m.hasMore,nextCursor:m.cursor}))),Promise.resolve())}),[j,k.hasMore,k.nextCursor,m.cursor,m.hasMore]);return(0,r.useEffect)((()=>{w&&M()}),[w,M]),{members:(0,r.useMemo)((()=>t?m.members.filter((e=>t.includes(e.email))):m.members),[m.members,t]),fetching:k.fetching||m.loading,initiallyLoaded:k.initiallyLoaded,fetchError:k.fetchError,hasMore:k.hasMore??m.hasMore,onSearch:C,loadMore:j}}},"./app/views/monitors/components/monitorForm.tsx":(e,t,n)=>{"use strict";n.d(t,{G:()=>F,Z:()=>X});var r=n("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),s=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=n("../node_modules/react/index.js"),i=n("../node_modules/mobx-react-lite/es/index.js"),a=n("./app/components/alert.tsx"),l=n("./app/components/alertLink.tsx"),c=n("./app/components/forms/fields/numberField.tsx"),u=n("./app/components/forms/fields/radioField.tsx"),d=n("./app/components/forms/fields/selectField.tsx"),m=n("./app/components/avatar/index.tsx"),p=n("./app/locale.tsx"),h=n("./app/utils/useMembers.tsx"),f=n("./app/utils/useTeams.tsx"),g=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function y(e){let{avatarSize:t=20,placeholder:n=(0,p.t)("Choose Teams and Members"),...r}=e;const{members:s,fetching:i,onSearch:a,loadMore:l}=(0,h.L)(),c=s?.map((e=>({value:`member:${e.id}`,label:e.name,leadingItems:(0,g.tZ)(m.Z,{user:e,size:t})}))),{teams:u,fetching:y,onSearch:b,loadMore:x}=(0,f.y)({provideUserTeams:!0}),Z=u?.map((e=>({value:`team:${e.id}`,label:e.name,leadingItems:(0,g.tZ)(m.Z,{team:e,size:t})})));return(0,o.useEffect)((()=>{l(),x()}),[]),(0,g.tZ)(d.Z,{placeholder:n,allowClear:!0,onInputChange:e=>{a(e),b(e)},isLoading:i||y,options:[{label:(0,p.t)("Members"),options:c},{label:(0,p.t)("Teams"),options:Z}],...r})}y.displayName="SentryMemberTeamSelectorField";const b=y;var x=n("./app/components/forms/fields/sentryProjectSelectorField.tsx"),Z=n("./app/components/forms/fields/textField.tsx"),v=n("./app/components/forms/form.tsx"),w=n("./app/components/forms/model.tsx"),_=n("./app/components/links/externalLink.tsx"),k=n("./app/components/list/index.tsx"),S=n("./app/components/list/listItem.tsx"),M=n("./app/components/text.tsx"),j=n("./app/data/timezones.tsx"),C=n("./app/styles/space.tsx"),E=n("./app/utils/isActiveSuperuser.tsx"),I=n("./app/utils/slugify.tsx"),T=n("./app/utils/theme.tsx"),q=n("./app/utils/usePageFilters.tsx"),A=n("./app/utils/useProjects.tsx"),R=n("./app/utils/withDomainRequired.tsx"),L=n("./app/views/monitors/utils.tsx"),N=n("./app/views/monitors/types.tsx");const D=[[N.Ix.CRONTAB,(0,p.t)("Crontab")],[N.Ix.INTERVAL,(0,p.t)("Interval")]],z="cron_job",O={team:"Team",member:"Member"},B={Team:"team",Member:"member"},F=30;function $(e,t){return t.fields.toJSON().reduce(((e,t)=>{let[n,r]=t;if("alertRule"===n){const t=r?.map((e=>{const[t,n]=e.split(":");return{targetType:O[t],targetIdentifier:n}}));return e[n]={targets:t},e}return n.startsWith("config.")?(e.config??={},"config.schedule.frequency"!==n&&"config.schedule.interval"!==n||Array.isArray(e.config.schedule)||(e.config.schedule=[1,"hour"]),Array.isArray(e.config.schedule)&&"config.schedule.frequency"===n?(e.config.schedule[0]=parseInt(r,10),e):Array.isArray(e.config.schedule)&&"config.schedule.interval"===n?(e.config.schedule[1]=r,e):(e.config[n.substring(7)]=r,e)):(e[n]=r,e)}),{})}function V(e){if(void 0===e.config)return e;const{config:t,...n}=e;return{...n,...Object.fromEntries(Object.entries(t).map((e=>{let[t,n]=e;return[`config.${t}`,n]})))}}function P(e){let{monitor:t,submitLabel:n,apiEndpoint:s,apiMethod:c,onSubmitSuccess:d}=e;const m=(0,o.useRef)(new w.Z({transformData:$,mapFormErrors:V})),{projects:h}=(0,A.Z)(),{selection:f}=(0,q.Z)(),y=f.projects[0],b=y?h.find((e=>e.id===y+"")):null,x=(0,E.M)(),Z=h.filter((e=>x||e.isMember)),k=t?.alertRule?.targets.map((e=>`${B[e.targetType]}:${e.targetIdentifier}`));return(0,g.tZ)(v.Z,{allowUndo:!0,requireChanges:!0,apiEndpoint:s,apiMethod:c,model:m.current,initialData:t?{name:t.name,slug:t.slug,type:t.type??z,project:t.project.slug,alertRule:k,...function(e,t){const n={};return"cron_job"===e&&(n["config.schedule_type"]=t.schedule_type,n["config.checkin_margin"]=t.checkin_margin,n["config.max_runtime"]=t.max_runtime,"interval"===t.schedule_type?(n["config.schedule.frequency"]=t.schedule[0],n["config.schedule.interval"]=t.schedule[1]):(n["config.schedule"]=t.schedule,n["config.timezone"]=t.timezone)),n}(t.type,t.config)}:{project:b?b.slug:null,type:z},onSubmitSuccess:d,submitLabel:n,children:(0,g.BX)(U,{symbol:"colored-numeric",children:[(0,g.tZ)(Y,{children:(0,p.t)("Add a name and project")}),(0,g.tZ)(ee,{children:(0,p.t)("The monitor name will show up in alerts and notifications")}),(0,g.BX)(te,{children:[(0,g.tZ)(J,{name:"name",placeholder:(0,p.t)("My Cron Job"),required:!0,stacked:!0,inline:!1}),t&&(0,g.tZ)(J,{name:"slug",help:(0,p._N)("The [strong:monitor-slug] is used to uniquely identify your monitor within your organization. Changing this slug will require updates to any instrumented check-in calls.",{strong:(0,g.tZ)("strong",{})}),placeholder:(0,p.t)("monitor-slug"),required:!0,stacked:!0,inline:!1,transformInput:I.Z}),(0,g.tZ)(G,{name:"project",projects:Z,placeholder:(0,p.t)("Choose Project"),disabled:!!t,disabledReason:(0,p.t)("Existing monitors cannot be moved between projects"),valueIsSlug:!0,required:!0,stacked:!0,inline:!1})]}),(0,g.tZ)(Y,{children:(0,p.t)("Choose your schedule type")}),(0,g.tZ)(ee,{children:(0,p._N)("You can use [link:the crontab syntax] or our interval schedule.",{link:(0,g.tZ)(_.Z,{href:"https://en.wikipedia.org/wiki/Cron"})})}),(0,g.tZ)(te,{children:(0,g.tZ)(u.Z,{name:"config.schedule_type",choices:D,defaultValue:N.Ix.CRONTAB,orientInline:!0,required:!0,stacked:!0,inline:!1})}),(0,g.tZ)(Y,{children:(0,p.t)("Choose your schedule")}),(0,g.tZ)(ee,{children:(0,p.t)("How often you expect your recurring jobs to run.")}),(0,g.BX)(te,{children:[void 0!==t&&(0,g.tZ)(a.ZP,{type:"info",children:(0,p.t)("Any changes you make to the execution schedule will only be applied after the next expected check-in.")}),(0,g.tZ)(i.Qj,{children:()=>{const e=m.current.getValue("config.schedule_type"),t="crontab"===e?(0,L.Z)(m.current.getValue("config.schedule")?.toString()??""):null;return"crontab"===e?(0,g.BX)(ne,{children:[(0,g.tZ)(J,{name:"config.schedule",placeholder:"* * * * *",defaultValue:"0 0 * * *",css:(0,r.iv)({input:{fontFamily:T.ZP.text.familyMono}},"",""),required:!0,stacked:!0,inline:!1}),(0,g.tZ)(K,{name:"config.timezone",defaultValue:"UTC",options:j.f,required:!0,stacked:!0,inline:!1}),t&&(0,g.BX)(re,{children:['"',t,'"']})]}):"interval"===e?(0,g.BX)(ne,{interval:!0,children:[(0,g.tZ)(Q,{children:(0,p.t)("Every")}),(0,g.tZ)(H,{name:"config.schedule.frequency",placeholder:"e.g. 1",defaultValue:"1",required:!0,stacked:!0,inline:!1}),(0,g.tZ)(K,{name:"config.schedule.interval",options:(n=Number(m.current.getValue("config.schedule.frequency")??1),[{value:"minute",label:(0,p.tn)("minute","minutes",n)},{value:"hour",label:(0,p.tn)("hour","hours",n)},{value:"day",label:(0,p.tn)("day","days",n)},{value:"week",label:(0,p.tn)("week","weeks",n)},{value:"month",label:(0,p.tn)("month","months",n)},{value:"year",label:(0,p.tn)("year","years",n)}]),defaultValue:"day",required:!0,stacked:!0,inline:!1})]}):null;var n}})]}),(0,g.tZ)(Y,{children:(0,p.t)("Set a missed status")}),(0,g.tZ)(ee,{children:(0,p.t)("The number of minutes we'll wait before we consider a check-in as missed.")}),(0,g.tZ)(te,{children:(0,g.tZ)(H,{name:"config.checkin_margin",placeholder:"Defaults to 0 minutes",stacked:!0,inline:!1})}),(0,g.tZ)(Y,{children:(0,p.t)("Set a failed status")}),(0,g.tZ)(ee,{children:(0,p.t)("The number of minutes a check-in is allowed to run before it's considered failed.")}),(0,g.tZ)(te,{children:(0,g.tZ)(H,{name:"config.max_runtime",placeholder:`Defaults to ${F} minutes`,stacked:!0,inline:!1})}),(0,g.BX)(o.Fragment,{children:[(0,g.tZ)(Y,{children:(0,p.t)("Notify members")}),(0,g.tZ)(ee,{children:(0,p.t)("Tell us who to notify when a check-in reaches the thresholds above or has an error. You can send notifications to members or teams.")}),(0,g.BX)(te,{children:[t?.config.alert_rule_id&&(0,g.tZ)(l.Z,{priority:"muted",to:(0,R.D)(`/alerts/rules/${t.project.slug}/${t.config.alert_rule_id}/`),children:(0,p.t)("Customize this monitors notification configuration in Alerts")}),(0,g.tZ)(W,{name:"alertRule",multiple:!0,stacked:!0,inline:!1})]})]})]})})}P.displayName="MonitorForm";const X=P,U=(0,s.Z)(k.Z,{target:"epnopid11"})({name:"yrf9ut",styles:"width:600px"}),H=(0,s.Z)(c.Z,{target:"epnopid10"})({name:"1hcx8jb",styles:"padding:0"}),K=(0,s.Z)(d.Z,{target:"epnopid9"})({name:"1hcx8jb",styles:"padding:0"}),J=(0,s.Z)(Z.Z,{target:"epnopid8"})({name:"1hcx8jb",styles:"padding:0"}),G=(0,s.Z)(x.Z,{target:"epnopid7"})({name:"1hcx8jb",styles:"padding:0"}),W=(0,s.Z)(b,{target:"epnopid6"})({name:"1hcx8jb",styles:"padding:0"}),Y=(0,s.Z)(S.Z,{target:"epnopid5"})("font-size:",(e=>e.theme.fontSizeExtraLarge),";font-weight:bold;line-height:1.3;"),Q=(0,s.Z)(M.Z,{target:"epnopid4"})("font-weight:bold;color:",(e=>e.theme.subText),";"),ee=(0,s.Z)(Q,{target:"epnopid3"})("font-weight:normal;padding-left:",(0,C.D)(4),";"),te=(0,s.Z)("div",{target:"epnopid2"})("padding-left:",(0,C.D)(4),";margin-top:",(0,C.D)(1),";margin-bottom:",(0,C.D)(4),";display:flex;flex-direction:column;gap:",(0,C.D)(1),";"),ne=(0,s.Z)("div",{target:"epnopid1"})("display:grid;align-items:center;gap:",(0,C.D)(1),";grid-template-columns:",(e=>e.interval&&"auto")," 1fr 2fr;"),re=(0,s.Z)(Q,{target:"epnopid0"})("font-weight:normal;font-size:",(e=>e.theme.fontSizeExtraSmall),";font-family:",(e=>e.theme.text.familyMono),";grid-column:auto/span 2;")},"./app/views/monitors/types.tsx":(e,t,n)=>{"use strict";let r,s,o,i;n.d(t,{Ix:()=>s,NI:()=>i,wo:()=>o}),function(e){e.UNKNOWN="unknown",e.CRON_JOB="cron_job"}(r||(r={})),function(e){e.CRONTAB="crontab",e.INTERVAL="interval"}(s||(s={})),function(e){e.OK="ok",e.ERROR="error",e.DISABLED="disabled",e.ACTIVE="active",e.MISSED_CHECKIN="missed_checkin",e.TIMEOUT="timeout"}(o||(o={})),function(e){e.OK="ok",e.ERROR="error",e.IN_PROGRESS="in_progress",e.MISSED="missed",e.TIMEOUT="timeout"}(i||(i={}))},"./app/views/monitors/utils.tsx":(e,t,n)=>{"use strict";n.d(t,{J:()=>c,Z:()=>l});var r=n("../node_modules/cronstrue/dist/cronstrue.js"),s=n.n(r),o=n("./app/locale.tsx"),i=n("./app/utils/dates.tsx"),a=n("./app/views/monitors/types.tsx");function l(e){if(!e)return null;let t;try{t=s().toString(e,{verbose:!0,use24HourTimeFormat:(0,i.gn)()})}catch(e){return null}return t}function c(e){if(e.schedule_type===a.Ix.CRONTAB)return l(e.schedule)??(0,o.t)("Unknown schedule");const[t,n]=e.schedule;return"minute"===n?(0,o.tn)("Every minute","Every %s minutes",t):"hour"===n?(0,o.tn)("Every hour","Every %s hours",t):"day"===n?(0,o.tn)("Every day","Every %s days",t):"week"===n?(0,o.tn)("Every week","Every %s weeks",t):"month"===n?(0,o.tn)("Every month","Every %s months",t):(0,o.t)("Unknown schedule")}},"../node_modules/lodash/groupBy.js":(e,t,n)=>{var r=n("../node_modules/lodash/_baseAssignValue.js"),s=n("../node_modules/lodash/_createAggregator.js"),o=Object.prototype.hasOwnProperty,i=s((function(e,t,n){o.call(e,n)?e[n].push(t):r(e,n,[t])}));e.exports=i}}]);
//# sourceMappingURL=../sourcemaps/app_views_monitors_components_monitorForm_tsx-node_modules_lodash_groupBy_js.46484c88146dd7ad6a268fab1bee594f.js.map