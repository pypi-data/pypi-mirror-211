import{r as n,a as f,j as t,g as m,i as k,Q as P,a7 as O,a8 as _,a9 as M,aa as B,t as U,ab as W,v as Y,ac as q,z as Q,ad as X,ae as G,H as z}from"./index-3144ef62.js";import{C as S,M as E}from"./ModalConfirmation-42b6be93.js";import{u as $}from"./editor-52c46803.js";import{X as I}from"./XCircleIcon-842cdf1c.js";import"./dialog-3d301c95.js";import"./keyboard-896332ff.js";import"./transition-b76f66ee.js";function Z({title:e,titleId:l,...a},r){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:r,"aria-labelledby":l},a),e?n.createElement("title",{id:l},e):null,n.createElement("path",{fillRule:"evenodd",d:"M6.97 2.47a.75.75 0 011.06 0l4.5 4.5a.75.75 0 01-1.06 1.06L8.25 4.81V16.5a.75.75 0 01-1.5 0V4.81L3.53 8.03a.75.75 0 01-1.06-1.06l4.5-4.5zm9.53 4.28a.75.75 0 01.75.75v11.69l3.22-3.22a.75.75 0 111.06 1.06l-4.5 4.5a.75.75 0 01-1.06 0l-4.5-4.5a.75.75 0 111.06-1.06l3.22 3.22V7.5a.75.75 0 01.75-.75z",clipRule:"evenodd"}))}const J=n.forwardRef(Z),K=J;function ee({title:e,titleId:l,...a},r){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:r,"aria-labelledby":l},a),e?n.createElement("title",{id:l},e):null,n.createElement("path",{fillRule:"evenodd",d:"M5.625 1.5H9a3.75 3.75 0 013.75 3.75v1.875c0 1.036.84 1.875 1.875 1.875H16.5a3.75 3.75 0 013.75 3.75v7.875c0 1.035-.84 1.875-1.875 1.875H5.625a1.875 1.875 0 01-1.875-1.875V3.375c0-1.036.84-1.875 1.875-1.875zM12.75 12a.75.75 0 00-1.5 0v2.25H9a.75.75 0 000 1.5h2.25V18a.75.75 0 001.5 0v-2.25H15a.75.75 0 000-1.5h-2.25V12z",clipRule:"evenodd"}),n.createElement("path",{d:"M14.25 5.25a5.23 5.23 0 00-1.279-3.434 9.768 9.768 0 016.963 6.963A5.23 5.23 0 0016.5 7.5h-1.875a.375.375 0 01-.375-.375V5.25z"}))}const te=n.forwardRef(ee),ne=te;function le({title:e,titleId:l,...a},r){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:r,"aria-labelledby":l},a),e?n.createElement("title",{id:l},e):null,n.createElement("path",{d:"M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0016.5 9h-1.875a1.875 1.875 0 01-1.875-1.875V5.25A3.75 3.75 0 009 1.5H5.625z"}),n.createElement("path",{d:"M12.971 1.816A5.23 5.23 0 0114.25 5.25v1.875c0 .207.168.375.375.375H16.5a5.23 5.23 0 013.434 1.279 9.768 9.768 0 00-6.963-6.963z"}))}const ae=n.forwardRef(le),se=ae;function oe({title:e,titleId:l,...a},r){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:r,"aria-labelledby":l},a),e?n.createElement("title",{id:l},e):null,n.createElement("path",{d:"M19.906 9c.382 0 .749.057 1.094.162V9a3 3 0 00-3-3h-3.879a.75.75 0 01-.53-.22L11.47 3.66A2.25 2.25 0 009.879 3H6a3 3 0 00-3 3v3.162A3.756 3.756 0 014.094 9h15.812zM4.094 10.5a2.25 2.25 0 00-2.227 2.568l.857 6A2.25 2.25 0 004.951 21H19.05a2.25 2.25 0 002.227-1.932l.857-6a2.25 2.25 0 00-2.227-2.568H4.094z"}))}const re=n.forwardRef(oe),ie=re;function ce({title:e,titleId:l,...a},r){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:r,"aria-labelledby":l},a),e?n.createElement("title",{id:l},e):null,n.createElement("path",{fillRule:"evenodd",d:"M19.5 21a3 3 0 003-3V9a3 3 0 00-3-3h-5.379a.75.75 0 01-.53-.22L11.47 3.66A2.25 2.25 0 009.879 3H4.5a3 3 0 00-3 3v12a3 3 0 003 3h15zm-6.75-10.5a.75.75 0 00-1.5 0v2.25H9a.75.75 0 000 1.5h2.25v2.25a.75.75 0 001.5 0v-2.25H15a.75.75 0 000-1.5h-2.25V10.5z",clipRule:"evenodd"}))}const ue=n.forwardRef(ce),pe=ue;function de({title:e,titleId:l,...a},r){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:r,"aria-labelledby":l},a),e?n.createElement("title",{id:l},e):null,n.createElement("path",{d:"M19.5 21a3 3 0 003-3v-4.5a3 3 0 00-3-3h-15a3 3 0 00-3 3V18a3 3 0 003 3h15zM1.5 10.146V6a3 3 0 013-3h5.379a2.25 2.25 0 011.59.659l2.122 2.121c.14.141.331.22.53.22H19.5a3 3 0 013 3v1.146A4.483 4.483 0 0019.5 9h-15a4.483 4.483 0 00-3 1.146z"}))}const he=n.forwardRef(de),me=he;function fe({title:e,titleId:l,...a},r){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",ref:r,"aria-labelledby":l},a),e?n.createElement("title",{id:l},e):null,n.createElement("path",{fillRule:"evenodd",d:"M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z",clipRule:"evenodd"}))}const we=n.forwardRef(fe),xe=we;function ve({title:e,titleId:l,...a},r){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",ref:r,"aria-labelledby":l},a),e?n.createElement("title",{id:l},e):null,n.createElement("path",{fillRule:"evenodd",d:"M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z",clipRule:"evenodd"}))}const ge=n.forwardRef(ve),be=ge;function T(e){const l=e.files??[],a=e.directories??[];return[...l,...a.map(T).flat()]}function H(e,l){const a=(Date.now()%1e5).toString(16);return`${e==null?"":`${e}_`}${a}${l??""}`.toLowerCase()}function je({file:e,setConfirmation:l}){const a=$(i=>i.tab),r=$(i=>i.tabs),c=$(i=>i.closeTab),g=f(i=>i.files),w=f(i=>i.selectedFile),s=f(i=>i.selectFile),d=f(i=>i.refreshProject),[x,p]=n.useState(!1),[u,h]=n.useState();n.useEffect(()=>{s(a==null?void 0:a.file)},[a]);function R(){x||(p(!0),_(e.path).then(i=>{var j;i.ok&&(c(e),(j=e.parent)==null||j.removeFile(e),d())}).catch(i=>{console.log(i)}).finally(()=>{p(!1)}))}function D(){l({headline:"Deleting File",description:`Are you sure you want to remove the file "${e.name}"?`,yesText:"Yes, Delete",noText:"No, Cancel",action:R})}function A(){if(x||e==null||P(u)||u==null){h(void 0);return}p(!0);const i=e.name,j=e.path;e.rename(u.trim()),O(j,{new_path:e.path}).then(N=>{e.update(N),g.set(e.path,e),g.delete(j)}).catch(N=>{console.log(N),e.rename(i)}).finally(()=>{h(void 0),p(!1),d()})}return t.jsx("span",{className:m("whitespace-nowrap group/file pl-3 pr-2 py-[0.125rem] flex rounded-md","hover:bg-neutral-100 dark:hover:bg-dark-lighter",e.is_supported&&"group hover:bg-neutral-100 dark:hover:bg-dark-lighter",k(P(u))&&"bg-primary-800",r.has(e)?"text-brand-500":"text-neutral-500 dark:text-neutral-100",e===w&&"bg-neutral-100 dark:bg-dark-lighter"),children:t.jsxs("span",{className:m("flex w-full items-center overflow-hidden overflow-ellipsis"),children:[t.jsx("div",{className:"flex items-center",children:t.jsx(se,{className:m("inline-block w-4 h-4 mr-2",e===w?"text-brand-500":"text-neutral-500 dark:text-neutral-100")})}),u==null?t.jsxs(t.Fragment,{children:[t.jsx(Fe,{file:e,setNewName:h}),t.jsx(ke,{removeWithConfirmation:D})]}):t.jsx(Ce,{file:e,newName:u,setNewName:h,rename:A})]})})}function Fe({file:e,setNewName:l}){const a=f(c=>c.selectedFile),r=f(c=>c.selectFile);return t.jsx("span",{title:`${e.name}${e.is_supported?"":" - unsupported format"}`,onClick:c=>{c.stopPropagation(),e!==a&&r(e)},onDoubleClick:c=>{c.stopPropagation(),l(e.name)},className:m("w-full overflow-hidden overflow-ellipsis cursor-default",!e.is_supported&&"opacity-50"),children:e.name})}function Ce({file:e,newName:l,setNewName:a,rename:r}){return t.jsxs("div",{className:"w-full flex items-center",children:[t.jsx("input",{type:"text",className:"w-full overflow-hidden overflow-ellipsis bg-primary-900 text-primary-100",value:l,onInput:c=>{c.stopPropagation(),a(c.target.value)}}),t.jsx("div",{className:"flex",children:e.name===(l==null?void 0:l.trim())||l===""?t.jsx(I,{className:"inline-block w-4 h-4 ml-2 text-neutral-500 cursor-pointer",onClick:c=>{c.stopPropagation(),a(void 0)}}):t.jsx(S,{className:"inline-block w-4 h-4 ml-2 text-success-500 cursor-pointer",onClick:c=>{c.stopPropagation(),r()}})})]})}function ke({removeWithConfirmation:e}){return t.jsx("span",{className:"flex items-center invisible group-hover/file:visible min-w-8",onClick:l=>{l.stopPropagation(),e()},children:t.jsx(I,{className:"inline-block w-4 h-4 ml-2 text-danger-500 cursor-pointer"})})}const C="w-4 h-4";function V({directory:e,setConfirmation:l}){const a=$(o=>o.tab),r=$(o=>o.closeTab),c=f(o=>o.selectFile),g=f(o=>o.refreshProject),[w,s]=n.useState(!1),[d,x]=n.useState(),[p,u]=n.useState(e.isOpen),h=p?xe:be,R=p?ie:me;n.useEffect(()=>{e.syncStateOpen=u},[]),n.useEffect(()=>{k(p)&&a!=null&&e.hasFile(a.file)&&e.open()},[a]);function D(o){if(o.stopPropagation(),w)return;s(!0);const b=H("new_directory");M(`${e.path}/${b}`,{}).then(v=>{if(k(v.ok)){console.warn([`Directory: ${e.path}`,v.detail]);return}e.addDirectory(new B(v,e)),e.open(),g()}).catch(v=>{console.log(v)}).finally(()=>{s(!1)})}function A(o){if(o.stopPropagation(),w)return;s(!0);const b=e.isModels?".sql":".py",v=H("new_file",b);O(`${e.path}/${v}`,{content:""}).then(F=>{if(k(F.ok)){console.warn([`File: ${e.path}`,F.detail]);return}const L=new U(F,e);e.addFile(L),e.open(),g()}).catch(F=>{console.log(F)}).finally(()=>{s(!1)})}function i(){w||(s(!0),W(e.path).then(o=>{var b;if(k(o.ok)){console.warn([`Directory: ${e.path}`,o.detail]);return}e.isNotEmpty&&T(e).forEach(F=>{r(F)}),(b=e.parent)==null||b.removeDirectory(e),g()}).catch(o=>{console.log({error:o})}).finally(()=>{s(!1)}))}function j(){l({headline:"Removing Directory",description:`Are you sure you want to remove the directory "${e.name}"?`,yesText:"Yes, Remove",noText:"No, Cancel",action:i})}function N(){if(w||e==null||P(d)||d==null)return;s(!0);const o=e.name,b=e.path;e.rename(d.trim()),M(b,{new_path:e.path}).catch(v=>{console.log(v),e.rename(o)}).finally(()=>{x(void 0),s(!1),a!=null&&e.hasFile(a.file)&&c(a.file)})}function y(){e.name===d?x(void 0):l({headline:"Renaming Directory",description:`Are you sure you want to rename the directory "${e.name}"?`,yesText:"Yes, Rename",noText:"No, Cancel",action:N,cancel:()=>{x(void 0)}})}return t.jsxs(t.Fragment,{children:[e.withParent&&t.jsxs("span",{className:m("w-full overflow-hidden group flex justify-between items-center rounded-md py-[0.125rem]","hover:bg-neutral-100 dark:hover:bg-dark-lighter text-neutral-600 dark:text-neutral-100",k(P(d))&&"bg-primary-800"),children:[t.jsxs("div",{className:m("mr-1 flex items-center",e.withDirectories||e.withFiles?"ml-0":"ml-3"),onClick:o=>{o.stopPropagation(),e.toggle()},children:[(e.withDirectories||e.withFiles)&&t.jsx(h,{className:m(`inline-block ${C} ml-1 mr-1`)}),t.jsx(R,{className:`inline-block ${C} mr-1 fill-primary-500`})]}),t.jsx("span",{className:"w-full overflow-hidden flex items-center justify-between pr-1",children:P(d)?t.jsxs("span",{className:"w-full flex overflow-hidden items-center cursor-default",children:[t.jsx("span",{className:"w-full overflow-hidden overflow-ellipsis justify-between",onClick:o=>{o.stopPropagation(),e.toggle()},onDoubleClick:o=>{o.stopPropagation(),x(e.name)},children:e.name}),t.jsxs("span",{className:"hidden w-full group-hover:flex items-center justify-end",children:[t.jsx(K,{onClick:o=>{o.stopPropagation(),e.isCollapsed?e.expand():e.collapse()},className:m(`cursor-pointer inline-block ${C} mr-1`,e.isCollapsed&&"text-neutral-500 dark:text-neutral-100",e.isExpanded&&"text-secondary-500 dark:text-primary-500")}),t.jsx(ne,{onClick:A,className:`cursor-pointer inline-block ${C} mr-1 text-neutral-500 dark:text-neutral-100`}),t.jsx(pe,{onClick:D,className:`cursor-pointer inline-block ${C} mr-1 text-neutral-500 dark:text-neutral-100`}),t.jsx(I,{onClick:o=>{o.stopPropagation(),j()},className:`cursor-pointer inline-block ${C} ml-2 text-danger-500`})]})]}):t.jsxs("div",{className:"flex w-full items-center",children:[t.jsx("input",{type:"text",className:"w-full overflow-hidden overflow-ellipsis bg-primary-900 text-primary-100",value:d??e.name,onInput:o=>{o.stopPropagation(),x(o.target.value)}}),t.jsx("div",{className:"flex",children:t.jsx(S,{className:`inline-block ${C} ml-2 text-success-500 cursor-pointer`,onClick:o=>{o.stopPropagation(),y()}})})]})})]}),(p||!e.withParent)&&e.withDirectories&&t.jsx("ul",{className:m(e.withParent?"pl-3":"mt-1"),children:e.directories.map(o=>t.jsx("li",{title:o.name,children:t.jsx(V,{directory:o,setConfirmation:l})},o.id))}),(p||!e.withParent)&&e.withFiles&&t.jsx("ul",{className:m(e.withParent?"pl-3":"mt-1"),children:e.files.map(o=>t.jsx("li",{title:o.name,children:t.jsx(je,{file:o,setConfirmation:l})},o.id))})]})}function Ie({className:e}){const l=Y(),a=f(u=>u.project),r=f(u=>u.setFiles),c=f(u=>u.setProject),{refetch:g}=q(),w=n.useCallback(Q(g,1e3,!0),[g]),[s,d]=n.useState(),[x,p]=n.useState(!1);return n.useEffect(()=>(w().then(({data:u})=>{c(u)}),()=>{w.cancel(),X(l)}),[]),n.useEffect(()=>{r((a==null?void 0:a.allFiles)??[])},[a]),n.useEffect(()=>{p(G(s))},[s]),t.jsxs("div",{className:m("py-2 px-1 overflow-hidden overflow-y-auto text-sm scrollbar scrollbar--vertical",e),children:[t.jsxs(E,{show:x,onClose:()=>{},children:[t.jsxs(E.Main,{children:[(s==null?void 0:s.headline)!=null&&t.jsx(E.Headline,{children:s==null?void 0:s.headline}),(s==null?void 0:s.description)!=null&&t.jsx(E.Description,{children:s==null?void 0:s.description})]}),t.jsxs(E.Actions,{children:[t.jsx(z,{className:"font-bold",size:"md",variant:"danger",onClick:u=>{var h;u.stopPropagation(),(h=s==null?void 0:s.action)==null||h.call(s),p(!1)},children:(s==null?void 0:s.yesText)??"Confirm"}),t.jsx(z,{size:"md",variant:"alternative",onClick:u=>{var h;u.stopPropagation(),(h=s==null?void 0:s.cancel)==null||h.call(s),p(!1)},children:(s==null?void 0:s.noText)??"Cancel"})]})]}),a!=null&&t.jsx(V,{directory:a,setConfirmation:d})]})}export{Ie as default};
