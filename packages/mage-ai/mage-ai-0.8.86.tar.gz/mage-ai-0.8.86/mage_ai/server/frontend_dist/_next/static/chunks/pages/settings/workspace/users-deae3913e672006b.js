(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2287],{63153:function(e,r,n){"use strict";n.d(r,{Z3:function(){return t},ms:function(){return i},s7:function(){return o}});var t=[{autoComplete:"username",label:"Username",required:!0,uuid:"username"},{autoComplete:"email",disabled:!1,label:"Email",required:!0,type:"email",uuid:"email"}],o="password_current",i=[{autoComplete:"current-password",label:"Current password",type:"password",uuid:o},{autoComplete:"new-password",label:"New password",type:"password",uuid:"password"},{autoComplete:"new-password",label:"Confirm new password",type:"password",uuid:"password_confirmation"}]},20582:function(e,r,n){"use strict";var t=n(82394),o=n(21831),i=n(75582),u=n(21764),s=n(82684),l=n(83455),d=n(60328),a=n(67971),c=n(87372),p=n(55378),f=n(86673),v=n(82944),w=n(81132),m=n(82531),b=n(66166),O=n(63153),h=n(9736),_=n(7715),j=n(96510),y=n(24224),Z=n(28598);function g(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function P(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?g(Object(n),!0).forEach((function(r){(0,t.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}r.Z=function(e){var r=e.disabledFields,n=e.hideFields,g=e.newUser,x=e.onDeleteSuccess,C=e.onSaveSuccess,S=e.showDelete,E=e.title,D=e.user,k=(0,s.useState)(!0),T=k[0],A=k[1],I=(0,s.useState)({}),M=I[0],N=I[1],R=(0,s.useState)(null),q=R[0],F=R[1],U=((0,h.PR)()||{}).owner,H=m.ZP.roles.list({limit_roles:!!g},{revalidateOnFocus:!1}),L=H.data,G=(H.mutate,(0,s.useMemo)((function(){return(null===L||void 0===L?void 0:L.roles)||[]}),[null===L||void 0===L?void 0:L.roles])),V=(0,l.Db)(g?m.ZP.users.useCreate():m.ZP.users.useUpdate(null===D||void 0===D?void 0:D.id),{onSuccess:function(e){return(0,j.wD)(e,{callback:function(e){var r=e.user,n=(0,_.GL)(r,O.Z3.concat(O.ms).map((function(e){return e.uuid})));F(n),u.Am.success(g?"New user created successfully.":"User profile successfully updated.",{position:u.Am.POSITION.BOTTOM_RIGHT,toastId:"user-update-success-".concat(r.id)}),null===C||void 0===C||C(n)},onErrorCallback:function(e){var r=e.error,n=r.errors,t=r.exception,o=r.message,i=r.type;u.Am.error((null===n||void 0===n?void 0:n.error)||t||o,{position:u.Am.POSITION.BOTTOM_RIGHT,toastId:i})}})}}),W=(0,i.Z)(V,2),X=W[0],B=W[1].isLoading,Q=(0,l.Db)(m.ZP.users.useDelete(null===D||void 0===D?void 0:D.id),{onSuccess:function(e){return(0,j.wD)(e,{callback:function(){null===x||void 0===x||x()},onErrorCallback:function(e){var r=e.error,n=r.errors,t=r.message;alert(t),console.log(n)}})}}),z=(0,i.Z)(Q,2),J=z[0],K=z[1].isLoading,Y=n?(0,o.Z)(n):[];g&&Y.push(O.s7);var $=!Y||!Y.includes(O.s7),ee=(0,b.Z)(D);(0,s.useEffect)((function(){if(D&&(!q||(null===ee||void 0===ee?void 0:ee.id)!==(null===D||void 0===D?void 0:D.id))){var e=O.Z3.concat(O.ms).map((function(e){return e.uuid}));F((0,_.GL)(D,e))}null!==q&&void 0!==q&&q.password||null!==q&&void 0!==q&&q.password_confirmation?(null===q||void 0===q?void 0:q.password)!==(null===q||void 0===q?void 0:q.password_confirmation)?N({password_confirmation:"Password confirmation does not match."}):!$||null!==q&&void 0!==q&&q.password_current?N(null):N({password_current:"This field is required."}):null!==q&&void 0!==q&&q.password_current&&$?null!==q&&void 0!==q&&q.password&&null!==q&&void 0!==q&&q.password_confirmation?N(null):N({password:"This field is required.",password_confirmation:"This field is required."}):null!==q&&void 0!==q&&q.password_current||null!==q&&void 0!==q&&q.password||null!==q&&void 0!==q&&q.password_confirmation||N(null)}),[q,$,D,ee]);var re=(0,s.useMemo)((function(){var e,r,n=null===q||void 0===q?void 0:q.roles_new;return n&&n.length>0?null===(e=n[0])||void 0===e?void 0:e.id:null!==D&&void 0!==D&&D.roles_new&&(null===D||void 0===D?void 0:D.roles_new.length)>0?null===(r=D.roles_new[0])||void 0===r?void 0:r.id:null!==q&&void 0!==q&&q.owner?w.No.OWNER:null===q||void 0===q?void 0:q.roles}),[q,D]);return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(c.Z,{children:E||"Edit profile"}),(0,Z.jsxs)("form",{children:[O.Z3.filter((function(e){var r=e.uuid;return!Y||!Y.includes(r)})).map((function(e){var r=e.autoComplete,n=e.disabled,o=e.label,i=e.required,u=e.type,s=e.uuid;return(0,Z.jsx)(f.Z,{mt:2,children:(0,Z.jsx)(v.Z,{autoComplete:r,disabled:n&&!g,label:o,onChange:function(e){A(!1),F((function(r){return P(P({},r),{},(0,t.Z)({},s,e.target.value))}))},primary:!0,required:i,setContentOnMount:!0,type:u,value:(null===q||void 0===q?void 0:q[s])||""})},s)})),!(null!==D&&void 0!==D&&D.owner)&&(0,Z.jsx)(f.Z,{mt:2,children:(0,Z.jsxs)(p.Z,{disabled:null===r||void 0===r?void 0:r.includes("roles"),label:"Roles",onChange:function(e){A(!1);var r=(0,y.sE)(G,(function(r){return r.id==e.target.value}));if(r){var n={roles_new:[r]};F((function(e){return P(P({},e),n)}))}},primary:!0,setContentOnMount:!0,value:re||(null===D||void 0===D?void 0:D.roles),children:[(0,Z.jsx)("option",{value:""}),G.map((function(e){var r=e.id,n=e.name;return(0,Z.jsx)("option",{value:r,children:n},n)}))]})}),(0,Z.jsxs)(f.Z,{mt:5,children:[(0,Z.jsx)(c.Z,{children:g?"Password":"Change password"}),O.ms.filter((function(e){var r=e.uuid;return!Y||!Y.includes(r)})).map((function(e){var r=e.autoComplete,n=e.disabled,o=e.label,i=e.required,u=e.type,s=e.uuid;return(0,Z.jsx)(f.Z,{mt:2,children:(0,Z.jsx)(v.Z,{autoComplete:r,disabled:n,label:o,meta:{error:null===M||void 0===M?void 0:M[s],touched:!(null===M||void 0===M||!M[s])},onChange:function(e){A(!1),F((function(r){return P(P({},r),{},(0,t.Z)({},s,e.target.value))}))},primary:!0,required:i,setContentOnMount:!0,type:u,value:(null===q||void 0===q?void 0:q[s])||""})},s)}))]}),(0,Z.jsx)(f.Z,{mt:5,children:(0,Z.jsxs)(a.Z,{children:[(0,Z.jsx)(d.Z,{disabled:T||M&&!(0,_.Qr)(M),loading:B,onClick:function(){var e,r=P({},q);"roles_new"in r&&(r.roles_new=null===(e=q.roles_new)||void 0===e?void 0:e.map((function(e){return e.id})));X({user:r})},primary:!0,children:g?"Create new user":"Update user profile"}),S&&U&&(0,Z.jsx)(f.Z,{ml:1,children:(0,Z.jsx)(d.Z,{danger:!0,loading:K,onClick:function(){window.confirm("Are you sure you want to delete ".concat(q.username||q.email,"?"))&&J()},children:"Delete user"})})]})})]})]})}},60921:function(e,r,n){"use strict";n.r(r);var t=n(77837),o=n(82394),i=n(38860),u=n.n(i),s=n(82684),l=n(34376),d=n(60328),a=n(87372),c=n(41788),p=n(30775),f=n(86673),v=n(58180),w=n(19711),m=n(20582),b=n(82531),O=n(66166),h=n(10503),_=n(49125),j=n(79585),y=n(63153),Z=n(9736),g=n(33766),P=n(7715),x=n(59e3),C=n(28598);function S(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function E(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?S(Object(n),!0).forEach((function(r){(0,o.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function D(){var e=(0,l.useRouter)(),r=(0,Z.PR)()||{},n=r.id,t=r.owner,o=(0,s.useState)(null),i=o[0],u=o[1],c=b.ZP.users.list({},{revalidateOnFocus:!1}),S=c.data,D=c.mutate,k=(0,s.useMemo)((function(){return(null===S||void 0===S?void 0:S.users)||[]}),[null===S||void 0===S?void 0:S.users]),T=b.ZP.users.detail(null===i||void 0===i?void 0:i.user_id,{},{revalidateOnFocus:!1}),A=T.data,I=T.mutate,M=null===A||void 0===A?void 0:A.user,N=(0,x.iV)(),R=(0,O.Z)(N);(0,s.useEffect)((function(){var e=N.add_new_user,r=N.user_id;if(!(0,P.Xy)(N,R)){var n=E(E({},R),N);r?n.user_id=r:delete n.user_id,e?n.add_new_user=e:delete n.add_new_user,u(n)}}),[N,R]);var q=null===i||void 0===i?void 0:i.add_new_user,F=(0,s.useMemo)((function(){return q?(0,C.jsx)(f.Z,{p:_.cd,children:(0,C.jsx)(m.Z,{newUser:!0,onSaveSuccess:function(){(0,g.u7)({add_new_user:null,user_id:null}),D()},title:"Add new user",user:{}})}):M?(0,C.jsx)(f.Z,{p:_.cd,children:(0,C.jsx)(m.Z,{hideFields:[y.s7],onDeleteSuccess:function(){(0,g.u7)({add_new_user:null,user_id:null}),D()},onSaveSuccess:function(){(0,g.u7)({add_new_user:null,user_id:null}),I(),D()},showDelete:!0,title:"Edit user",user:M})}):null}),[I,D,q,M]);return(0,C.jsxs)(p.Z,{after:F,afterHidden:!M&&!q,uuidItemSelected:j.eC,uuidWorkspaceSelected:j.WH,children:[t&&(0,C.jsx)(f.Z,{p:_.cd,children:(0,C.jsx)(d.Z,{beforeIcon:(0,C.jsx)(h.mm,{}),onClick:function(){return(0,g.u7)({add_new_user:1,user_id:null})},primary:!0,children:"Add new user"})}),(0,C.jsx)(f.Z,{p:_.cd,children:(0,C.jsx)(a.Z,{children:"Users"})}),(0,C.jsx)(v.Z,{columnFlex:[1,1,1],columns:[{uuid:"Username"},{uuid:"Email"},{uuid:"Role"}],isSelectedRow:function(e){var r;return(null===(r=k[e])||void 0===r?void 0:r.id)===(null===M||void 0===M?void 0:M.id)},onClickRow:function(r){var t,o=null===(t=k[r])||void 0===t?void 0:t.id;o===n?e.push("/settings/account/profile"):+(null===i||void 0===i?void 0:i.user_id)===o?(0,g.u7)({user_id:null}):(0,g.u7)({add_new_user:null,user_id:o})},rows:k.map((function(e){var r=e.email,n=e.roles_display,t=e.roles_new,o=e.username;return[(0,C.jsx)(w.ZP,{bold:!0,children:o},"username"),(0,C.jsx)(w.ZP,{default:!0,children:r},"email"),(0,C.jsx)(w.ZP,{default:!0,children:t&&t[0]?t[0].name:n},"roles")]})),uuid:"pipeline-runs"})]})}D.getInitialProps=(0,t.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)}))),r.default=(0,c.Z)(D)},33766:function(e,r,n){"use strict";n.d(r,{O2:function(){return c},g_:function(){return f},u7:function(){return p}});var t=n(75582),o=n(82394),i=n(34376),u=n.n(i),s=n(59e3),l=n(24224);function d(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function a(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?d(Object(n),!0).forEach((function(r){(0,o.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var c="_offset";function p(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.preserveParams,o=r.pushHistory,i=r.replaceParams,l=(0,s.iV)(),d={};n&&n.forEach((function(e){l[e]&&(d[e]=l[e])}));var c,p=i?d:l;c=window.location.pathname;var f=o?u().push:u().replace,v=a(a({},p),e);Object.entries(e).forEach((function(e){var r=(0,t.Z)(e,2),n=r[0],o=r[1];"undefined"!==typeof o&&null!==o||delete v[n]}));var w=(0,s.uM)(v);w.length>=1&&(w="?".concat(w));var m="".concat(c.split("?")[0]).concat(w);return f(u().router.pathname,m,{shallow:!0})}function f(e,r,n){var o=n.addingMultipleValues,i=n.isList,u=n.itemsPerPage,s=n.pushHistory,d=void 0!==s&&s,f=n.resetLimitParams,v=a({},e);o?Object.entries(r).forEach((function(e){var r=(0,t.Z)(e,2),n=r[0],o=r[1];if(Array.isArray(o)){var i="".concat(n,"[]");v[i]=o.map(String)}})):i?Object.entries(r).forEach((function(e){var r=(0,t.Z)(e,2),n=r[0],o=r[1],i=String(o),u="".concat(n,"[]"),s=v[u];s&&Array.isArray(s)?(s=s.map(String)).includes(i)?v[u]=(0,l.Od)(s,(function(e){return e===i})):v[u]=s.concat(i):v[u]=[i]})):v=a(a({},v),r),f&&(v._limit=u||20,v[c]=0),p(v,{pushHistory:d})}},48673:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings/workspace/users",function(){return n(60921)}])}},function(e){e.O(0,[844,7607,1424,1005,8180,3077,9774,2888,179],(function(){return r=48673,e(e.s=r);var r}));var r=e.O();_N_E=r}]);