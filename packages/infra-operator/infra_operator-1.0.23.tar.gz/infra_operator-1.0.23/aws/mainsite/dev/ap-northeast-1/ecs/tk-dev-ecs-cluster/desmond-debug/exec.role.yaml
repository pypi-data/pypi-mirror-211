apiVersion: iam.aws.infra/v1alpha1
kind: Role
pipelineConfig:
  no-apply: false
  comment: 'no-apply: true prevents this file being apply by infra-operator. auto
    added by infra-operator export. if need to apply, set to false'
metadata:
  Path: /
  RoleName: bin_desmond_debug_ecs_exec_role
  Description: managed by https://git.toolsfdg.net/devops/devops-infra
  MaxSessionDuration: 3600
  Tags:
    terraform: y
    prow-pipeline: y
spec:
  managed-policies:
    - PolicyArn: arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy
      PolicyName: AmazonECSTaskExecutionRolePolicy
  AssumeRolePolicyDocument:
    Version: '2012-10-17'
    Statement:
      - Effect: Allow
        Action: sts:AssumeRole
        Principal:
          Service: ecs-tasks.amazonaws.com
  inline-policies:
    - PolicyName: ECRRepoPullPolicy
      PolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Sid: AllowPull
            Effect: Allow
            Resource: '*'
            Action:
              - ecr:GetAuthorizationToken
              - ecr:BatchGetImage
              - ecr:BatchCheckLayerAvailability
              - ecr:ListTagsForResource
              - ecr:GetDownloadUrlForLayer
    - PolicyName: secretsmanager
      PolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Sid: VisualEditor0
            Effect: Allow
            Resource: arn:aws:secretsmanager:ap-northeast-1:173062506398:secret:bin-dev-desmond-debug-secret-XISttf
            Action:
              - ssm:GetParameters
              - secretsmanager:GetSecretValue
              - kms:Decrypt
    - PolicyName: TestRefPolicy
      PolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Sid: VisualEditor0
            Effect: Allow
            Action: sns:Publish
            Resource: arn:aws:sns:ap-northeast-1:173062506398:cache-proxy
