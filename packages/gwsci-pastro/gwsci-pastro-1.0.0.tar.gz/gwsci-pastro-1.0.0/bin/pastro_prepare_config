#!/usr/bin/env python3

import yaml
from optparse import OptionParser

def parse_command_line():
  parser = OptionParser()
  parser.add_option("-v", "--verbose", action = "store_true", help = "Be verbose.")
  parser.add_option("--category", action="append", help = "the category name, e.g., BNS, NSBH, BBH. must be given same number of times as merge-rate/VT.")
  parser.add_option("--merge-rate", action="append", help = "the BNS, NSBH, BBH, etc., counts. Must be given same number of times as --category")
  parser.add_option("--output", help = "output all values into a config yml file")
  options, filenames = parser.parse_args()
  process_params = dict(options.__dict__)

  assert len(options.category) == len(options.merge_rate)

  return options, process_params, filenames

options, process_params, filenames = parse_command_line()

config = {}
for fn in filenames:
  print(fn)
  with open(fn) as file:
    value = yaml.safe_load(file)
    key = list(value.keys())[0]
    config[key] = value[key]

for i in range(len(options.category)):
  config[options.category[i]+'_merge_rate'] = float(options.merge_rate[i])

with open(options.output, 'w') as out:
  yaml.safe_dump(config, out)
